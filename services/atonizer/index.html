<!doctype html>
<html lang="en">

<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0" />
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="mobile-web-app-capable" content="yes">

<title>ATONIZER</title>
<link rel="stylesheet" type="text/css" href="../../css/aton.css">

<script type="text/javascript" src="../../vendors/jquery.min.js"></script>

<script>
//============================================================================
let configdata = undefined;
let bProcessing = false;
let bCanProcess = false;

let onTaskCompleted = function(){
    $("#idProcessBTN").attr("class","atonBTN atonBTN-green atonizerProcessBTN");
    
    console.log("Completed.");
    bProcessing = false;
};

let requestProcess = function(){
    if (bProcessing) return;
    if (!bCanProcess) return;

    bProcessing = true;
    $("#idProcessBTN").attr("class","atonBTN atonBTN-red atonizerProcessBTN");

    // Build args
    let args = {};
    args.infolder  = $("#inFolder").val();
    
    if (document.getElementById('inPlaceConv').checked) args.outfolder = $("#inFolder").val();
    else {
        let idproj = $("#outProject").val();
        idproj = idproj.replace(/[^\w\s]/gi, '');
        idproj = idproj.replace(/ /g,'');
        idproj += "/";

        args.outfolder = $("#outFolder").val() + idproj;
        }
    args.pattern = $("#pattern").val();

    console.log(args);
    return;

    // Fire request
    let udata = JSON.stringify(args);    
    $.ajax({
        url: "./api/process",
        type:"POST",
        data: udata,
        contentType:"application/json; charset=utf-8",
        dataType:"json",
        success: onTaskCompleted
    });
};

let onSwitchInplace = function(){
    //TODO:
}

let isDataValid = function(){
    let b = true;
    let pstring = $('#outProject').val();
    if (pstring.length < 2) b = false;

    if (b) $("#idProcessBTN").attr("class","atonBTN atonBTN-green atonizerProcessBTN");
    else $("#idProcessBTN").attr("class","atonBTN atonBTN-red atonizerProcessBTN");
    
    return b;
}

window.addEventListener( 'load', ()=>{

bCanProcess = isDataValid();


$('#outProject').on('keyup', ()=>{
    bCanProcess = isDataValid();
});

// Request config
$.getJSON("./config", function( data ){
    configdata = data;

    if (!data.infolders) return;

    console.log(data);

    for (let p in data.infolders){
        let path = data.infolders[p];
        $("#inFolder").append("<option value='"+path+"'>"+path+"</option>");
        }

    if (!data.outfolders) return;

    for (let p in data.outfolders){
        let path = data.outfolders[p];
        $("#outFolder").append("<option value='"+path+"'>"+path+"</option>");
        }
});


});
</script>
</head>


<body class="atonizerBody">
	<div style="text-align: center;">
		<h1>ATONIZER</h1>
    </div>
    
    <div class="atonizerBlockGroup">
        <!-- INPUT -->
        <div class="atonizerBlock"><div class="atonizerBlockTitle">Input</div>
            <label for="inFolder">Input folder</label>
            <div class="select">
                <select id="inFolder"></select>
                <div class="selectArrow"></div>
            </div>

            <label for="pattern">Pattern</label>
            <div class="select" style="width: 100px;">
                <select id="pattern">
                    <option value="*.obj">*.obj</option>
                    <option value="*.osg">*.osg</option>
                </select>
                <div class="selectArrow"></div>
            </div>
        </div>
            
        <!-- OUTPUT -->
        <div class="atonizerBlock"><div class="atonizerBlockTitle">Output</div>
            <label for="inPlaceConv">Convert in-place</label>
            <input id="inPlaceConv" type="checkbox" onchange="onSwitchInplace">

            <label for="outFolder">Output</label>
            <div class="select" style="width: 30%;">
                <select id="outFolder"></select>
                <div class="selectArrow"></div>
            </div>

            <label for="outProject">Project ID</label>
            <input id="outProject" type="text" size="20" placeholder="project">
        </div>

        <!-- OPTIONS -->
        <div class="atonizerBlock"><div class="atonizerBlockTitle">Options</div>
        <!-- 
            <label for="compressGeometry">Compress Geometry</label>
            <input id="compressGeometry" type="checkbox">
        -->
        </div>

        <!-- PROCESS -->
        <div id="idProcessBTN" class="atonBTN atonBTN-green atonizerProcessBTN" onclick="requestProcess();"><h3>PROCESS</h3></div>

    </div>


</body>
</html>
