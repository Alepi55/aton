parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"XTSP":[function(require,module,exports) {
"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function n(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&s(t,e)}function s(t,e){return(s=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function o(t){var e=c();return function(){var i,n=l(t);if(e){var r=l(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return a(this,i)}}function a(e,i){return!i||"object"!==t(i)&&"function"!=typeof i?u(e):i}function u(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function c(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}function l(t){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function h(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var d=function(t){r(s,THREE.Group);var i=o(s);function s(t,n){var r;return e(this,s),h(u(r=i.call(this)),"updateLightProbes",function(){return r.traverse(function(t){if(t.isMesh&&t.geometry){var e=t.userData.LP;void 0!==e&&(e.update(),t.material.envMap=e.getEnvTex())}}),u(r)}),r.type=n||ATON.NTYPES.SCENE,r.enablePicking(),r.type===ATON.NTYPES.SCENE&&(r._rootG=ATON._rootVisible,r._nodes=ATON.snodes),r.type===ATON.NTYPES.SEM&&(r._rootG=ATON._rootSem,r._nodes=ATON.semnodes),r.type===ATON.NTYPES.UI&&(r._rootG=ATON._rootUI,r._nodes=ATON.uinodes),r.as(t),r.kwords=void 0,r._bCloneOnLoadHit=!0,r._tlist=void 0,r._aniMixers=void 0,r.castShadow=!1,r.receiveShadow=!1,r.onHover=void 0,r.onLeave=void 0,r.onSelect=void 0,r}return n(s,[{key:"as",value:function(t){if(void 0!==t&&t!==ATON.ROOT_NID)return this._nodes[t]=this,this.nid=t,this.name=t,this}},{key:"setAsRoot",value:function(){return this._nodes[ATON.ROOT_NID]=this,this.nid=ATON.ROOT_NID,this}},{key:"setCloneOnLoadHit",value:function(t){return this._bCloneOnLoadHit=t,this}},{key:"addKeywords",value:function(t){var e=t.split(",");for(var i in void 0===this.kwords&&(this.kwords={}),e){var n=e[i].trim();n.length>0&&(this.kwords[n]=!0)}for(var r in this.children){var s=this.children[r];void 0!==s.type&&s.addKeywords(t)}return this}},{key:"hasKeyword",value:function(t){if(void 0!==this.kwords)return void 0!==this.kwords[t]}},{key:"setDescription",value:function(t){return this.userData.description=t,this}},{key:"getDescription",value:function(){return this.userData.description}},{key:"setAudio",value:function(t){return this.userData.audio=t,this}},{key:"getAudio",value:function(){return this.userData.audio}},{key:"hide",value:function(){return this.visible=!1,ATON.Utils.setPicking(this,this.type,!1),ATON._renderer.shadowMap.enabled&&(ATON._dMainL.shadow.needsUpdate=!0),this}},{key:"show",value:function(){return this.visible=!0,ATON.Utils.setPicking(this,this.type,this.bPickable),ATON._renderer.shadowMap.enabled&&(ATON._dMainL.shadow.needsUpdate=!0),this}},{key:"toggle",value:function(t){return void 0===t?this.visible?this.hide():this.show():t?this.show():this.hide()}},{key:"disablePicking",value:function(){return this.bPickable=!1,ATON.Utils.setPicking(this,this.type,this.bPickable),this}},{key:"enablePicking",value:function(){return this.bPickable=!0,ATON.Utils.setPicking(this,this.type,this.bPickable),this}},{key:"setPickable",value:function(t){return t?this.enablePicking():this.disablePicking(),this}},{key:"setMaterial",value:function(t){var e=this;for(var i in this.userData.cMat=t,this.traverse(function(i){i.isMesh&&(i.material=t),i.type&&(e.userData.cMat=t)}),this.children){var n=this.children[i];n.setMaterial&&n.setMaterial(t)}return this}},{key:"getMaterial",value:function(){return this.userData.cMat}},{key:"setDefaultAndHighlightMaterials",value:function(t,e){return this.userData.matSTD=t,this.userData.matHL=e,this}},{key:"highlight",value:function(){return this.userData.matHL&&this.setMaterial(this.userData.matHL),this}},{key:"restoreDefaultMaterial",value:function(){return this.userData.matSTD&&this.setMaterial(this.userData.matSTD),this}},{key:"setOpacity",value:function(t){return this.traverse(function(e){e.isMesh&&(e.material.opacity=t)}),this}},{key:"setShadowCast",value:function(t){return this.castShadow=t,this.traverse(function(e){e.isMesh&&(e.castShadow=t)}),this}},{key:"setShadowReceive",value:function(t){return this.receiveShadow=t,this.traverse(function(e){e.isMesh&&(e.receiveShadow=t)}),this}},{key:"setEnvMap",value:function(t){return this.traverse(function(e){e.isMesh&&(e.material.envMap=t)}),this}},{key:"assignLightProbe",value:function(t){return this.traverse(function(e){e.isMesh&&e.geometry&&ATON.Utils.assignLightProbeToMesh(t,e)}),this}},{key:"assignLightProbesByProximity",value:function(){return 0===ATON._lps.length?this:(this.traverse(function(t){if(t.isMesh&&t.geometry){var e=new THREE.Vector3,i=((new THREE.Box3).setFromObject(t).getCenter(e),void 0),n=void 0;for(var r in ATON._lps){var s=ATON._lps[r],o=e.distanceToSquared(s.pos);(void 0===i||o<n)&&(n=o,i=s)}i&&ATON.Utils.assignLightProbeToMesh(i,t)}}),this)}},{key:"duplicate",value:function(){var t=this.clone();return t.traverse(function(t){t.isMesh&&(t.material=t.material.clone())}),t}},{key:"delete",value:function(){var t=this.parent;void 0!==t&&void 0!==t.nid&&t.removeChild(this)}},{key:"removeChild",value:function(t){if(void 0!==t){t.nid;return void 0!==t.nid&&(this._nodes[t.nid]=void 0),t.parent=void 0,t.traverse(function(t){t.geometry&&t.geometry.dispose(),t.material&&t.material.dispose()}),this.remove(t),this}}},{key:"removeChildren",value:function(){for(var t=this.children.length-1;t>=0;t--)this.removeChild(this.children[t]);return this}},{key:"attachTo",value:function(t){var e="string"==typeof t?this._nodes[t]:t;return e&&(e.add(this),void 0!==e.userData.cMat&&(this.userData.cMat=e.userData.cMat),void 0!==e.bPickable&&(this.bPickable=e.bPickable)),e}},{key:"attachToRoot",value:function(){return this._rootG.add(this),void 0!==this._rootG.userData.cMat&&(this.userData.cMat=this._rootG.userData.cMat),void 0!==this._rootG.bPickable&&(this.bPickable=this._rootG.bPickable),this._rootG}},{key:"getBound",value:function(){var t=(new THREE.Box3).setFromObject(this),e=new THREE.Sphere;return t.getBoundingSphere(e),e}},{key:"setPosition",value:function(t,e,i){return t instanceof THREE.Vector3?this.position.copy(t):this.position.set(t,e,i),this}},{key:"setScale",value:function(t,e,i){return t instanceof THREE.Vector3?this.scale.copy(t):(void 0===e&&(e=t,i=t),this.scale.set(t,e,i)),this}},{key:"setRotation",value:function(t,e,i){return t instanceof THREE.Vector3?this.rotation.copy(t):this.rotation.set(t,e,i),this}},{key:"orientToCamera",value:function(){return this.quaternion.copy(ATON.Nav._qOri),this}},{key:"setYup",value:function(){return this.rotation.set(-1.57079632679,0,0),this}},{key:"addTransform",value:function(t){var e=void 0;return"string"==typeof t&&(e=ATON.Utils.parseTransformString(t)),void 0===e?this:(void 0===this._tlist&&(this._tlist=[]),this._tlist.push(e),this)}},{key:"load",value:function(t,e){if(void 0===t)return this;t=ATON.Utils.resolveCollectionURL(t);var i=this;if(t.endsWith("tileset.json"))return ATON.Utils.loadTileSet(t,i),ATON._bqScene=!0,e&&e(),i;if(i._bCloneOnLoadHit&&void 0!==ATON._assetsManager[t])return ATON._assetsManager[t].then(function(t){var n=t.clone();if(ATON.Utils.modelVisitor(i,n),void 0!==i._tlist)for(var r in i._tlist)i._tlist[r].add(n.clone()),i.add(i._tlist[r]);else i.add(n);e&&e()}),console.log("HIT!"),i;i.type===ATON.NTYPES.SCENE&&ATON._assetReqNew(t);var n=new Promise(function(n,r){ATON._aLoader.load(t,function(r){var s=r.scene||r.scene[0];if(ATON.Utils.modelVisitor(i,s),void 0!==i._tlist)for(var o in i._tlist)i._tlist[o].add(s.clone()),i.add(i._tlist[o]);else i.add(s);ATON.Utils.registerAniMixers(i,r),ATON.Utils.ccExtract(r),n(s),console.log("Model "+t+" loaded"),i.type===ATON.NTYPES.SCENE&&ATON._assetReqComplete(t),i.type===ATON.NTYPES.SCENE&&(ATON._bqScene=!0),i.type===ATON.NTYPES.SEM&&(ATON._bqSem=!0),e&&e()},void 0,function(n){i.type===ATON.NTYPES.SCENE&&ATON._assetReqComplete(t),e&&e()})});return i._bCloneOnLoadHit&&(ATON._assetsManager[t]=n),this}},{key:"exportAs",value:function(t){return ATON.Utils.exportNode(this,t),this}},{key:"setOnHover",value:function(t){return this.onHover=f,this}},{key:"setOnLeave",value:function(t){return this.onLeave=f,this}},{key:"setOnSelect",value:function(t){return this.onSelect=f,this}}]),s}(),v=d;exports.default=v;
},{}],"CwXu":[function(require,module,exports) {
"use strict";function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function e(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function i(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var r=function(){function e(i){t(this,e),this.pos=new THREE.Vector3(1,0,0),this.target=new THREE.Vector3(0,0,0),this.up=ATON.STD_UPVECTOR,this.fov=void 0,this.nextPOV=void 0,this.prevPOV=void 0,this.as(i)}return i(e,[{key:"as",value:function(t){if(void 0!==t)return ATON.Nav.povlist[t]=this,this.id=t,this}},{key:"setPosition",value:function(t,e,i){return t instanceof THREE.Vector3?this.pos.copy(t):this.pos.set(t,e,i),this}},{key:"setTarget",value:function(t,e,i){return t instanceof THREE.Vector3?this.target.copy(t):this.target.set(t,e,i),this}},{key:"setFOV",value:function(t){return this.fov=t,this}},{key:"addKeywords",value:function(t){var e=t.split(",");for(var i in void 0===this.kwords&&(this.kwords={}),e){var r=e[i].trim();r.length>0&&(this.kwords[r]=!0)}return this}},{key:"hasKeyword",value:function(t){if(void 0!==this.kwords)return void 0!==this.kwords[t]}},{key:"setNextPOV",value:function(t){if(t)return this.nextPOV=t,this}},{key:"setPrevPOV",value:function(t){if(t)return this.prevPOV=t,this}}]),e}(),s=r;exports.default=s;
},{}],"MNcy":[function(require,module,exports) {
"use strict";function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,i,r){return i&&t(e.prototype,i),r&&t(e,r),e}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var r=function(){function t(i,r,n){e(this,t),this.pos=new THREE.Vector3(0,0,0),this._res=void 0!==i?i:64,this._near=void 0!==r?r:1,this._far=void 0!==n?n:ATON.Nav.STD_FAR,this._envtex=void 0,this._prevCCtarget=void 0}return i(t,[{key:"setPosition",value:function(e,t,i){return e instanceof THREE.Vector3?this.pos.copy(e):this.pos.set(e,t,i),this}},{key:"setNear",value:function(e){return this._near=e,this}},{key:"setFar",value:function(e){return this._far=e,this}},{key:"update",value:function(){this._envtex&&this._envtex.dispose(),this._prevCCtarget&&this._prevCCtarget.dispose();var e=new THREE.WebGLCubeRenderTarget(this._res,{format:THREE.RGBEFormat,generateMipmaps:!0,minFilter:THREE.LinearMipmapLinearFilter,encoding:THREE.sRGBEncoding}),t=new THREE.CubeCamera(this._near,this._far,e);return t.position.copy(this.pos),t.update(ATON._renderer,ATON._rootVisibleGlobal),this._envtex=e.texture,this._prevCCtarget=e,this}},{key:"getEnvTex",value:function(){return this._envtex}},{key:"assignToNode",value:function(e){}}]),t}(),n=r;exports.default=n;
},{}],"LryX":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e={init:function(){e.evLocal={},e.evNetwork={},ATON.on=e.on,ATON.fireEvent=e.fireEvent,ATON.clearEventHandlers=e.clearEventHandlers},clearEventHandlers:function(n){e.evLocal[n]=[],e.evNetwork[n]=[]},executeHandlers:function(e,n){if(e)for(var t=0;t<e.length;t++){var o=e[t];o&&o(n)}},on:function(n,t,o){if(void 0!==t){var r=e.evLocal;void 0===r[n]&&(r[n]=[]),r[n].push(t)}void 0!==o&&ATON.VRoadcast.on(n,o)},fireEvent:function(n,t,o){var r=e.evLocal[n];e.executeHandlers(r,t),o&&ATON.VRoadcast.fireEvent(n,t)}},n=e;exports.default=n;
},{}],"R8yv":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e={init:function(){e.materials={},e.colors={},e._loader=new THREE.MaterialLoader,e._uSem={time:{type:"float",value:0},tint:{type:"vec4",value:new THREE.Vector4(.2,.2,1,.2)}},e.addDefaults()},getDefVertexShader:function(){return"\n        varying vec3 vPositionW;\n        varying vec3 vNormalW;\n        varying vec3 vNormalV;\n\n        void main(){\n            vPositionW = vec3( vec4( position, 1.0 ) * modelMatrix);\n            vNormalW   = normalize( vec3( vec4( normal, 0.0 ) * modelMatrix ) );\n            vNormalV   = normalize( vec3( normalMatrix * normal ));\n\n            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n        }\n    "},addDefaults:function(){e.colors.white=new THREE.Color(1,1,1),e.colors.black=new THREE.Color(0,0,0),e.colors.green=new THREE.Color(0,1,0),e.colors.yellow=new THREE.Color(1,1,0),e.colors.red=new THREE.Color(1,0,0),e.colors.blue=new THREE.Color(0,0,1),e.colors.orange=new THREE.Color(1,.5,0),e.colors.defUI=new THREE.Color(0,1,.5),e.colors.sem=new THREE.Color(0,1,.5),e.colors.darksem=new THREE.Color(0,0,.1),e.materials.fullyTransparent=new THREE.MeshBasicMaterial({transparent:!0,depthWrite:!1,opacity:0}),e.materials.defUI=new THREE.ShaderMaterial({uniforms:{color:{type:"vec3",value:e.colors.defUI},opacity:{type:"float",value:.8}},vertexShader:e.getDefVertexShader(),fragmentShader:"\n            varying vec3 vPositionW;\n\t\t    varying vec3 vNormalW;\n            varying vec3 vNormalV;\n            uniform vec3 color;\n            uniform float opacity;\n\n\t\t    void main(){\n\t\t        //vec3 viewDirectionW = normalize(cameraPosition - vPositionW);\n\n                float f;\n\t\t        //f = dot(viewDirectionW, vNormalW);\n                f = dot(vNormalV, vec3(0,0,1));\n\t\t        f = clamp(1.0 - f, 0.2, 1.0);\n\n\t\t        gl_FragColor = vec4(color.rgb, f * opacity);\n\t\t    }\n        ",transparent:!0,depthWrite:!1}),e.materials.selector=e.materials.defUI.clone(),e.materials.controllerRay=e.materials.defUI.clone(),e.materials.controllerRay.uniforms.color.value=e.colors.white,e.materials.teleportLoc=new THREE.MeshBasicMaterial({transparent:!0,opacity:1,depthWrite:!1,side:THREE.DoubleSide}),ATON.Utils.textureLoader.load(ATON.PATH_RES+"grad.png",function(t){e.materials.teleportLoc.map=t}),e.materials.measurement=new THREE.MeshBasicMaterial({color:e.colors.white,transparent:!0,depthWrite:!1,opacity:.5,depthTest:!1}),e.materials.semanticShape=new THREE.ShaderMaterial({uniforms:e._uSem,vertexShader:e.getDefVertexShader(),fragmentShader:"\n            varying vec3 vPositionW;\n\t\t    varying vec3 vNormalW;\n            varying vec3 vNormalV;\n\n            uniform float time;\n            uniform vec4 tint;\n\n\t\t    void main(){\n\t\t        //vec3 viewDirectionW = normalize(cameraPosition - vPositionW);\n\n                //float ff = dot(vNormalV, vec3(0,0,1));\n\t\t        //ff = clamp(1.0-ff, 0.0, 1.0);\n\n                float f = (1.0 * cos(time*2.0)); // - 0.5;\n                //f = cos(time + (vPositionW.y*10.0));\n                f = clamp(f, 0.0,1.0);\n\n\t\t        gl_FragColor = vec4(tint.rgb, tint.a * f);\n                //gl_FragColor = vec4(tint.rgb, ff);\n\t\t    }\n        ",transparent:!0,depthWrite:!1}),e.materials.semanticShapeHL=new THREE.MeshBasicMaterial({color:e.colors.sem,transparent:!0,depthWrite:!1,opacity:.2}),e.materials.semanticShapeEdit=new THREE.MeshBasicMaterial({color:e.colors.orange,transparent:!0,depthWrite:!1,opacity:.5}),e.semIcon=new THREE.SpriteMaterial({map:(new THREE.TextureLoader).load(ATON.PATH_RES+"sui-sem.png"),transparent:!0,opacity:1,depthTest:!1}),e.materials.lp=new THREE.ShaderMaterial({vertexShader:e.getDefVertexShader(),fragmentShader:"\n            varying vec3 vPositionW;\n\t\t    varying vec3 vNormalW;\n            varying vec3 vNormalV;\n\n\t\t    void main(){\n\t\t        vec3 viewDirectionW = normalize(cameraPosition - vPositionW);\n\n                float f;\n\t\t        //f = dot(viewDirectionW, vNormalW);\n                f = dot(vNormalV, vec3(0,0,1));\n\t\t        f = clamp(1.0 - f, 0.0, 1.0);\n\n\t\t        gl_FragColor = vec4(1.0,1.0,1.0, f);\n\t\t    }\n        ",transparent:!0,depthWrite:!1}),e.lpIcon=new THREE.SpriteMaterial({map:(new THREE.TextureLoader).load(ATON.PATH_RES+"sui-lp.png"),transparent:!0,opacity:1,depthWrite:!1}),e.semIcon.sizeAttenuation=!1,e.lpIcon.sizeAttenuation=!1},addMaterial:function(t,a){e.materials[t]?console.log("MatHub: material "+t+" already registered"):e.materials[t]=a},loadMaterial:function(t,a){e._loader.load(a,function(a){e.addMaterial(t,a)},void 0,function(e){console.log(e)})},getMaterial:function(t){return e.materials[t]},update:function(){e._uSem.time.value+=ATON._dt}},t=e;exports.default=t;
},{}],"P9TA":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=void 0,t={TSTRING_SEPARATOR:" ",init:function(){ATON.device={},t.geomUnitSphere=new THREE.SphereGeometry(1,16,16),t.exporterGLTF=void 0,t.exporterOBJ=void 0,t._dlink=document.createElement("a"),t._dlink.style.display="none",document.body.appendChild(t._dlink),t.textureLoader=new THREE.TextureLoader},generateID:function(e){return void 0===e&&(e="id"),e+"-"+Math.random().toString(36).substr(2,9)},goToURL:function(e){window.location.href=e},isConnectionSecure:function(){return window.isSecureContext},profileDevice:function(){ATON.device.isMobile=!1;ATON.device.isMobile=!(!/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(navigator.userAgent)&&!/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(navigator.userAgent.substr(0,4))),ATON.device.xrSupported={},ATON.device.xrSupported["immersive-vr"]=!1,ATON.device.xrSupported["immersive-ar"]=!1,"xr"in navigator&&(navigator.xr.isSessionSupported("immersive-vr").then(function(e){ATON.device.xrSupported["immersive-vr"]=!!e,console.log("WebXR VR session support: "+ATON.device.xrSupported["immersive-vr"])}),navigator.xr.isSessionSupported("immersive-ar").then(function(e){ATON.device.xrSupported["immersive-ar"]=!!e,console.log("WebXR AR session support: "+ATON.device.xrSupported["immersive-ar"])}))},isMobile:function(){return ATON.device.isMobile},isVRsupported:function(){return ATON.device.xrSupported["immersive-vr"]},isARsupported:function(){return ATON.device.xrSupported["immersive-ar"]},getFileExtension:function(e){return e.substr(e.lastIndexOf(".")+1).toLowerCase()},removeFileExtension:function(e){return e.replace(/\.[^/.]+$/,"")},isVideo:function(e){var r=t.getFileExtension(e);return"mp4"===r||("webm"===r||void 0)},getBaseFolder:function(e){var t=e.lastIndexOf("/");return-1!==t?e.substring(0,t+1):""},isResourceURL:function(e){return!!e.startsWith("http://")||!!e.startsWith("https://")},URLify:function(e){var t=e.match(/(((ftp|https?):\/\/)[\-\w@:%_\+.~#?,&\/\/=]+)/g);return t&&t.forEach(function(t){e=e.replace(t,'<a target="_blank" href="'+t+'">'+t+"</a>")}),e},resolveCollectionURL:function(e){return e.startsWith("http")?e:ATON.PATH_COLLECTION+e},postJSON:function(e,t,r,o){$.ajax({url:e,type:"POST",xhrFields:{withCredentials:!0},data:JSON.stringify(t),contentType:"application/json; charset=utf-8",dataType:"json",success:function(e){r&&r(e)}}).fail(function(e){console.log(e),o&&o()})},mergeObject:function(e){e.updateMatrixWorld(!0);var t=[];e.traverse(function(e){if(e.isMesh){var r=e.geometry;r.applyMatrix4(e.matrixWorld),t.push(r.toNonIndexed())}});var r=THREE.BufferGeometryUtils.mergeBufferGeometries(t,!1),o=THREE.BufferGeometryUtils.mergeVertices(r).center(),i=new THREE.Group,n=new THREE.Mesh(o);return i.add(n),i},setPicking:function(e,t,r){void 0===r&&(r=!0),e.traverse(function(e){r?e.layers.enable(t):e.layers.disable(t)})},graphPostVisitor:function(e){e.visible?console.log(e):t.setPicking(e,e.type,!1)},updateTSetsCamera:function(e){void 0===e&&(e=ATON.Nav._camera);var t=ATON._tsets.length;if(!(t<=0))for(var r=0;r<t;r++){var o=ATON._tsets[r];o.setCamera(e),o.setResolutionFromRenderer(e,ATON._renderer)}},loadTileSet:function(e,r){var o=new TILES.TilesRenderer(e);if(o){o.fetchOptions.mode="cors",o.setCamera(ATON.Nav._camera),o.setResolutionFromRenderer(ATON.Nav._camera,ATON._renderer);var i=!1;o.onLoadModel=function(e){i||(ATON._onAllReqsCompleted(),i=!0),e.traverse(function(e){e.isMesh&&(e.castShadow=!0,e.receiveShadow=!0),e.material&&(r.userData.cMat&&(e.material=r.userData.cMat),e.material.map&&(e.material.map.minFilter=THREE.LinearMipmapLinearFilter,e.material.map.magFilter=THREE.LinearFilter))})},o.onDisposeModel=function(e){e.traverse(function(e){e.isMesh&&e.material.dispose()})},r.add(o.group),t.setPicking(r,r.type,!0),ATON._tsets.push(o)}},modelVisitor:function(t,r){if(!r)return e;var o=t,i=o.type;r.traverse(function(e){e.isMesh&&(i===ATON.NTYPES.SCENE&&(e.castShadow=!0,e.receiveShadow=!0,e.geometry&&(e.geometry.computeBoundsTree(),console.log("Computed visible BVH")),null!==e.material.map&&(e.material.map.generateMipmaps=!0,e.material.map.anisotropy=ATON.device.isMobile?0:ATON._maxAnisotropy,e.material.map.minFilter=THREE.LinearMipmapLinearFilter,e.material.map.magFilter=THREE.LinearFilter)),i===ATON.NTYPES.SEM&&(e.material=ATON.MatHub.materials.semanticShape,e.geometry&&(e.geometry.computeBoundsTree(),console.log("Computed semantic BVH"))),o.userData.cMat&&(e.material=o.userData.cMat))})},registerAniMixers:function(e,t){var r=t.scene||t.scene[0],o=!1;if(void 0!==t.animations){var i=new THREE.AnimationMixer(r);t.animations.forEach(function(e){i.clipAction(e).play(),o=!0}),o&&(ATON._aniMixers.push(i),void 0===e._aniMixers&&(e._aniMixers=[]),e._aniMixers.push(i))}},ccExtract:function(e){if(void 0!==e&&void 0!==e.asset&&void 0!==e.asset.extras){var t=e.asset.extras;ATON._ccModels.push(t),console.log(t)}},parseTransformString:function(e){var r=new THREE.Group,o=e.split(t.TSTRING_SEPARATOR),i=o.length;return i<3?r:(r.position.set(parseFloat(o[0]),parseFloat(o[1]),parseFloat(o[2])),i<6?r:(r.rotation.set(parseFloat(o[3]),parseFloat(o[4]),parseFloat(o[5])),i<9?r:(r.scale.set(parseFloat(o[6]),parseFloat(o[7]),parseFloat(o[8])),r)))},setVectorPrecision:function(e,t){return e.x=parseFloat(e.x.toPrecision(t)),e.y=parseFloat(e.y.toPrecision(t)),e.z=parseFloat(e.z.toPrecision(t)),e},checkAuth:function(e){$.ajax({type:"GET",url:ATON.PATH_RESTAPI+"user",xhrFields:{withCredentials:!0},dataType:"json",success:function(t){e(t)}})},getHumanReadableDistance:function(e){var t=" m";return e<.01?(t=" mm",t=(e*=1e3).toPrecision(3)+t):e<1?(t=" cm",t=(e*=100).toPrecision(3)+t):e>1e3?(t=" km",t=e.toPrecision(3)+t):t=e.toPrecision(3)+t},stripHTMLtagsFromString:function(e){return e=e.replace(/(<([^>]+)>)/gi,"")},requestFullscreen:function(){var e=document.documentElement;return e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen(),!0},downloadBlob:function(e,r){void 0!==r&&(t._dlink.href=URL.createObjectURL(e),t._dlink.download=r,t._dlink.click())},downloadText:function(e,r){t.downloadBlob(new Blob([e],{type:"text/plain"}),r)},downloadJSONobj:function(e,r){t.downloadText(JSON.stringify(e),r)},downloadArrayBuffer:function(e,r){t.downloadBlob(new Blob([e],{type:"application/octet-stream"}),r)},exportNode:function(e,r){var o=t.getFileExtension(r);if(!(o.length<1)){if("glb"===o||"gltf"===o){var i={binary:"glb"===o};void 0===t.exporterGLTF&&(t.exporterGLTF=new THREE.GLTFExporter),t.exporterGLTF.parse(e,function(e){e instanceof ArrayBuffer?t.downloadArrayBuffer(e,r):(console.log(e),t.downloadJSONobj(e,r))},i)}if("obj"===o){void 0===t.exporterOBJ&&(t.exporterOBJ=new THREE.OBJExporter);var n=t.exporterOBJ.parse(e);t.downloadText(n,r)}}},takeScreenshot:function(e,r){var o=new Image;console.log("Screenshot with size:"+e),ATON.Nav._camera.aspect=1,ATON.Nav._camera.updateProjectionMatrix(),ATON._renderer.setSize(e,e),ATON._renderer.render(ATON._mainRoot,ATON.Nav._camera);var i=ATON._renderer.domElement.toDataURL();return o.src=i,r&&(t._dlink.href=i.replace("image/png","image/octet-stream"),t._dlink.download=r,t._dlink.click()),ATON._onResize(),o},assignLightProbeToMesh:function(e,t){void 0!==e&&void 0!==t&&(t.noLP||(t.userData.LP=e))},createATONCube:function(e){var r=new THREE.BoxBufferGeometry(1,1,1),o=new THREE.MeshStandardMaterial;t.textureLoader.load(ATON.PATH_RES+"models/aton-cube.jpg",function(e){e.encoding=THREE.sRGBEncoding,o.map=e});var i=ATON.createSceneNode(e);return i.add(new THREE.Mesh(r)),i.setMaterial(o),i.enablePicking(),i},createATONCubePBR:function(e){var r=new THREE.BoxBufferGeometry(1,1,1),o=new THREE.MeshStandardMaterial;o.metalness=1,t.textureLoader.load(ATON.PATH_RES+"models/aton-cube.jpg",function(e){e.encoding=THREE.sRGBEncoding,o.map=e}),t.textureLoader.load(ATON.PATH_RES+"models/aton-cube-pbr.jpg",function(e){e.encoding=THREE.sRGBEncoding,o.metalnessMap=e,o.roughnessMap=e}),t.textureLoader.load(ATON.PATH_RES+"models/aton-cube-nrm.png",function(e){e.encoding=THREE.sRGBEncoding,o.normalMap=e});var i=ATON.createSceneNode(e);return i.add(new THREE.Mesh(r)),i.setMaterial(o),i.enablePicking(),i},createGround:function(e,r,o){void 0===r&&(r=1),void 0===o&&(o=1);var i=new THREE.PlaneBufferGeometry(r,o),n=new THREE.MeshStandardMaterial;void 0!==e&&t.textureLoader.load(e,function(e){e.encoding=THREE.sRGBEncoding,n.map=e});var a=ATON.createSceneNode().rotateX(.5*-Math.PI);return a.add(new THREE.Mesh(i,n)),a.enablePicking(),a}},r=t;exports.default=r;
},{}],"qC8Z":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var o={MODE_ADD:0,MODE_DEL:1,FLOAT_PREC:5,init:function(){o.currID=void 0,o.currData=void 0,o._bEdit=!1,o._bLoading=!1,o._title=void 0,o._descr=void 0,o.initBaseParsers()},setEditMode:function(e){o._bEdit=e,console.log("Edit mode:"+e)},load:function(e,t,r){return o._bLoading=!0,console.log("Loading Scene: "+t),$.getJSON(e,function(e){o.currData=e,o.currID=t,o._bLoading=!1,o.parseScene(e),r&&r(),ATON.fireEvent("SceneJSONLoaded",t)})},parseScene:function(e){if(void 0!==(e=void 0===e?o.currData:e))for(var t in e)o._jsonParsers[t]&&o._jsonParsers[t](e[t])},getJSONchildren:function(o,e){void 0===e&&(e=ATON.NTYPES.SCENE);var t=void 0,r=[];if(e===ATON.NTYPES.SEM&&(t=ATON.getSemanticNode(o)),e===ATON.NTYPES.SCENE&&(t=ATON.getSceneNode(o)),void 0!==t){for(var i in t.children){var a=t.children[i];void 0!==a.nid&&r.push(a.nid)}return r}},getJSONgraphEdges:function(o){void 0===o&&(o=ATON.NTYPES.SCENE);var e=ATON.snodes;o===ATON.NTYPES.SEM&&(e=ATON.semnodes),o===ATON.NTYPES.UI&&(e=ATON.uinodes);var t={};for(var r in e){var i=e[r];i&&i.parent&&i.parent.nid&&(void 0===t[i.parent.nid]&&(t[i.parent.nid]=[]),t[i.parent.nid].push(i.nid))}return t},getJSONsemanticSpheresList:function(e){var t=ATON.getSemanticNode(e);if(void 0!==t){var r=[];for(var i in t.children){var a=t.children[i];a.type&&r.push([parseFloat(a.position.x.toPrecision(o.FLOAT_PREC)),parseFloat(a.position.y.toPrecision(o.FLOAT_PREC)),parseFloat(a.position.z.toPrecision(o.FLOAT_PREC)),parseFloat(a.scale.x.toPrecision(o.FLOAT_PREC))])}return r}},getJSONsemanticConvexShapes:function(o){var e=ATON.getSemanticNode(o);if(void 0!==e){var t=[];for(var r in e.children){var i=e.children[r];i.userData._convexPoints&&t.push(i.userData._convexPoints)}return t}},initBaseParsers:function(){o._jsonParsers={},o._jsonParsers.title=function(e){void 0!==e&&o.setTitle(e)},o._jsonParsers.description=function(e){void 0!==e&&o.setDescription(e)},o._jsonParsers.environment=function(o){var e=o.mainpano;o.mainpano&&(e.url&&ATON.setMainPanorama(e.url),e.rotation&&ATON.setMainPanoramaRotation(e.rotation)),o.bgcolor&&ATON.setBackgroundColor(new THREE.Color(o.bgcolor[0],o.bgcolor[1],o.bgcolor[2]));var t=o.mainlight;t?(t.direction&&ATON.setMainLightDirection(new THREE.Vector3(t.direction[0],t.direction[1],t.direction[2])),ATON._dMainL?(t.color&&(ATON._dMainL.color=new THREE.Color(t.color[0],t.color[1],t.color[2])),t.intensity&&(ATON._dMainL.intensity=t.intensity),void 0!==t.shadows?ATON.toggleShadows(t.shadows):ATON.toggleShadows(!1)):ATON.toggleMainLight(!1)):ATON.toggleMainLight(!1);var r=o.lightprobes;r&&r.auto&&ATON.setAutoLP(!0),o.exposure&&ATON.setExposure(o.exposure)},o._jsonParsers.soundscape=function(o){void 0!==o&&o.global&&ATON.setGlobalAudio(o.global.url,o.global.loop)},o._jsonParsers.navmode=function(o){void 0!==o&&ATON.Nav.setNavMode(o)},o._jsonParsers.measurements=function(o){if(void 0!==o)for(var e in o){var t=o[e];if(t.points&&6===t.points.length){var r=new THREE.Vector3(parseFloat(t.points[0]),parseFloat(t.points[1]),parseFloat(t.points[2])),i=new THREE.Vector3(parseFloat(t.points[3]),parseFloat(t.points[4]),parseFloat(t.points[5]));ATON.SUI.addMeasurementPoint(r),ATON.SUI.addMeasurementPoint(i)}}},o._jsonParsers.viewpoints=function(o){if(void 0!==o)for(var e in o){var t=o[e];"home"===e?ATON.Nav.setHomePOV((new ATON.POV).setPosition(t.position[0],t.position[1],t.position[2]).setTarget(t.target[0],t.target[1],t.target[2]).setFOV(t.fov)):new ATON.POV(e).setPosition(t.position[0],t.position[1],t.position[2]).setTarget(t.target[0],t.target[1],t.target[2]).setFOV(t.fov)}},o._jsonParsers.scenegraph=function(o){if(void 0!==o){var e=o.nodes,t=o.edges,r=function(o){var t=e[o],r=ATON.getOrCreateSceneNode(o).removeChildren(),i=t.transform;i&&(i.position&&r.setPosition(i.position[0],i.position[1],i.position[2]),i.rotation&&r.setRotation(i.rotation[0],i.rotation[1],i.rotation[2]),i.scale&&r.setScale(i.scale[0],i.scale[1],i.scale[2]),i.list&&Array.isArray(i.list));var a=t.urls;a&&(Array.isArray(a)?a.forEach(function(o){ATON.createSceneNode().load(o).attachTo(r)}):r.load(a)),t.shadowcast&&r.setShadowCast(t.shadowcast),t.shadowreceive&&r.setShadowCast(t.shadowreceive),t.toYup&&r.setYup(),t.keywords&&(r.kwords=t.keywords)};for(var i in e)r(i);for(var a in t){var n=t[a],s=ATON.getSceneNode(a);if(void 0!==s)for(var d in n){var c=n[d],v=ATON.getSceneNode(c);void 0!==v&&v.attachTo(s)}}for(var l in e){var p=e[l],u=ATON.getSceneNode(l);if(void 0!==u&&(void 0!==p.show&&(p.show?(u.show(),console.log("show "+l)):(u.hide(),console.log("hide "+l))),p.material)){var T=new THREE.MeshStandardMaterial(p.material);u.setMaterial(T)}}}},o._jsonParsers.semanticgraph=function(o){if(void 0!==o){var e=o.nodes,t=o.edges,r=function(o){var t=e[o],r=ATON.getOrCreateSemanticNode(o).removeChildren(),i=t.urls;i&&(Array.isArray(i)?i.forEach(function(o){ATON.createSemanticNode().load(o).attachTo(r)}):r.load(i)),t.toYup&&r.setYup(),t.description&&r.setDescription(t.description),t.audio&&r.setAudio(t.audio),t.keywords&&(r.kwords=t.keywords);var a=t.spheres;if(Array.isArray(a))for(var n in a){var s=a[n],d=new THREE.Vector3(parseFloat(s[0]),parseFloat(s[1]),parseFloat(s[2]));ATON.SemFactory.createSphere(o,d,parseFloat(s[3]))}var c=t.convexshapes;if(Array.isArray(c))for(var v in c){for(var l=c[v],p=[],u=0;u<l.length;u+=3){var T=new THREE.Vector3(l[u],l[u+1],l[u+2]);p.push(T)}ATON.SemFactory.createConvexShape(o,p)}};for(var i in e)r(i);for(var a in t){var n=t[a],s=ATON.getSemanticNode(a);if(void 0!==s)for(var d in n){var c=n[d],v=ATON.getSemanticNode(c);void 0!==v&&v.attachTo(s)}}for(var l in e){var p=e[l],u=ATON.getSemanticNode(l);if(void 0!==u&&(void 0!==p.show&&(p.show?(u.show(),console.log("show "+l)):(u.hide(),console.log("hide "+l))),p.nopicking&&u.disablePicking(),p.material)){var T=new THREE.MeshStandardMaterial(p.material);u.setMaterial(T)}}}}},addSceneParser:function(e,t){o._jsonParsers[e]=t},sendEdit:function(e,t,r){if(!o._bLoading&&o._bEdit&&void 0!==e){void 0===t&&(t=o.MODE_ADD);var i=o.currID,a={};a.sid=i,a.data=e,a.mode=t===o.MODE_DEL?"DEL":"ADD";var n=JSON.stringify(a);$.ajax({url:ATON.PATH_RESTAPI+"edit/scene",type:"POST",data:n,contentType:"application/json; charset=utf-8",dataType:"json",success:function(e){e&&(o.currData=e),r&&r()}})}},setTitle:function(e){o._title=e},getTitle:function(){return o._title},setDescription:function(e){o._descr=e},getDescription:function(){return o._descr}},e=o;exports.default=e;
},{}],"mYhb":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e={init:function(){e._listener=new THREE.AudioListener,e._loader=new THREE.AudioLoader},playOnceGlobally:function(o){o=ATON.Utils.resolveCollectionURL(o);var t=new THREE.Audio(ATON.AudioHub._listener);e._loader.load(o,function(e){t.setBuffer(e),t.play()})}},o=e;exports.default=o;
},{}],"nomA":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=function(e){return(1-Math.cos(e*Math.PI))/2},t={STD_FOV:50,STD_NEAR:.01,STD_FAR:800,FP_EPS:.01,STD_POV_TRANS_DURATION:2,MODE_ORBIT:0,MODE_FP:1,MODE_DEVORI:2,init:function(){t._mode=void 0,t.POVtransitionDuration=t.STD_POV_TRANS_DURATION,t._rotSpeedOrbit=.4,t._rotSpeedFP=-.2,t._inertia=.08,t._bControl=!0,t._bInteracting=!1,t._prevMode=void 0,t.setOrbitControl(),t._currPOV=(new ATON.POV).setFOV(ATON.Nav.STD_FOV),t._fromPOV=new ATON.POV,t._reqPOV=new ATON.POV,t.homePOV=void 0,t._tPOVcall=-1,t._tPOVprogress=0,t.povlist={},t._vDir=new THREE.Vector3(1,0,0),t._qOri=new THREE.Quaternion,t._motionAmt=0,t._motionDir=new THREE.Vector3(0,1,0),t._bValidLocomotion=!1},getCurrentEyeLocation:function(){return t._currPOV.pos},getCurrentDirection:function(){return t._vDir},copyCurrentPOV:function(){var e=new ATON.POV;return e.pos.copy(t._currPOV.pos),e.target.copy(t._currPOV.target),e.fov=t._currPOV.fov,e},addPOV:function(e,t){if(void 0!==e)return e.as(t),e},isTransitioning:function(){return t._tPOVcall>=0},currentQueryValidForLocomotion:function(){return t._bValidLocomotion},locomotionValidator:function(){if(void 0!==ATON._queryDataScene){ATON._queryDataScene.p;ATON._queryDataScene.n.y<=.7?t._bValidLocomotion=!1:t._bValidLocomotion=!0}else t._bValidLocomotion=!1},setUserControl:function(e){void 0!==e&&e!==t._bControl&&(t._bControl=e,void 0!==t._controls&&(t._controls.enabled=e),t._cOrbit&&(t._cOrbit.enabled=e),t._cFirstPerson&&(t._cFirstPerson.enabled=e),console.log("Nav controls: "+t._bControl))},toggleUserControl:function(){t.setUserControl(!t._bControl)},isUserControlEnabled:function(){return t._bControl},isOrbit:function(){return t._mode===t.MODE_ORBIT},isFirstPerson:function(){return t._mode===t.MODE_FP},isDevOri:function(){return t._mode===t.MODE_DEVORI},setNavMode:function(e){void 0!==e&&(e===t.MODE_ORBIT&&t.setOrbitControl(),e===t.MODE_FP&&t.setFirstPersonControl(),e===t.MODE_DEVORI&&t.setDeviceOrientationControl())},restorePreviousNavMode:function(){void 0===t._prevMode&&t.setOrbitControl(),t.setNavMode(t._prevMode)},setOrbitControl:function(){if(!ATON.XR.isPresenting()){if(t._prevMode=t._mode,t._mode=t.MODE_ORBIT,t._bInteracting=!1,void 0===t._cOrbit){t._camOrbit=new THREE.PerspectiveCamera(t.STD_FOV,window.innerWidth/window.innerHeight,t.STD_NEAR,t.STD_FAR),t._camOrbit.layers.enableAll(),t._cOrbit=new THREE.OrbitControls(t._camOrbit,ATON._renderer.domElement);var e=t._cOrbit;e.rotateSpeed=t._rotSpeedOrbit,e.enablePan=!0,t._inertia>0&&(e.enableDamping=!0,e.dampingFactor=t._inertia),e.screenSpacePanning=!0,e.enableZoom=!0,e.minDistance=.03,e.maxDistance=100,t._bControl||(e.enabled=!1),e.addEventListener("start",function(){t._bInteracting=!0}),e.addEventListener("end",function(){t._bInteracting=!1})}t._controls=t._cOrbit,t._camera=t._camOrbit,ATON.AudioHub._listener&&t._camera.children.length<1&&t._camera.add(ATON.AudioHub._listener),ATON.Utils.updateTSetsCamera(),t._controls.update(),t._currPOV&&t.syncCurrCamera(),ATON._onResize(),ATON.fireEvent("NavMode",t._mode)}},setFirstPersonControl:function(){if(!ATON.XR.isPresenting()){if(t._prevMode=t._mode,ATON.SUI.getSelectorRadius()>.5&&ATON.SUI.setSelectorRadius(.5),t._mode=t.MODE_FP,t._bInteracting=!1,void 0===t._cFirstPerson){t._camFP=new THREE.PerspectiveCamera(t.STD_FOV,window.innerWidth/window.innerHeight,t.STD_NEAR,t.STD_FAR),t._camFP.layers.enableAll(),t._cFirstPerson=new THREE.OrbitControls(t._camFP,ATON._renderer.domElement);var e=t._cFirstPerson;e.enableZoom=!1,e.enablePan=!1,e.rotateSpeed=t._rotSpeedFP,t._inertia>0&&(e.enableDamping=!0,e.dampingFactor=t._inertia),e.target.copy(t._camera.position),e.minDistance=.01,e.maxDistance=.01,t._bControl||(e.enabled=!1)}t._controls=t._cFirstPerson,t._camera=t._camFP,ATON.AudioHub._listener&&t._camera.children.length<1&&t._camera.add(ATON.AudioHub._listener),ATON.Utils.updateTSetsCamera(),t._controls.update(),t._currPOV&&t.syncCurrCamera(),ATON._onResize(),ATON.fireEvent("NavMode",t._mode)}},setDeviceOrientationControl:function(){ATON.Utils.isMobile()&&(t._prevMode=t._mode,t._mode=t.MODE_DEVORI,t._bInteracting=!1,ATON._screenPointerCoords.set(0,0),void 0===t._cDevOri&&(t._camDevOri=new THREE.PerspectiveCamera(t.STD_FOV,window.innerWidth/window.innerHeight,t.STD_NEAR,t.STD_FAR),t._camDevOri.layers.enableAll(),t._cDevOri=new THREE.DeviceOrientationControls(t._camDevOri,ATON._renderer.domElement),t._cDevOri.alphaOffset=0),t._controls=t._cDevOri,t._camera=t._camDevOri,ATON.AudioHub._listener&&t._camera.children.length<1&&t._camera.add(ATON.AudioHub._listener),ATON.Utils.updateTSetsCamera(),t._controls.update(),t._currPOV&&t.syncCurrCamera(),ATON._onResize(),ATON.fireEvent("NavMode",t._mode))},setMotionAmount:function(e){t._motionAmt=e},setMotionDirection:function(e){t._motionDir.copy(e)},stop:function(){t._motionAmt=0},setFOV:function(e){if(!ATON.XR.isPresenting()){t._currPOV.fov=e;var r=t._camera;r.fov=e,r.updateProjectionMatrix()}},getFOV:function(){return t._currPOV.fov},syncCurrPOV:function(){if(ATON.XR.isPresenting())return ATON.XR._cam=ATON._renderer.xr.getCamera(t._camera),ATON.XR._cam.getWorldPosition(t._currPOV.pos),ATON.XR._cam.getWorldQuaternion(t._qOri),void ATON.XR._cam.getWorldDirection(t._vDir);var e=t._controls,r=t._camera;if(r.getWorldDirection(t._vDir),r.getWorldQuaternion(t._qOri),t._mode!==t.MODE_DEVORI){if(t._mode===t.MODE_FP)return t._currPOV.pos.copy(e.target),t._currPOV.target.x=t._currPOV.pos.x+t._vDir.x,t._currPOV.target.y=t._currPOV.pos.y+t._vDir.y,void(t._currPOV.target.z=t._currPOV.pos.z+t._vDir.z);t._currPOV.pos.copy(r.position),t._currPOV.target.copy(e.target)}else t._currPOV.pos.copy(r.position)},handlePOV:function(){ATON.XR.isPresenting()?t.handleXRtransition():t.handlePOVtransition()},handleMotion:function(){if(!t.isTransitioning()&&0!=t._motionAmt){ATON.XR.controller0&&ATON.XR.controller0.visible?(ATON.XR.controller0.getWorldDirection(t._motionDir),t._motionDir.negate()):t._motionDir.copy(t._vDir);var e=t._motionDir.clone();e.multiplyScalar(t._motionAmt*ATON._dt),t._currPOV.pos.add(e),t._currPOV.target.add(e)}},handlePOVtransition:function(){if(!(t._tPOVcall<0)){if(t.POVtransitionDuration<=0?t._tPOVprogress=1:t._tPOVprogress=(ATON._clock.elapsedTime-t._tPOVcall)/t.POVtransitionDuration,t._tPOVprogress>=1)return t._tPOVcall=-1,t._currPOV.pos.copy(t._reqPOV.pos),t._currPOV.target.copy(t._reqPOV.target),t._currPOV.fov=t._reqPOV.fov,void ATON.fireEvent("POVTransitionCompleted",t._reqPOV.id);t._tPOVprogress=e(t._tPOVprogress),t._currPOV.pos.lerpVectors(t._fromPOV.pos,t._reqPOV.pos,t._tPOVprogress),t._currPOV.target.lerpVectors(t._fromPOV.target,t._reqPOV.target,t._tPOVprogress),t._fromPOV.fov&&t._reqPOV.fov&&(t._currPOV.fov=THREE.MathUtils.lerp(t._fromPOV.fov,t._reqPOV.fov,t._tPOVprogress),t._camera.fov=t._currPOV.fov,t._camera.updateProjectionMatrix())}},handleXRtransition:function(){if(!(t._tPOVcall<0)){if(t.POVtransitionDuration<=0?t._tPOVprogress=1:t._tPOVprogress=(ATON._clock.elapsedTime-t._tPOVcall)/t.POVtransitionDuration,t._tPOVprogress>=1)return t._tPOVcall=-1,ATON.XR._currPos.copy(ATON.XR._reqPos),console.log("XR height"+ATON.XR._currPos.y),console.log("HMD height"+t._currPOV.pos.y),void ATON.fireEvent("POVTransitionCompleted",t._reqPOV.id);ATON.XR._currPos.lerpVectors(ATON.XR._fromPos,ATON.XR._reqPos,t._tPOVprogress)}},syncCurrCamera:function(){if(!ATON.XR.isPresenting()){var e=t._controls,r=t._camera,o=t._currPOV.pos,n=t._currPOV.target;t._mode!==t.MODE_DEVORI?(t._vDir.subVectors(n,o),t._vDir.normalize(),t._mode===t.MODE_FP?(e.target.copy(o),r.position.x=e.target.x-t._vDir.x*t.FP_EPS,r.position.y=e.target.y-t._vDir.y*t.FP_EPS,r.position.z=e.target.z-t._vDir.z*t.FP_EPS):(r.position.copy(o),e.target.copy(n))):r.position.copy(o)}},update:function(){t.syncCurrPOV(),t.handlePOV(),t.syncCurrCamera()},requestPOV:function(e,r){ATON._tPOVcall>=0||void 0!==e&&(ATON.fireEvent("POVTransitionRequested",e.id),void 0!==r&&(t.POVtransitionDuration=r),t._tPOVcall=ATON._clock.elapsedTime,ATON.XR.isPresenting()?(t._reqPOV.pos.copy(e.pos?e.pos:t._currPOV.pos),t._fromPOV.pos.copy(t._currPOV.pos),ATON.XR._reqPos.copy(e.pos?e.pos:t._currPOV.pos),ATON.XR._fromPos.copy(ATON.XR._currPos)):(t._reqPOV.pos.copy(e.pos?e.pos:t._currPOV.pos),t._reqPOV.target.copy(e.target?e.target:t._currPOV.target),t._reqPOV.fov=e.fov?e.fov:t._currPOV.fov,t._fromPOV.pos.copy(t._currPOV.pos),t._fromPOV.target.copy(t._currPOV.target),t._fromPOV.fov=t._currPOV.fov))},requestPOVbyBound:function(e,r){if(void 0!==e){var o=new THREE.Vector3,n=3*e.radius;o.x=e.center.x-n*t._vDir.x,o.y=e.center.y-n*t._vDir.y,o.z=e.center.z-n*t._vDir.z;var i=(new ATON.POV).setPosition(o).setTarget(e.center);t.requestPOV(i,r)}},requestPOVbyNode:function(e,r){if(void 0!==e){var o=e.getBound();t.requestPOVbyBound(o,r)}},requestRetarget:function(e,r,o){var n=new THREE.Vector3;if(void 0===r)n.lerpVectors(e,t._currPOV.pos,.8);else{var i=e.distanceTo(t._currPOV.pos);i*=.5,n.x=e.x+r.x*i,n.y=e.y+r.y*i,n.z=e.z+r.z*i}var a=(new ATON.POV).setPosition(n).setTarget(e).setFOV(t._currPOV.fov);console.log(a),t.requestPOV(a,o)},computeDefaultHome:function(e){void 0===e&&(e=new THREE.Vector3(1,.7,1));var r=ATON.getRootScene().getBound(),o=new THREE.Vector3(r.center.x+r.radius*e.x*1.5,r.center.y+r.radius*e.y*1.5,r.center.z+r.radius*e.z*1.5);t.homePOV=(new ATON.POV).setPosition(o).setTarget(r.center)},setHomePOV:function(e){t.homePOV=e},computeAndRequestDefaultHome:function(e,r){t.computeDefaultHome(r),t.requestPOV(t.homePOV,e)},requestHome:function(e){t.requestPOV(t.homePOV,e)},setAndRequestHomePOV:function(e,r){t.setHomePOV(e),t.requestPOV(e,r)},DeviceOrientationControls:function(e){var t=this;this.object=e,this.object.rotation.reorder("YXZ"),this.enabled=!0,this.deviceOrientation={},this.screenOrientation=0,this.alphaOffset=0,this.absolute=!1,this.alphaOffsetDevice=void 0,this.alphaOffsetScreen=void 0;var r,o,n,i,a=function(e){t.absolute||(t.deviceOrientation=e)},s=function(e){t.deviceOrientation=e,t.absolute=!0},c=function(){t.screenOrientation=window.orientation||0},_=(r=new THREE.Vector3(0,0,1),o=new THREE.Euler,n=new THREE.Quaternion,i=new THREE.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5)),function(e,t,a,s,c){o.set(a,t,-s,"YXZ"),e.setFromEuler(o),e.multiply(i),e.multiply(n.setFromAxisAngle(r,-c))});this.connect=function(){c(),window.addEventListener("orientationchange",c,!1),window.addEventListener("deviceorientation",a,!1),window.addEventListener("deviceorientationabsolute",s,!1),t.enabled=!0},this.disconnect=function(){window.removeEventListener("orientationchange",c,!1),window.removeEventListener("deviceorientation",a,!1),window.removeEventListener("deviceorientationabsolute",s,!1),t.enabled=!1},this.update=function(){var e;if(!1!==t.enabled&&(e=t.deviceOrientation)){var r=this.getDirection()?THREE.Math.degToRad(this.getDirection())+t.alphaOffset:0,o=e.beta?THREE.Math.degToRad(e.beta):0,n=e.gamma?THREE.Math.degToRad(e.gamma):0,i=t.screenOrientation?THREE.Math.degToRad(t.screenOrientation):0;_(t.object.quaternion,r,o,n,i)}},this.dispose=function(){t.disconnect()},this.iOSOrientationPermission=function(){"function"==typeof DeviceOrientationEvent.requestPermission&&DeviceOrientationEvent.requestPermission().then(function(e){console.log(e)}).catch(console.error)},this.getDirection=function(){return void 0!==t.deviceOrientation.webkitCompassHeading?t.deviceOrientation.webkitCompassHeading:t.deviceOrientation.alpha},this.getDirectionMap=function(){return void 0!==t.deviceOrientation.webkitCompassHeading?360-t.deviceOrientation.webkitCompassHeading:t.deviceOrientation.alpha},this.connect()}},r=t;exports.default=r;
},{}],"jROx":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e={STD_TELEP_DURATION:.03,HAND_R:0,HAND_L:1,MOBILE_DENSITY_F:.5,init:function(){ATON._renderer.xr.enabled=!0,ATON._renderer.xr.setReferenceSpaceType("local"),ATON.device.isMobile?ATON._renderer.xr.setFramebufferScaleFactor(ATON._stdpxd*e.MOBILE_DENSITY_F):ATON._renderer.xr.setFramebufferScaleFactor(ATON._stdpxd),e._bPresenting=!1,e.currSession=null,e._sessionType="immersive-vr",e.rig=new THREE.Group,e.rig.add(ATON.Nav._camera),ATON._rootUI.add(e.rig),e._cam=void 0,e._currPos=e.rig.position,e._fromPos=new THREE.Vector3,e._reqPos=new THREE.Vector3,e.gControllers=void 0,e.controller0=void 0,e.controller1=void 0,e.controller0pos=new THREE.Vector3,e.controller1pos=new THREE.Vector3,e.controller0dir=new THREE.Vector3,e.controller1dir=new THREE.Vector3,e._lastPosR=void 0,e._lastPosL=void 0,e._pointerLineGeom=void 0,e._pointerLineMesh=void 0,e.gpad0=void 0,e.gpad1=void 0,e._urlHand=ATON.PATH_RES+"models/hand/hand.glb",ATON.on("XRselectStart",function(o){o===e.HAND_R&&ATON._stdActivation()}),ATON.on("XRselectEnd",function(e){}),ATON.on("XRsqueezeStart",function(e){console.log("Squeeze "+e)}),ATON.on("VRC_IDassigned",function(e){var o=ATON.getUINode("Rhand"),r=ATON.getUINode("Lhand"),t=ATON.MatHub.materials.avatars,n=t[e%t.length];r&&r.setMaterial(n),o&&o.setMaterial(n)})},setSessionType:function(o){void 0!==o&&(e._sessionType=o,console.log("Session type: "+o))},isPresenting:function(){return e._bPresenting},teleportOnQueriedPoint:function(){if(!ATON.Nav.currentQueryValidForLocomotion())return!1;var o=ATON._queryDataScene.p;return ATON.Nav.requestPOV((new ATON.POV).setPosition(o.x,o.y+ATON.userHeight,o.z),e.STD_TELEP_DURATION),!0},setupQueryRay:function(o){void 0!==o&&(e.controller0?o.set(e.controller0pos,e.controller0dir):o.set(ATON.Nav.getCurrentEyeLocation(),ATON.Nav.getCurrentDirection()))},setRefSpaceLocation:function(o){e.rig.position.copy(o)},_setupControllerR:function(o,r){e.controller0||(e.controller0=o,console.log("R controller"),o.addEventListener("selectstart",function(){ATON.fireEvent("XRselectStart",e.HAND_R)}),o.addEventListener("selectend",function(){ATON.fireEvent("XRselectEnd",e.HAND_R)}),o.addEventListener("squeezestart",function(){ATON.fireEvent("XRsqueezeStart",e.HAND_R)}),o.addEventListener("squeezeend",function(){ATON.fireEvent("XRsqueezeEnd",e.HAND_R)}),e.setupControllerUI(e.HAND_R,r),ATON.fireEvent("XRcontrollerConnected",e.HAND_R))},_setupControllerL:function(o,r){e.controller1||(e.controller1=o,console.log("L controller"),o.addEventListener("selectstart",function(){ATON.fireEvent("XRselectStart",e.HAND_L)}),o.addEventListener("selectend",function(){ATON.fireEvent("XRselectEnd",e.HAND_L)}),o.addEventListener("squeezestart",function(){ATON.fireEvent("XRsqueezeStart",e.HAND_L)}),o.addEventListener("squeezeend",function(){ATON.fireEvent("XRsqueezeEnd",e.HAND_L)}),e.setupControllerUI(e.HAND_L,r),ATON.fireEvent("XRcontrollerConnected",e.HAND_L))},onSessionStarted:function(o){e.currSession||(o.addEventListener("end",e.onSessionEnded),console.log(e._sessionType+" session started."),ATON.SUI.getSelectorRadius()>.5&&ATON.SUI.setSelectorRadius(.5),ATON.MediaRec.stopMediaStreaming(),ATON._renderer.xr.setSession(o).then(function(){e.currSession=o,console.log(e.currSession),"immersive-ar"===e._sessionType&&(ATON._mainRoot.background=null,ATON._mMainPano&&(ATON._mMainPano.visible=!1));for(var r=function(o){var r=ATON._renderer.xr.getController(o);void 0===r||r.userData.bXRconfig||(r.visible=!1,r.userData.bXRconfig=!0,r.addEventListener("connected",function(o){var t=o.data.handedness;console.log("Hand "+t),"left"===t?e._setupControllerL(r,!0):"right"===t?e._setupControllerR(r,!0):(r.addEventListener("selectstart",function(){ATON.fireEvent("XRselectStart",e.HAND_R),console.log("Head-aligned select")}),r.addEventListener("selectend",function(){ATON.fireEvent("XRselectEnd",e.HAND_R)}),ATON.fireEvent("XRcontrollerConnected",e.HAND_R))}))},t=0;t<2;t++)r(t);e.rig.add(ATON.Nav._camera),ATON.Utils.updateTSetsCamera(),e.setRefSpaceLocation(ATON.Nav._currPOV.pos),console.log(ATON.Nav._currPOV.pos),e._bPresenting=!0,console.log("XR now presenting"),ATON.fireEvent("XRmode",!0)}))},onSessionEnded:function(){e.currSession.removeEventListener("end",e.onSessionEnded),e.currSession=null,e._bPresenting=!1,e.setRefSpaceLocation(new THREE.Vector3(0,0,0)),ATON.fireEvent("XRmode",!1),ATON.MediaRec.stopMediaStreaming(),ATON.Nav.requestHome(),console.log("Quit XR")},toggle:function(){if(ATON.device.xrSupported[e._sessionType])if(null===e.currSession){navigator.xr.requestSession(e._sessionType,{optionalFeatures:[]}).then(e.onSessionStarted)}else e.currSession.end()},setupControllerUI:function(o,r){var t=void 0,n=void 0;if(void 0===e.gControllers&&(e.gControllers=ATON.createUINode(),e.gControllers.disablePicking(),e.rig.add(e.gControllers)),o===e.HAND_L?(e.gControllers.add(e.controller1),r&&(n=ATON.createUINode("Lhand").load(e._urlHand).setMaterial(ATON.MatHub.materials.controllerRay).setScale(-1,1,1),e.controller1.add(n))):(e.gControllers.add(e.controller0),r&&(e._pointerLineGeom=new THREE.CylinderBufferGeometry(.003,.003,1,4),e._pointerLineGeom.rotateX(-Math.PI/2),e._pointerLineGeom.translate(0,0,-.5),e._pointerLineMesh=new THREE.Mesh(e._pointerLineGeom,ATON.MatHub.materials.controllerRay),e.controller0.add(e._pointerLineMesh),e._pointerLineMesh.visible=!1,t=ATON.createUINode("Rhand").load(e._urlHand).setMaterial(ATON.MatHub.materials.controllerRay),e.controller0.add(t))),void 0!==ATON.VRoadcast.uid&&r){var l=ATON.MatHub.materials.avatars,i=l[ATON.VRoadcast.uid%l.length];o===e.HAND_L?n.setMaterial(i):t.setMaterial(i)}},switchHands:function(){var o=e.controller1;for(var r in e.controller1=e.controller0,e.controller0=o,e.controller0.children)e.controller0.remove(e.controller0.children[r]);for(var t in e.controller1.children)e.controller1.remove(e.controller1.children[t]);e.gControllers.removeChildren(),e.setupControllerUI(e.HAND_L),e.setupControllerUI(e.HAND_R),console.log("VR controllers switched")},getControllerSpace:function(o){1===o?e.getControllerGrip(1):e.getControllerGrip(0)},getControllerWorldLocation:function(o){return 1===o?e.controller1pos:e.controller0pos},getControllerWorldDirection:function(o){return 1===o?e.controller1dir:e.controller0dir},_deltaMotionController:function(o){if(!(o===e.HAND_L&&void 0===e._lastPosL||o===e.HAND_R&&void 0===e._lastPosR)){var r=o===e.HAND_L?e.controller1pos:e.controller0pos,t=o===e.HAND_L?e._lastPosL:e._lastPosR;THREE.Vector3(r.x-t.x,r.y-t.y,r.z-t.z).lengthSq();o===e.HAND_L?e._lastPosL=r:e._lastPosR=r}},update:function(){e.controller0&&e.controller0.visible&&(e.controller0.getWorldPosition(e.controller0pos),e.controller0.getWorldDirection(e.controller0dir),e.controller0dir.negate()),e.controller1&&e.controller1.visible&&(e.controller1.getWorldPosition(e.controller1pos),e.controller1.getWorldDirection(e.controller1dir),e.controller1dir.negate())}},o=e;exports.default=o;
},{}],"fWYX":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t=e(require("./ATON.node.js"));function e(t){return t&&t.__esModule?t:{default:t}}function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function i(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t}function c(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&a(t,e)}function a(t,e){return(a=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function u(t){var e=f();return function(){var n,o=h(t);if(e){var r=h(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return s(this,n)}}function s(t,e){return!e||"object"!==n(e)&&"function"!=typeof e?l(t):e}function l(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function f(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}function h(t){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var p=function(e){c(r,t.default);var n=u(r);function r(t){var e,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;o(this,r),(e=n.call(this,t,ATON.NTYPES.UI)).baseColor=ATON.MatHub.colors.black,e.switchColor=ATON.MatHub.colors.green,e.baseOpacity=.5,e.hoverOpacity=.8,e._bSwitched=!1,e.container=new ThreeMeshUI.Block({width:.1*i,height:.1,padding:.01,borderRadius:.02,backgroundColor:e.baseColor,backgroundOpacity:e.baseOpacity,fontFamily:ATON.SUI.PATH_FONT_JSON,fontTexture:ATON.SUI.PATH_FONT_TEX,justifyContent:"center",alignContent:"center"}),e.add(e.container),e.uiText=new ThreeMeshUI.Text({content:"",fontSize:.02*c,fontColor:ATON.MatHub.colors.white}),e.container.add(e.uiText);var a=.9*ATON.SUI.STD_BTN_SIZE*i,u=.9*ATON.SUI.STD_BTN_SIZE;return e._trigger=new THREE.Mesh(new THREE.PlaneGeometry(a,u,2),ATON.MatHub.materials.fullyTransparent),e._trigger.position.set(0,0,.002),e.add(e._trigger),e.onHover=function(){e.container.set({backgroundOpacity:e.hoverOpacity})},e.onLeave=function(){e.container.set({backgroundOpacity:e.baseOpacity})},e.enablePicking(),e}return i(r,[{key:"setBaseColor",value:function(t){return this.baseColor=t,this._bSwitched||this.container.set({backgroundColor:this.baseColor}),this}},{key:"setSwitchColor",value:function(t){return this.switchColor=t,this._bSwitched&&this.container.set({backgroundColor:this.switchColor}),this}},{key:"setBackgroundOpacity",value:function(t){return this.container.set({backgroundOpacity:t}),this.baseOpacity=t,this}},{key:"setText",value:function(t){return this.uiText.set({content:t}),this}},{key:"switch",value:function(t){return this._bSwitched=t,t?this.container.set({backgroundColor:this.switchColor}):this.container.set({backgroundColor:this.baseColor}),this}},{key:"setIcon",value:function(t,e){var n=this;return ATON.Utils.textureLoader.load(t,function(t){n._trigger.material=new THREE.MeshStandardMaterial({map:t,transparent:!0,depthWrite:!1}),e&&(n.setBackgroundOpacity(0),n.hoverOpacity=0),n.uiText.position.set(0,-.035,0)}),this}}]),r}(),y=p;exports.default=y;
},{"./ATON.node.js":"XTSP"}],"iqtl":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t=e(require("./ATON.node.js"));function e(t){return t&&t.__esModule?t:{default:t}}function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function u(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&c(t,e)}function c(t,e){return(c=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function f(t){var e=s();return function(){var n,o=p(t);if(e){var r=p(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return a(this,n)}}function a(t,e){return!e||"object"!==n(e)&&"function"!=typeof e?l(t):e}function l(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function s(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}function p(t){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var y=function(e){i(r,t.default);var n=f(r);function r(t){var e;return o(this,r),(e=n.call(this,t,ATON.NTYPES.UI)).baseColor=ATON.MatHub.colors.black,e.container=new ThreeMeshUI.Block({width:.2,height:.05,padding:.001,borderRadius:.01,backgroundColor:e.baseColor,backgroundOpacity:.5,fontFamily:ATON.SUI.PATH_FONT_JSON,fontTexture:ATON.SUI.PATH_FONT_TEX,justifyContent:"center",alignContent:"center"}),e.container.position.z=.05,e.add(e.container),e.uiText=new ThreeMeshUI.Text({content:"Label",fontSize:.03,fontColor:ATON.MatHub.colors.white}),e.container.add(e.uiText),e}return u(r,[{key:"setBaseColor",value:function(t){return this.baseColor=t,this.container.set({backgroundColor:this.baseColor}),this}},{key:"setTextColor",value:function(t){return this.uiText.set({fontColor:t}),this}},{key:"setText",value:function(t){return this.uiText.set({content:t}),this}}]),r}(),b=y;exports.default=b;
},{"./ATON.node.js":"XTSP"}],"xSlA":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=t(require("./ATON.sui.button.js")),o=t(require("./ATON.sui.label.js"));function t(e){return e&&e.__esModule?e:{default:e}}var n={STD_BTN_SIZE:.1};n.Button=e.default,n.Label=o.default,n.init=function(){n.mainSelector=ATON.createUINode(),n._mSelectorSphere=new THREE.Mesh(ATON.Utils.geomUnitSphere,ATON.MatHub.getMaterial("selector")),n._mSelectorSphere.renderOrder=100,n.mainSelector.add(n._mSelectorSphere),n.mainSelector.disablePicking(),n.setSelectorRadius(.05),n.mainSelector.visible=!1,ATON._rootUI.add(n.mainSelector),n.fpTeleport=ATON.createUINode();var e=new THREE.CylinderBufferGeometry(.4,.4,.9,32,1,!0),o=new THREE.Mesh(e,ATON.MatHub.getMaterial("teleportLoc"));o.renderOrder=100,n.fpTeleport.add(o),n.fpTeleport.disablePicking(),n.fpTeleport.visible=!1,ATON._rootUI.add(n.fpTeleport),n.PATH_FONT_JSON=ATON.PATH_RES+"fonts/custom-msdf.json",n.PATH_FONT_TEX=ATON.PATH_RES+"fonts/custom.png",n.gMeasures=ATON.createUINode(),n._prevMPoint=void 0,n._measLabels=[],ATON._rootUI.add(n.gMeasures);var t=(new THREE.BufferGeometry).setFromPoints([new THREE.Vector3,new THREE.Vector3]);n._measLine=new THREE.Line(t,ATON.MatHub.getMaterial("measurement")),n._measLine.visible=!1,ATON._rootUI.add(n._measLine),n.gPoints=ATON.createUINode(),ATON._rootUI.add(n.gPoints),n.buildInfoNode(),n.bShowInfo=!0,n._labelScale=ATON.Utils.isMobile()?50:60,n._labelScaleVR=2,ATON.on("SemanticNodeHover",function(e){n.setInfoNodeText(e),n.gSemIcons&&n.gSemIcons.hide()}),ATON.on("SemanticNodeLeave",function(e){n.gSemIcons&&n.gSemIcons.show()}),n._sync=0},n.enableLPIcons=function(){n.gLPIcons=ATON.createUINode(),n.gLPIcons.disablePicking(),ATON._rootUI.add(n.gLPIcons)},n.enableSemIcons=function(){n.gSemIcons=ATON.createUINode(),n.gSemIcons.disablePicking(),ATON._rootUI.add(n.gSemIcons)},n.setSelectorRadius=function(e){n._selectorRad=e,n.mainSelector.scale.set(e,e,e)},n.getSelectorRadius=function(){return n._selectorRad},n.setSelectorModel=function(e,o){void 0!==e&&(n.mainSelector.removeChildren(),n.mainSelector.load(e).disablePicking(),o&&n.mainSelector.setMaterial(ATON.MatHub.getMaterial("selector")))},n.setSelectorColor=function(e,o){ATON.MatHub.materials.selector.uniforms.color.value=e,void 0!==o&&(ATON.MatHub.materials.selector.uniforms.opacity.value=o)},n.addSemIcon=function(e,o){if(void 0!==n.gSemIcons){var t=(new THREE.Box3).setFromObject(o),i=new THREE.Sphere;t.getBoundingSphere(i);var a=new THREE.Sprite(ATON.MatHub.semIcon);a.position.copy(i.center);a.scale.set(.035,.035,1),a.name=e,n.gSemIcons.add(a)}},n.addLPIcon=function(e){if(void 0!==n.gLPIcons){var o=e._near,t=new THREE.Sprite(ATON.MatHub.lpIcon);t.position.copy(e.pos),t.scale.set(.1,.1,.1);var i=new THREE.Mesh(ATON.Utils.geomUnitSphere,ATON.MatHub.materials.lp);i.scale.set(o,o,o),i.position.copy(e.pos),n.gLPIcons.add(t),n.gLPIcons.add(i)}},n.setSemIconsOpacity=function(e){ATON.MatHub.semIcon.opacity=void 0===e?1:e},n.buildInfoNode=function(){n.infoNode=ATON.createUINode(),n.infoNode.attachToRoot(),n.infoContainer=new ThreeMeshUI.Block({width:.15,height:.05,padding:.01,borderRadius:.02,fontFamily:n.PATH_FONT_JSON,fontTexture:n.PATH_FONT_TEX,alignContent:"center",justifyContent:"center"}),n.infoNode.add(n.infoContainer),n.infoNodeText=new ThreeMeshUI.Text({content:"Info",fontSize:.02,fontColor:ATON.MatHub.colors.white}),n.infoContainer.add(n.infoNodeText)},n.getInfoNode=function(){return n.infoNode},n.setInfoNodeText=function(e){n.bShowInfo&&(n.infoNodeText.set({content:e}),ThreeMeshUI.update())},n.createToolbar=function(e,o){var t=ATON.createUINode(),i=e.length,a=.3*n.STD_BTN_SIZE,r=new ThreeMeshUI.Block({width:n.STD_BTN_SIZE*i*1.1+a,height:n.STD_BTN_SIZE+a,padding:.01,borderRadius:.02,backgroundColor:o||ATON.MatHub.colors.black,backgroundOpacity:.3,fontFamily:n.PATH_FONT_JSON,fontTexture:n.PATH_FONT_TEX,alignContent:"center",justifyContent:"center"}),s=.5*i*n.STD_BTN_SIZE*1.1;s-=.5*n.STD_BTN_SIZE;for(var c=0;c<i;c++){var l=e[c];l&&(l.position.set(c*n.STD_BTN_SIZE*1.1-s,0,.005),r.add(l))}return t.add(r),t},n.addMeasurementPoint=function(e){if(void 0!==e){var o=.01;if(void 0===n._prevMPoint){n._prevMPoint=e;var t=n._measLine.geometry.attributes.position.array;return t[0]=e.x,t[1]=e.y,void(t[2]=e.z)}n._measLine.visible=!1;var i=n._prevMPoint.distanceTo(e);o*=i,i;var a=new THREE.Mesh(ATON.Utils.geomUnitSphere,ATON.MatHub.getMaterial("measurement"));a.position.copy(n._prevMPoint),a.scale.set(o,o,o),n.gMeasures.add(a);var r=new THREE.Mesh(ATON.Utils.geomUnitSphere,ATON.MatHub.getMaterial("measurement"));r.position.copy(e),r.scale.set(o,o,o),n.gMeasures.add(r);var s=2*i,c=(new THREE.BufferGeometry).setFromPoints([n._prevMPoint,e]);n.gMeasures.add(new THREE.Line(c,ATON.MatHub.getMaterial("measurement")));var l=new n.Label;l.setBaseColor(ATON.MatHub.colors.white).setTextColor(ATON.MatHub.colors.black),l.setPosition(.5*(n._prevMPoint.x+e.x),.5*(n._prevMPoint.y+e.y),.5*(n._prevMPoint.z+e.z)),l.setScale(s).setText(ATON.Utils.getHumanReadableDistance(i)),n.gMeasures.add(l),n._measLabels.push(l);var T={};return T.A=n._prevMPoint.clone(),T.B=e.clone(),n._prevMPoint=void 0,T}},n.clearMeasurements=function(){n.gMeasures.removeChildren(),n._measLabels=[]},n._updateMeasurements=function(){if(!(n._measLabels.length<=0))for(var e in n._measLabels)n._measLabels[e].orientToCamera()},n.update=function(){if(ATON.Nav.isTransitioning()||ATON._bPauseQuery)n.infoNode.visible=!1;else{if(ThreeMeshUI.update(),n._prevMPoint){if(ATON._queryDataScene){var e=n._measLine.geometry.attributes.position.array;e[3]=ATON._queryDataScene.p.x,e[4]=ATON._queryDataScene.p.y,e[5]=ATON._queryDataScene.p.z,n._measLine.geometry.attributes.position.needsUpdate=!0}n._measLine.visible=!0}else n._measLine.visible=!1;if(ATON._queryDataScene&&!ATON.Nav._bInteracting?(n.mainSelector.visible=!0,n.mainSelector.position.copy(ATON._queryDataScene.p)):n.mainSelector.visible=!1,n.gSemIcons&&(ATON.Nav._bInteracting?n.gSemIcons.hide():void 0===ATON._hoveredSemNode&&n.gSemIcons.show()),ATON.Nav.isOrbit()&&!ATON.XR._bPresenting||!ATON.Nav.currentQueryValidForLocomotion()?n.fpTeleport.visible=!1:(n.fpTeleport.visible=!0,n.fpTeleport.position.copy(ATON._queryDataScene.p)),ATON.XR._pointerLineMesh){var o=0;ATON._queryDataScene&&(o=ATON._queryDataScene.d),ATON._queryDataUI&&(o<=0||ATON._queryDataUI.d<o)&&(o=ATON._queryDataUI.d,n.mainSelector.visible=!1,n.fpTeleport.visible=!1),o>0?(ATON.XR._pointerLineMesh.visible=!0,ATON.XR._pointerLineMesh.scale.set(1,1,o)):ATON.XR._pointerLineMesh.visible=!1}if(n._updateMeasurements(),ATON._queryDataSem){if(ATON.XR._bPresenting)ATON.XR.controller0?(n.infoNode.position.copy(ATON.XR.controller0pos),n.infoNode.position.x-=.1*ATON.XR.controller0dir.x,n.infoNode.position.y-=.1*ATON.XR.controller0dir.y,n.infoNode.position.z-=.1*ATON.XR.controller0dir.z,n.infoNode.setScale(n._labelScaleVR)):(n.infoNode.position.lerpVectors(ATON._queryDataSem.p,ATON.Nav._currPOV.pos,.5),n.infoNode.setScale(ATON._queryDataSem.d*n._labelScaleVR));else{n.infoNode.position.lerpVectors(ATON._queryDataSem.p,ATON.Nav._currPOV.pos,.2);var t=ATON._queryDataSem.d*(ATON.Nav._currPOV.fov/n._labelScale);n.infoNode.setScale(t)}n.infoNode.orientToCamera(),n.bShowInfo&&(n.infoNode.visible=!0),ATON.VRoadcast._bStreamFocus||(n.mainSelector.visible=!1)}else n.infoNode.visible=!1;if(n.mainSelector.visible&&ATON.VRoadcast._bStreamFocus){var i=n._selectorRad*(1+.2*Math.cos(10*ATON._clock.elapsedTime));n.mainSelector.scale.set(i,i,i)}}};var i=n;exports.default=i;
},{"./ATON.sui.button.js":"fWYX","./ATON.sui.label.js":"iqtl"}],"Qwfv":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=t(require("./ATON.node.js"));function t(e){return e&&e.__esModule?e:{default:e}}function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var s=0;s<t.length;s++){var i=t[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function r(e,t,s){return t&&o(e.prototype,t),s&&o(e,s),e}function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&a(e,t)}function a(e,t){return(a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function u(e){var t=c();return function(){var s,i=d(e);if(t){var o=d(this).constructor;s=Reflect.construct(i,arguments,o)}else s=i.apply(this,arguments);return l(this,s)}}function l(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?h(e):t}function h(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function c(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var f=function(t){n(o,e.default);var s=u(o);function o(e){var t;return i(this,o),(t=s.call(this,void 0,ATON.NTYPES.UI)).userid=e,t.username=void 0,t.message="...",t._auTalk=new THREE.PositionalAudio(ATON.AudioHub._listener),t._auTalk.setRefDistance(30),t.add(t._auTalk),t._bPlayingAudio=!1,t._auChunks=[],t._tStateCall=-1,t._tProgress=0,t._tFocCall=-1,t._currFocusPos=new THREE.Vector3,t._tgtFocusPos=void 0,t._currState={},t._currState.position=new THREE.Vector3,t._currState.quaternion=new THREE.Quaternion,t._tgtState=void 0,t.realize(),t}return r(o,[{key:"setTalkDistance",value:function(e){e>0&&this._auTalk.setRefDistance(e)}},{key:"getAvatarMaterialByUID",value:function(e){var t=ATON.MatHub.materials.avatars;return t[e%t.length]}},{key:"realize",value:function(){var e=new THREE.SphereGeometry(.2,16,16);this.usermaterial=this.getAvatarMaterialByUID(this.userid);var t=new THREE.Mesh(e,this.usermaterial);this.usermeshnode=ATON.createUINode(),this.usermeshnode.add(t),this.usermeshnode.setMaterial(this.usermaterial),this.usermeshnode.setCloneOnLoadHit(!1),this.userauinode=new THREE.Sprite(ATON.VRoadcast.uspritemats[this.userid%ATON.VRoadcast.uspritemats.length]),this.userauinode.position.set(0,0,0),this.userauinode.visible=!1,this.userfpnode=new THREE.Sprite(ATON.VRoadcast.ufocmats[this.userid%ATON.VRoadcast.ufocmats.length]),this.userfpnode.position.set(0,0,0),this.userfpnode.visible=!1,this.userlabelnode=ATON.createUINode(),this.labelcontainer=new ThreeMeshUI.Block({width:.7,height:.25,padding:.03,borderRadius:.05,backgroundColor:ATON.MatHub.colors.black,fontFamily:ATON.PATH_RES+"fonts/custom-msdf.json",fontTexture:ATON.PATH_RES+"fonts/custom.png"}),this.userlabelnode.position.y=.4,this.userlabelnode.add(this.labelcontainer),this.usernametext=new ThreeMeshUI.Text({content:"User #"+this.userid,fontSize:.09,fontColor:ATON.VRoadcast.ucolors[this.userid%ATON.VRoadcast.ucolors.length]}),this.usernametext.position.y=0,this.usermessagetext=new ThreeMeshUI.Text({content:"\nHello World!",fontSize:.03,fontColor:ATON.MatHub.colors.white}),this.usermessagetext.position.y=-.03,this.labelcontainer.add(this.usernametext),this.labelcontainer.add(this.usermessagetext),this.add(this.usermeshnode),this.add(this.userlabelnode),this.add(this.userauinode),void 0===ATON.VRoadcast._focNodes[this.userid]&&(ATON.VRoadcast._focNodes[this.userid]=this.userfpnode,ATON.VRoadcast.focGroup.add(this.userfpnode))}},{key:"destroy",value:function(){this.usermaterial&&this.usermaterial.dispose(),this.usermeshnode&&this.usermeshnode.dispose(),this.userauinode&&this.userauinode.dispose(),this.userfpnode&&this.userfpnode.dispose(),ATON.VRoadcast._focNodes[this.userid]&&ATON.VRoadcast._focNodes[this.userid].dispose(),this.userlabelnode&&this.userlabelnode.dispose(),this.labelcontainer&&this.labelcontainer.dispose(),this.usernametext&&this.usernametext.dispose(),this.usermessagetext&&this.usermessagetext.dispose(),this.dispose()}},{key:"loadRepresentation",value:function(e){var t=this;return void 0!==t.usermeshnode.children[0]&&t.usermeshnode.remove(t.usermeshnode.children[0]),t.usermeshnode.load(e),this}},{key:"setUsername",value:function(e){return this.username=e,this.usernametext.set({content:e}),this}},{key:"getUsername",value:function(){if(void 0!==this.userid)return void 0===this.username?"User #"+this.userid:this.username}},{key:"setMessage",value:function(e){return this.message=e,this.usermessagetext.set({content:"\n"+e}),this}},{key:"setTalkVolume",value:function(e){if(void 0!==e)if(e>0){this.userauinode.visible=!0;var t=.1+.03*e;this.userauinode.scale.set(t,t,t)}else this.userauinode.visible=!1;else this.userauinode.visible=!1}},{key:"hideFocalPoint",value:function(){this.userfpnode.visible=!1}},{key:"requestFocus",value:function(e){this._tFocCall>=0||(this._tFocCall=ATON._clock.elapsedTime,this._currFocusPos.copy(this.userfpnode.position),this._tgtFocusPos=new THREE.Vector3(parseFloat(e[0]),parseFloat(e[1]),parseFloat(e[2])),this._tgtFocusRad=2*parseFloat(e[3]),this.userfpnode.scale.set(this._tgtFocusRad,this._tgtFocusRad,this._tgtFocusRad),this.userfpnode.visible=!0)}},{key:"handleFocusTransition",value:function(){if(!(this._tFocCall<0)){var e=ATON.VRoadcast.USER_STATE_FREQ,t=(ATON._clock.elapsedTime-this._tFocCall)/e;if(t>=1)return this._tFocCall=-1,this.userfpnode.position.copy(this._tgtFocusPos),this.userfpnode.scale.set(this._tgtFocusRad,this._tgtFocusRad,this._tgtFocusRad),void(this.userfpnode.visible=!0);this.userfpnode.position.lerpVectors(this._currFocusPos,this._tgtFocusPos,t),this.userfpnode.visible=!0}}},{key:"requestStateTransition",value:function(e){this._tStateCall>=0||(this._tStateCall=ATON._clock.elapsedTime,this._currState.position.copy(this.position),this._currState.quaternion.copy(this.quaternion),this._tgtState=e)}},{key:"handleStateTransition",value:function(){if(!(this._tStateCall<0)){var e=ATON.VRoadcast.USER_STATE_FREQ;this._tProgress=e<=0?1:(ATON._clock.elapsedTime-this._tStateCall)/e;var t=this._currState,s=this._tgtState;if(this._tProgress>=1)return this._tStateCall=-1,this.position.copy(s.position),void this.usermeshnode.quaternion.copy(s.quaternion);this.position.lerpVectors(t.position,s.position,this._tProgress),this.usermeshnode.quaternion.slerp(s.quaternion,this._tProgress)}}},{key:"update",value:function(){if(this.handleStateTransition(),this.userfpnode.visible){this.handleFocusTransition();var e=this.userfpnode.scale.x;e>.001?this.userfpnode.scale.set(.99*e,.99*e,.99*e):this.userfpnode.visible=!1}var t=ATON.Nav._camera,s=ATON.Nav._currPOV.pos;if(void 0!==t&&void 0!==s){this.userlabelnode.orientToCamera();var i=this.userauinode.scale.x;(i*=.99)>.01?this.userauinode.scale.set(i,i,i):this.userauinode.visible=!1}}},{key:"_handleTalk",value:function(){var e=this;if(!(this._bPlayingAudio||this._auChunks.length<1)){var t=this._auChunks.shift(),s=new Audio;s.src=t.data,s.play(),this._bPlayingAudio=!0,s.onended=function(){e._bPlayingAudio=!1},this.setTalkVolume(5)}}}]),o}();exports.default=f;
},{"./ATON.node.js":"XTSP"}],"mY3J":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=o(require("./ATON.avatar.js"));function o(e){return e&&e.__esModule?e:{default:e}}var t={USER_STATE_FREQ:.25,REPLICATED_EVT:"EREP",THRES_STATE_POS:.01,THRES_STATE_ORI:.08};t.Avatar=e.default,t.init=function(){t.address=window.location.origin,t.initMaterials(),t.socket=void 0,t._connected=!1,t._username=void 0,t.uid=void 0,t._bStreamFocus=!1,t._numUsers=1,t.avatarList=[],t.avaGroup=ATON.createUINode("avatars"),t.avaGroup.attachToRoot(),t.focGroup=ATON.createUINode("focus"),t.focGroup.attachTo(t.avaGroup),t._focNodes=[],t.bSendState=!0,window.setInterval(t.sendState,1e3*t.USER_STATE_FREQ),t._lastStateSent=void 0,t._bShowAvaG=!0,console.log("VRoadcast initialized"),t.enableChatLog()},t.enableChatLog=function(){t._elChat=$("<div></div>").text("")},t.getNumUsers=function(){return t._numUsers},t.initMaterials=function(){t.ucolors=[],t.ucolors.push(new THREE.Color(1,0,0)),t.ucolors.push(new THREE.Color(1,1,0)),t.ucolors.push(new THREE.Color(0,1,0)),t.ucolors.push(new THREE.Color(0,1,1)),t.ucolors.push(new THREE.Color(0,0,1)),t.ucolors.push(new THREE.Color(1,0,1)),t.ucolorsdark=[],t.ucolorsdark.push(new THREE.Color(.2,0,0)),t.ucolorsdark.push(new THREE.Color(.2,.2,0)),t.ucolorsdark.push(new THREE.Color(0,.2,0)),t.ucolorsdark.push(new THREE.Color(0,.2,.2)),t.ucolorsdark.push(new THREE.Color(0,0,.2)),t.ucolorsdark.push(new THREE.Color(.2,0,.2)),t.ucolorhex=[],t.ucolorhex.push("#F00"),t.ucolorhex.push("#FF0"),t.ucolorhex.push("#0F0"),t.ucolorhex.push("#0FF"),t.ucolorhex.push("#00F"),t.ucolorhex.push("#F0F");var e=ATON.MatHub.materials;e.avatars=[];var o=ATON.MatHub.materials.defUI.clone();o.uniforms.color.value=t.ucolors[0],e.avatars.push(o);for(var n=1;n<t.ucolors.length;n++){var a=o.clone();a.uniforms.color.value=t.ucolors[n],e.avatars.push(a)}t.uspritemats=[];for(var r=(new THREE.TextureLoader).load(ATON.PATH_RES+"useraui.png"),s=0;s<t.ucolors.length;s++){var i=new THREE.SpriteMaterial({map:r,depthWrite:!1,color:t.ucolors[s]});i.sizeAttenuation=!0,t.uspritemats.push(i)}t.ufocmats=[];for(var c=(new THREE.TextureLoader).load(ATON.PATH_RES+"focus.png"),u=0;u<t.ucolors.length;u++){var d=new THREE.SpriteMaterial({map:c,depthWrite:!1,depthTest:!1,color:t.ucolors[u]});d.sizeAttenuation=!0,t.ufocmats.push(d)}},t.fireEvent=function(e,o){if(t._connected){var n=t.socket;n&&n.emit(t.REPLICATED_EVT,{e:e,d:o})}},t.on=function(e,o){if(void 0!==o){var t=ATON.EventHub.evNetwork;void 0===t[e]&&(t[e]=[]),t[e].push(o)}},t.isConnected=function(){return void 0!==t.socket&&t._connected},t.hasID=function(){return void 0!==t.uid},t.log=function(e){if(t._connected){var o=t.socket;o&&o.emit("LOG",e)}},t.joinSession=function(e){t.socket&&(void 0===e&&(e=ATON.SceneHub.currID),void 0!==e?(console.log("Joining VRC session "+e+"..."),t.socket.emit("SENTER",e)):console.log("VRC ERROR: current session ID is undefined"))},t.requestSceneState=function(){t.socket&&t.socket.emit("SSTATE")},t.setAvatarsVisibility=function(e){t._bShowAvaG=e,e?t.avaGroup.show():t.avaGroup.hide()},t.connect=function(e){if(!t._connected){e&&(t.address=e);var o={};"https:"===window.location.protocol?(o.path="/svrc/socket.io",o.secure=!0,o.rejectUnauthorized=!1):o.path="/vrc/socket.io",t.socket=io.connect(t.address,o),void 0!==t.socket&&(t._connected=t.socket.connected,t._registerSocketHandlers())}},t.disconnect=function(){void 0!==t.socket&&(t._numUsers=1,t.socket.disconnect(),t._connected=!1)},t._onConnected=function(){},t.setUsername=function(e){t._username=e,void 0!==t.socket&&void 0!==t.uid&&(t._elChat&&t._elChat.append("<i>Your username is now: "+e+"</i><br>"),t.socket.emit("UNAME",e))},t.setMessage=function(e){t._msg=e,void 0!==t.socket&&void 0!==t.uid&&(t._elChat&&(t._elChat.append("<span style='color:"+t.ucolorhex[t.uid%6]+"'><b>YOU</b>: "+e+"</span><br>"),t._elChat.scrollTop(t._elChat.scrollHeight)),t.socket.emit("UMSG",e))},t._registerSocketHandlers=function(){t.socket.on("connect",function(){t._connected=!0,void 0!==ATON.SceneHub.currID&&t.joinSession(),console.log("Connected to VRC service!"),ATON.fireEvent("VRC_Connected"),t._onConnected()}),t.socket.on("disconnect",function(){t._connected=!1,t.uid=void 0,t.avaGroup.hide(),t._elChat&&t._elChat.append("<i>YOU disconnected from VRoadcast service</i><br>"),console.log("VRC disconnected!"),ATON.fireEvent("VRC_Disconnected")}),t.socket.on(t.REPLICATED_EVT,function(e){var o=e.e,t=e.d,n=ATON.EventHub.evNetwork[o];ATON.EventHub.executeHandlers(n,t)}),t.socket.on("ID",function(e){console.log("Your ID is "+e),t.uid=e,t._bShowAvaG&&t.avaGroup.show(),t._elChat&&t._elChat.append("<i>Your ID is #"+e+"</i><br>"),t.requestSceneState(),ATON.fireEvent("VRC_IDassigned",e)}),t.socket.on("SSTATE",function(e){t._numUsers=e.numUsers,console.log("Num. users: "+t._numUsers),ATON.fireEvent("VRC_SceneState",e)}),t.socket.on("UENTER",function(e){var o=e;console.log("User #"+o+" entered the scene"),t._elChat&&t._elChat.append("<i>User #"+o+" entered the scene</i><br>"),t.touchAvatar(o),t.requestSceneState(),ATON.fireEvent("VRC_UserEnter",o)}),t.socket.on("ULEAVE",function(e){var o=e;if(void 0!==o){var n=t.avatarList[o];n&&n.hide(),console.log("User #"+o+" left the scene"),t._elChat&&t._elChat.append("<i>User #"+o+" left the scene</i><br>"),t.requestSceneState(),ATON.fireEvent("VRC_UserLeave",o)}}),t.socket.on("USTATE",function(e){if(t._bShowAvaG){var o=t.decodeState(e),n=o.userid;t.touchAvatar(n).requestStateTransition(o)}}),t.socket.on("UFOCUS",function(e){var o=e.uid,n=e.fp;t.touchAvatar(o).requestFocus(n)}),t.socket.on("UNAME",function(e){var o=e.uid,n=e.name;void 0!==o&&(t.touchAvatar(o).setUsername(n),console.log("User #"+o+" changed username to: "+n),t._elChat&&t._elChat.append("<i>User #"+o+" changed username to: "+n+"</i><br>"))}),t.socket.on("UMSG",function(e){var o=e.uid,n=e.msg;if(void 0!==o){var a=t.touchAvatar(o);a.setMessage(n),console.log("User #"+o+": "+n),t._elChat&&t._elChat.append("<span style='color:"+t.ucolorhex[o%6]+"'><b>"+a.getUsername()+"</b>: "+n+"</span><br>")}}),t.socket.on("UTALK",function(e){var o=e.uid;if(void 0!==o){var n=e.audio,a=t.touchAvatar(o);a.setTalkVolume(5),a._auTalk.isPlaying&&a._auTalk.stop(),ATON.AudioHub._loader.load(n,function(e){a._auTalk.setBuffer(e),a._auTalk.setLoop(!1),a._auTalk.play()})}})},t.encodeState=function(e){if(e){var o=new Float32Array(6);o[0]=e.position.x,o[1]=e.position.y,o[2]=e.position.z;var t=new Int8Array(o.buffer);return t[16]=128*e.quaternion.x,t[17]=128*e.quaternion.y,t[18]=128*e.quaternion.z,t[19]=128*e.quaternion.w,t[20]=e.userid,t}},t.decodeState=function(e){var o={},t=new Int8Array(e);return o.userid=t[20],o.quaternion=new THREE.Quaternion(t[16]/128,t[17]/128,t[18]/128,t[19]/128),t=new Float32Array(e),o.position=new THREE.Vector3(t[0],t[1],t[2]),o},t.update=function(){if(t._connected)for(var e=0;e<t.avatarList.length;e++){var o=t.avatarList[e];o&&o.visible&&o.update()}},t.setFocusStreaming=function(e){if(void 0!==e){if(e)return t._bStreamFocus||ATON.fireEvent("VRC_FocusStreamingStarted"),void(t._bStreamFocus=!0);t._bStreamFocus&&ATON.fireEvent("VRC_FocusStreamingStopped");var o=ATON.SUI._selectorRad;ATON.SUI.mainSelector.scale.set(o,o,o),t._bStreamFocus=!1}},t.sendState=function(){if(t.bSendState&&void 0!==t.uid&&t.socket&&t._connected){var e=ATON.Nav._currPOV;if(e){var o=ATON.getSceneQueriedPoint();if(t._bStreamFocus&&void 0!==o){var n=o.x.toPrecision(5),a=o.y.toPrecision(5),r=o.z.toPrecision(5),s=ATON.SUI.getSelectorRadius().toPrecision(5);t.socket.emit("UFOCUS",[n,a,r,s])}var i={};if(i.position=new THREE.Vector3,i.quaternion=new THREE.Quaternion,i.position.copy(e.pos),i.quaternion.copy(ATON.Nav._qOri),i.userid=t.uid,void 0!==t._lastStateSent){var c=t._lastStateSent.position,u=t._lastStateSent.quaternion,d=c.distanceToSquared(e.pos),l=u.angleTo(ATON.Nav._qOri);if(d<t.THRES_STATE_POS&&l<t.THRES_STATE_ORI)return}var v=t.encodeState(i);t.socket.emit("USTATE",v),t._lastStateSent=i}}},t.getAvatar=function(e){return t.avatarList[e]},t.touchAvatar=function(e){if(void 0===t.avatarList[e]){var o=new t.Avatar(e);o.attachTo(t.avaGroup),o.loadRepresentation(ATON.PATH_RES+"models/vrc/head.gltf"),t.avatarList[e]=o}var n=t.avatarList[e];return n.visible||(t._numUsers++,ATON.fireEvent("VRC_UserEnter",e)),t._bShowAvaG&&n.show(),n},t.destroyAvatar=function(e){var o=t.avatarList[e];void 0!==o&&o.destroy()},t.clearAllAvatars=function(){for(var e in t.avatarList){t.avatarList[e].hide()}};var n=t;exports.default=n;
},{"./ATON.avatar.js":"Qwfv"}],"dQQK":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e={FLOAT_PREC:5,init:function(){e.bConvexBuilding=!1,e.convexPoints=[],e.convexNode=void 0,e.currConvexMesh=void 0,e.currSemNode=ATON.createSemanticNode(),e.currSemNode.disablePicking(),e.currSemNode.attachToRoot(),e.resetMaterial(),e._numShapes=0},resetMaterial:function(){e.currMaterial=ATON.MatHub.getMaterial("semanticShapeHL")},setMaterial:function(n){void 0!==n&&(e.currMaterial=n)},addConvexPoint:function(n){if(void 0===n)return!1;if(e.convexPoints.length>0){var t=e.convexPoints[e.convexPoints.length-1];if(n.equals(t))return!1}e.convexPoints.push(n);var r=e.convexPoints.length,o=new THREE.Mesh(ATON.Utils.geomUnitSphere,ATON.MatHub.getMaterial("semanticShapeEdit"));if(o.position.copy(n),o.scale.set(.001,.001,.001),ATON.SUI.gPoints.add(o),r<4)return!1;var i=new THREE.ConvexGeometry(e.convexPoints),a=new THREE.Mesh(i,ATON.MatHub.getMaterial("semanticShapeEdit"));if(e.bConvexBuilding){var s=e.currConvexMesh;s.geometry.dispose(),s.geometry=i,ATON.Utils.setVectorPrecision(n,4),s.userData._convexPoints.push(n.x),s.userData._convexPoints.push(n.y),s.userData._convexPoints.push(n.z)}else{e.currSemNode.add(a),a.userData._convexPoints=[];for(var c=0;c<r;c++)ATON.Utils.setVectorPrecision(e.convexPoints[c],e.FLOAT_PREC),a.userData._convexPoints.push(e.convexPoints[c].x),a.userData._convexPoints.push(e.convexPoints[c].y),a.userData._convexPoints.push(e.convexPoints[c].z);e.currConvexMesh=a,e.bConvexBuilding=!0}return!0},undoConvexPoint:function(){if(0!==e.convexPoints.length&&(e.convexPoints.pop(),e.currConvexMesh)){var n=e.currConvexMesh.userData;n._convexPoints&&n._convexPoints.pop()}},stopCurrentConvex:function(){e.convexPoints=[],e.bConvexBuilding=!1,e.currSemNode.removeChildren(),ATON.SUI.gPoints.removeChildren()},getCurrentConvexShape:function(){return e.currSemNode},isBuildingShape:function(){return e.convexPoints.length>0},completeConvexShape:function(n){if(e.convexPoints=[],e.bConvexBuilding=!1,void 0!==e.currSemNode){void 0===n&&(n="sem"+e._numShapes);var t=ATON.getSemanticNode(n)||ATON.createSemanticNode(n),r=e.currSemNode.children[0];return ATON.SUI.addSemIcon(n,r),t.add(r),t.setMaterial(ATON.MatHub.materials.semanticShape),t.setDefaultAndHighlightMaterials(ATON.MatHub.materials.semanticShape,e.currMaterial),t.enablePicking(),e.currSemNode.removeChildren(),e._numShapes++,ATON.SUI.gPoints.removeChildren(),ATON._bqSem=!0,t}},createConvexShape:function(n,t){var r=new THREE.ConvexGeometry(t),o=new THREE.Mesh(r,ATON.MatHub.materials.semanticShape);o.userData._convexPoints=[];for(var i=0;i<t.length;i++){var a=t[i];ATON.Utils.setVectorPrecision(a,4),o.userData._convexPoints.push(a.x),o.userData._convexPoints.push(a.y),o.userData._convexPoints.push(a.z)}ATON.SUI.addSemIcon(n,o);var s=ATON.getOrCreateSemanticNode(n);return s.add(o),s.setDefaultAndHighlightMaterials(ATON.MatHub.materials.semanticShape,e.currMaterial),s.enablePicking(),ATON._bqSem=!0,s},addSurfaceConvexPoint:function(n){if(void 0===ATON._queryDataScene)return!1;void 0===n&&(n=.02);var t=ATON._queryDataScene.p,r=ATON.Nav.getCurrentEyeLocation();return t.lerpVectors(t,r,n),e.addConvexPoint(t),t},createSphere:function(n,t,r){if(void 0!==t&&void 0!==r){void 0===n&&(n="sem"+e._numShapes);var o=ATON.getOrCreateSemanticNode(n),i=new THREE.Mesh(ATON.Utils.geomUnitSphere,ATON.MatHub.materials.semanticShape),a=new THREE.Object3D;return a.position.copy(t),a.scale.set(r,r,r),a.add(i),ATON.SUI.addSemIcon(n,a),o.add(a),o.enablePicking(),o.setDefaultAndHighlightMaterials(ATON.MatHub.materials.semanticShape,e.currMaterial),e._numShapes++,ATON._bqSem=!0,o}},createSurfaceSphere:function(n){if(ATON._queryDataScene){var t=ATON._queryDataScene.p,r=ATON.SUI.getSelectorRadius();return e.createSphere(n,t,r)}},deleteSemanticNode:function(e){var n=ATON.getSemanticNode(e);if(void 0===n)return!1;if(n.removeChildren(),void 0===ATON.SUI.gSemIcons)return!0;for(var t in ATON.SUI.gSemIcons.children){var r=ATON.SUI.gSemIcons.children[t];r&&r.name===e&&ATON.SUI.gSemIcons.removeChild(r)}return!0}},n=e;exports.default=n;
},{}],"Z6YW":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e={SEMSHAPE_SPHERE:0,SEMSHAPE_CONVEX:1,POPUP_DELAY:300,realize:function(){e.PATH_RES_ICONS=ATON.PATH_RES+"icons/",e._bPopup=!1,e.popupBlurBG=.5,e._userAuth={},e._bControlLight=!1,e._bControlSelScale=!1,e._cLightDir=new THREE.Vector3,e._auSemNode=void 0,e._auSemNodePlaying=!1,e._bReqHome=!1,e._vrcAddr=void 0,e._bVRCsetup=!1,e.urlParams=new URLSearchParams(window.location.search),e._uiSetupBase(),e._uiProfiles={},e._uiCurrProfile=void 0,e._selRanges=[.01,50],e._selRefRadius=.5,ATON.realize(),ATON.on("Fullscreen",function(t){e.uiSwitchButton("fullscreen",t)});var t=ATON.FE.urlParams.get("d");t&&t>0&&ATON.setDefaultPixelDensity(t)},_handleHomeReq:function(){e._bReqHome||(e._bReqHome=!0,void 0!==ATON.Nav.homePOV?ATON.Nav.requestHome(1):ATON.Nav.computeAndRequestDefaultHome(.5))},addBasicLoaderEvents:function(){ATON.on("NodeRequestFired",function(){$("#idLoader").show()}),ATON.on("SceneJSONLoaded",function(){ATON.SceneHub.getDescription()&&$("#btn-info").show(),void 0!==ATON.Nav.homePOV&&ATON.Nav.requestHome(1)}),ATON.on("AllNodeRequestsCompleted",function(){$("#idLoader").hide(),ATON._ccModels.length>0&&$("#btn-cc").show(),e.computeSelectorRanges(),ATON.Nav.isOrbit()&&ATON.SUI.setSelectorRadius(e._selRefRadius),e._handleHomeReq()}),ATON.addUpdateRoutine(e._update)},controlLight:function(t){e._bControlLight=t,ATON.Nav.setUserControl(!t)},controlSelectorScale:function(t){e._bControlSelScale=t,ATON._bPauseQuery=t,ATON.Nav.setUserControl(!t)},useMouseWheelToScaleSelector:function(t){void 0===t&&(t=.9),ATON.on("MouseWheel",function(o){if(ATON._kModCtrl){var i=ATON.Nav.getFOV();return o>0?i+=1:i-=1,void ATON.Nav.setFOV(i)}if(ATON._kModShift){var n=ATON.SUI.mainSelector.scale.x;return o>0?n*=t:n/=t,n<e._selRanges[0]&&(n=e._selRanges[0]),n>e._selRanges[1]&&(n=e._selRanges[1]),void ATON.SUI.setSelectorRadius(n)}})},loadSceneID:function(e){if(void 0!==e){var t=ATON.PATH_RESTAPI_SCENE+e;ATON.SceneHub.load(t,e),$("meta[property=og\\:image]").attr("content",ATON.PATH_SCENES+e+"/cover.png"),$("meta[property=og\\:image\\:secure_url]").attr("content",ATON.PATH_SCENES+e+"/cover.png"),$("meta[property=og\\:image\\:type]").attr("content","image/png"),$("meta[property=og\\:image\\:width]").attr("content","200"),$("meta[property=og\\:image\\:height]").attr("content","200"),console.log(t)}},_update:function(){if(e._bControlLight){var t=ATON._screenPointerCoords.x,o=ATON._screenPointerCoords.y;e._cLightDir.x=-Math.cos(t*Math.PI),e._cLightDir.y=2*-o,e._cLightDir.z=-Math.sin(t*Math.PI),e._cLightDir.normalize(),ATON.setMainLightDirection(e._cLightDir)}if(e._bControlSelScale){var i=ATON._screenPointerCoords.y,n=ATON.SUI.mainSelector.scale.x+i;n>1e-4&&ATON.SUI.setSelectorRadius(n)}},uiBasicSetup:function(){e.uiAddButton("idTopToolbar","fullscreen",ATON.toggleFullScreen),ATON.Utils.isConnectionSecure()&&e.uiAddButton("idTopToolbar","vr",ATON.XR.toggle),e.uiAddButton("idBottomToolbar","home",function(){ATON.Nav.requestHome(.1)})},_uiSetupBase:function(){$("#idPopup").click(e.popupClose),$("#idLoader").html("<img src='"+ATON.PATH_RES+"loader.png'>")},uiAddButton:function(t,o,i,n){var s,d;o.endsWith(".png")?(s=o,d=o.slice(0,-4)):(s=e.PATH_RES_ICONS+o+".png",d=o);var a=$("<div id='"+("btn-"+d)+"' class='atonBTN' ><img src='"+s+"'></div>");$("#"+t).append(a),i&&a.click(i),n&&a.attr("title",n)},uiSwitchButton:function(e,t){t?$("#btn-"+e).addClass("switchedON"):$("#btn-"+e).removeClass("switchedON")},uiAddButtonHome:function(t){e.uiAddButton(t,"home",function(){ATON.Nav.requestHome(.3)},"Home viewpoint")},uiAddButtonFirstPerson:function(t){e.uiAddButton(t,"fp",function(){ATON.Nav.isFirstPerson()?(ATON.Nav.setOrbitControl(),e.uiSwitchButton("fp",!1)):(ATON.Nav.setFirstPersonControl(),e.uiSwitchButton("fp",!0))},"First-person navigation mode"),ATON.Nav.isFirstPerson()?e.uiSwitchButton("fp",!0):e.uiSwitchButton("fp",!1)},uiAddButtonVR:function(t){ATON.Utils.isConnectionSecure()&&e.uiAddButton(t,"vr",ATON.XR.toggle,"Immersive VR mode")},uiAddButtonDeviceOrientation:function(t){ATON.Utils.isConnectionSecure()&&ATON.Utils.isMobile()&&(e.uiAddButton(t,"devori",function(){ATON.Nav.isDevOri()?(ATON.Nav.restorePreviousNavMode(),e.uiSwitchButton("devori",!1)):(ATON.Nav.setDeviceOrientationControl(),e.uiSwitchButton("devori",!0))},"Device-orientation mode"),ATON.Nav.isDevOri()?e.uiSwitchButton("devori",!0):e.uiSwitchButton("devori",!1))},uiAddButtonNav:function(t){e.uiAddButton(t,"nav",function(){e.popupNav()},"Navigation")},uiAddButtonTalk:function(t){ATON.Utils.isConnectionSecure()&&(e.uiAddButton(t,"talk",function(){ATON.MediaRec.isAudioRecording()?(ATON.MediaRec.stopMediaStreaming(),$("#btn-talk").removeClass("atonBTN-rec")):(ATON.MediaRec.startMediaStreaming(),$("#btn-talk").addClass("atonBTN-rec"))},"Talk ON/OFF"),ATON.MediaRec.isAudioRecording()?$("#btn-talk").addClass("atonBTN-rec"):$("#btn-talk").removeClass("atonBTN-rec"))},uiAddButtonStreamFocus:function(t){e.uiAddButton(t,"focus",function(){ATON.VRoadcast._bStreamFocus?(ATON.VRoadcast.setFocusStreaming(!1),$("#btn-focus").removeClass("atonBTN-rec")):(ATON.VRoadcast.setFocusStreaming(!0),$("#btn-focus").addClass("atonBTN-rec"))},"Focus streaming ON/OFF"),ATON.VRoadcast._bStreamFocus?$("#btn-focus").addClass("atonBTN-rec"):$("#btn-focus").removeClass("atonBTN-rec")},uiAddButtonQR:function(t){e.uiAddButton(t,"qr",e.popupQR,"QR-code")},uiAddButtonInfo:function(t){e.uiAddButton(t,"info",ATON.FE.popupSceneInfo,"Scene information"),$("#btn-info").hide()},uiAddButtonFullScreen:function(t){e.uiAddButton(t,"fullscreen",function(){ATON.toggleFullScreen()},"Fullscreen"),e.uiSwitchButton("fullscreen",ATON.isFullscreen())},uiAddKeywordsArea:function(e,t,o,i){$("#"+e).html("Add keyword: <input id='idKWordInput' type='text' maxlength='100' size='30' ><br><div id='idKWords'></div>");var n={},s=function(e){n[e]||(e=e.toLowerCase().trim(),$("#idKWordInput").val(""),n[e]=1,console.log("Added keyword "+e),o&&o(e),$("#idKWords").append("<div class='atonKeyword atonKeywordActivable' id='idkw-"+e+"'>"+e+"</div>"),$("#idkw-"+e).click(function(){$("#idkw-"+e).remove(),console.log("Removed keyword "+e),i&&i(e)}))};if(t)for(var d in t)s(t[d]);$("#idKWordInput").keypress(function(e){if("13"==(e.keyCode?e.keyCode:e.which)){var t=$("#idKWordInput").val().toLowerCase().trim();!t||t.length<3||s(t)}})},getVRCclassFromID:function(e){return"atonVRCu"+e%6},_setupVRCevents:function(){e._bVRCsetup||(ATON.on("VRC_IDassigned",function(t){$("#btn-vrc").addClass(e.getVRCclassFromID(t)),ATON.SUI.setSelectorColor(ATON.VRoadcast.ucolors[t%6]),e.checkAuth(function(e){void 0!==e.username&&ATON.VRoadcast.setUsername(e.username)})}),ATON.on("VRC_SceneState",function(e){var t=ATON.VRoadcast.getNumUsers();t>1?$("#idVRCnumusers").html(t):$("#idVRCnumusers").html(""),console.log("Users: "+t)}),ATON.on("VRC_Disconnected",function(){$("#btn-vrc").attr("class","atonBTN"),ATON.SUI.setSelectorColor(ATON.MatHub.colors.defUI),$("#idVRCnumusers").html("")}),e._bVRCsetup=!0)},uiAddButtonVRC:function(t){e.uiAddButton(t,"vrc",function(){ATON.VRoadcast.isConnected()?e.popupVRC():ATON.VRoadcast.connect(e._vrcAddr)},"VRoadcast (collaborative session)"),$("#btn-vrc").append("<span id='idVRCnumusers' class='atonVRCcounter'></span>"),e._setupVRCevents(),void 0!==ATON.VRoadcast.uid?$("#btn-vrc").addClass(e.getVRCclassFromID(ATON.VRoadcast.uid)):$("#btn-vrc").attr("class","atonBTN")},uiAddButtonUser:function(t){e.uiAddButton(t,"user",function(){e.popupUser()},"User"),e.checkAuth(function(e){void 0!==e.username?$("#btn-user").addClass("switchedON"):$("#btn-user").removeClass("switchedON")})},uiAddButtonEditMode:function(t){e.uiAddButton(t,"edit",function(){e.checkAuth(function(t){void 0!==t.username?(ATON.SceneHub._bEdit=!ATON.SceneHub._bEdit,e.uiSwitchButton("edit",ATON.SceneHub._bEdit)):e.popupUser()})})},uiAddProfile:function(t,o){"function"==typeof o&&(e._uiProfiles[t]=o)},uiLoadProfile:function(t){var o=e._uiProfiles[t];void 0!==o&&(o(),e._uiCurrProfile=t,console.log("Loaded UI Profile: "+e._uiCurrProfile))},attachHandlerToButton:function(e,t){void 0!==t&&$("#"+e).click(function(){t()})},uiAttachInputFilterID:function(e){$("#"+e).on("keyup change input",function(){var t=$("#"+e).val(),o=new RegExp("[^A-Za-z0-9-_]","ig");$("#"+e).val(t.replace(o,""))})},switchNode:function(e,t,o){var i=void 0;void 0!==(i=o===ATON.NTYPES.SEM?ATON.getSemanticNode(e):ATON.getSceneNode(e))&&(i.toggle(t),ATON.fireEvent("FE_NodeSwitch",{nid:e,t:o,v:t}))},uiCreateGraph:function(e){var t=ATON.snodes;e===ATON.NTYPES.SEM&&(t=ATON.semnodes);var o="";for(var i in t){var n=t[i].visible?"checked":"";"."!==i&&(o+="<input type='checkbox' "+n+" onchange=\"ATON.FE.switchNode('"+i+"',this.checked,"+e+');">'+i+"<br>")}return o},setupBasicUISounds:function(){e.auLib={},e.auLib.switch=new Audio(ATON.PATH_RES+"audio/switch.wav"),e.auLib.switch.loop=!1},playAudioFromSemanticNode:function(t){if(void 0!==t){var o=ATON.getSemanticNode(t);if(void 0!==o){var i=o.getAudio();void 0!==i&&(void 0===e._auSemNode||null===e._auSemNode?e._auSemNode=new THREE.Audio(ATON.AudioHub._listener):e._auSemNode.stop(),ATON.AudioHub._loader.load(i,function(t){e._auSemNode.setBuffer(t),e._auSemNode.setLoop(!1),e._auSemNode.play()}))}}},popupShow:function(t,o){if(e._bPopup)return!1;var i="atonPopup ";o&&(i+=o);var n="<div id='idPopupContent' class='"+i+"'>";return n+=t+"</div>",$("#idPopup").html(n),$("#idPopupContent").click(function(e){e.stopPropagation()}),$("#idPopup").fadeIn(e.POPUP_DELAY),e._bPopup=!0,ATON._bListenKeyboardEvents=!1,e.popupBlurBG>0&&(ATON._renderer.setPixelRatio(e.popupBlurBG),ATON._renderer.render(ATON._mainRoot,ATON.Nav._camera)),ATON._bPauseQuery=!0,$("#idTopToolbar").hide(),$("#idBottomToolbar").hide(),$("#idBottomRToolbar").hide(),$("#idPoweredBy").hide(),!0},popupClose:function(t){e._bPopup=!1,ATON._bListenKeyboardEvents=!0,e.popupBlurBG>0&&ATON.resetPixelDensity(),!0===t?$("#idPopup").hide():$("#idPopup").fadeOut(e.POPUP_DELAY),ATON._bPauseQuery=!1,$("#idTopToolbar").show(),$("#idBottomToolbar").show(),$("#idBottomRToolbar").show(),$("#idPoweredBy").show(),ATON.focusOn3DView()},subPopup:function(e){ATON.FE.popupClose(),setTimeout(e,ATON.FE.POPUP_DELAY)},popupQR:function(){if("<div class='atonQRcontainer' id='idQRcode'></div><br><br>",ATON.FE.popupShow("<div class='atonPopupTitle'>Share</div><div class='atonQRcontainer' id='idQRcode'></div><br><br>")){var e=window.location.href;new QRCode(document.getElementById("idQRcode"),e)}},popupScreenShot:function(){var t=ATON.Utils.takeScreenshot(200);e.checkAuth(function(o){var i="<div class='atonPopupTitle'>Screenshot</div>";i+="This is a preview of what your screenshot will look like:<br><br>",i+="<img src='"+t.src+"'><br>",i+="Resolution: <input id='isShotSize' type='number' min='100' max='4000' value='200'>px<br>",i+="<div class='atonBTN atonBTN-green' id='btnScreenShot' style='width:90%'><img src='"+e.PATH_RES_ICONS+"sshot.png'>SHOT</div>",void 0!==o.username&&(i+="<div class='atonBTN atonBTN-green' id='btnSetCover' style='width:90%'>Set as Cover</div>"),ATON.FE.popupShow(i)&&($("#btnScreenShot").click(function(){ATON.FE.popupClose();var e=parseInt($("#isShotSize").val());ATON.Utils.takeScreenshot(e,"shot.png")}),$("#btnSetCover").click(function(){ATON.FE.popupClose(),ATON.Utils.postJSON(ATON.PATH_RESTAPI+"cover/scene/",{sid:ATON.SceneHub.currID,img:t.src},function(e){console.log(e)})}))})},popupVRC:function(){var e="",t=ATON.VRoadcast.getNumUsers();e+=t>1?"<div class='atonPopupTitle'>Collaborative Session ("+t+" users)</div>":"<div class='atonPopupTitle'>Collaborative Session</div>",e+="<input id='idVRCusername' type='text' size='10' placeholder='username...' style='display:none'>",e+="<div id='idVRCusernameBTN' class='atonBTN' style='width:150px; display:none'>"+ATON.VRoadcast._username+"</div>",e+="<div id='idChatBox' style='width:100%; height:150px; text-align:left;' class='scrollableY'></div>",e+="<input id='idVRCmsg' style='width:90%' type='text' placeholder='message...'>",e+="<div class='atonBTN' id='idVRCdisconnect' style='width:90%'>LEAVE</div>",ATON.FE.popupShow(e,"atonPopupLarge")&&(void 0===ATON.VRoadcast._username?($("#idVRCusername").show(),$("#idVRCusernameBTN").hide()):($("#idVRCusername").val(ATON.VRoadcast._username),$("#idVRCusername").hide(),$("#idVRCusernameBTN").show()),void 0!==ATON.VRoadcast.uid&&$("#idVRCusernameBTN").addClass("atonVRCu"+ATON.VRoadcast.uid%6),$("#idChatBox").append(ATON.VRoadcast._elChat),$("#idVRCmsg").keypress(function(e){if("13"==(e.keyCode?e.keyCode:e.which)){var t=$("#idVRCmsg").val();ATON.VRoadcast.setMessage(t),$("#idVRCmsg").val("")}}),$("#idVRCusername").keypress(function(e){if("13"==(e.keyCode?e.keyCode:e.which)){var t=$("#idVRCusername").val();ATON.VRoadcast.setUsername(t),$("#idVRCusername").hide(),$("#idVRCusernameBTN").html(ATON.VRoadcast._username),$("#idVRCusernameBTN").show()}}),$("#idVRCusernameBTN").click(function(){$("#idVRCusername").show(),$("#idVRCusernameBTN").hide()}),$("#idVRCdisconnect").click(function(){ATON.VRoadcast.disconnect(),ATON.FE.popupClose()}))},checkAuth:function(t){ATON.Utils.checkAuth(function(o){e._userAuth=o,void 0!==o.username?($("#btn-user").addClass("switchedON"),void 0===ATON.VRoadcast._username&&ATON.VRoadcast.setUsername(o.username)):$("#btn-user").removeClass("switchedON"),t&&t(o)})},popupUser:function(){e.checkAuth(function(t){if(void 0!==t.username){var o="<img src='"+e.PATH_RES_ICONS+"user.png'><br>";if(o+="<b>'"+t.username+"'</b><br><br>",Object.keys(e._uiProfiles)){for(var i in o+="UI Profile:<br><div class='select' style='width:150px;'><select id='idUIProfiles'>",e._uiProfiles)o+="<option value='"+i+"'>"+i+"</option>";o+="</select><div class='selectArrow'></div></div><br><br>"}if(o+="<div class='atonBTN atonBTN-red' id='idLogoutBTN' style='width:90%'>LOGOUT</div>",!ATON.FE.popupShow(o))return;e._uiCurrProfile&&(console.log(e._uiCurrProfile),$("#idUIProfiles").val(e._uiCurrProfile)),$("#idLogoutBTN").click(function(){$.get(ATON.PATH_RESTAPI+"logout",function(e){console.log(e),ATON.SceneHub.setEditMode(!1),ATON.fireEvent("Logout"),$("#btn-user").removeClass("switchedON")}),ATON.FE.popupClose()}),$("#idSHUscenes").click(function(){ATON.Utils.goToURL("/shu/scenes/")}),$("#idSHUuser").click(function(){ATON.Utils.goToURL("/shu/auth/")}),$("#idUIProfiles").on("change",function(){var t=$("#idUIProfiles").val();e.uiLoadProfile(t),ATON.FE.popupClose()})}else{var n="<img src='"+e.PATH_RES_ICONS+"user.png'><br>";if(n+="username:<input id='idUsername' type='text' maxlength='15' size='15' ><br>",n+="password:<input id='idPassword' type='password' maxlength='15' size='15' ><br>",n+="<div class='atonBTN atonBTN-green' id='idLoginBTN' style='width:90%'>LOGIN</div>",!ATON.FE.popupShow(n))return;$("#idLoginBTN").click(function(){var e=JSON.stringify({username:$("#idUsername").val(),password:$("#idPassword").val()});$.ajax({url:ATON.PATH_RESTAPI+"login",type:"POST",data:e,contentType:"application/json; charset=utf-8",dataType:"json",success:function(e){console.log(e),e&&(ATON.fireEvent("Login",e),$("#btn-user").addClass("switchedON"),ATON.FE.popupClose())}}).fail(function(e){$("#idLoginBTN").html("LOGIN FAILED"),$("#idLoginBTN").attr("class","atonBTN atonBTN-red")})})}})},popupSceneInfo:function(){var e=ATON.SceneHub.getTitle();void 0===e&&(e=ATON.SceneHub.currID);var t=ATON.SceneHub.getDescription(),o="<div class='atonPopupTitle'>"+e+"</div>";t&&(o+="<div class='atonPopupDescriptionContainer'>"+JSON.parse(t)+"</div>"),o+="<div class='atonBTN atonBTN-green' id='btnOK' style='width:90%'>OK</div>",ATON.FE.popupShow(o)&&$("#btnOK").click(function(){ATON.FE.popupClose()})},computeSelectorRanges:function(){var t=ATON.getRootScene().getBound().radius;t<=0||(e._selRanges[0]=.001*t,e._selRefRadius=.02*t,e._selRanges[1]=.5*t)},popupSelector:function(){var t="<div class='atonPopupTitle'>3D Selector</div>",o=ATON.SUI.getSelectorRadius(),i=ATON.Utils.getHumanReadableDistance(o);e.computeSelectorRanges(),t+="Radius (<span id='idSelRadTxt'>"+i+"</span>):<br>",t+="<input id='idSelRad' type='range' min='"+e._selRanges[0]+"' max='"+e._selRanges[1]+"' step='"+e._selRanges[0]+"' style='width:90%'>",ATON.FE.popupShow(t,"atonPopupLarge")&&($("#idSelRad").val(o),$("#idSelRad").on("input change",function(){var e=parseFloat($("#idSelRad").val());ATON.SUI.setSelectorRadius(e),$("#idSelRadTxt").html(ATON.Utils.getHumanReadableDistance(e))}))},popupNav:function(){var t="<div class='atonPopupTitle'>Navigation</div>";t+="<div style='display:block; width:90%; min-height:50px; vertical-align:top'>",t+="<div style='display:inline-block; width:60px; float:left' id='idNMfp'></div>",t+="<div style='text-align:left'>Switch between first-person and orbit navigation mode</div>",t+="</div>",ATON.Utils.isConnectionSecure()&&(t+="<div style='display:block; width:90%; min-height:50px; vertical-align:top'>",t+="<div style='display:inline-block; width:60px; float:left' id='idNMvr'></div>",t+="<div style='text-align:left'>Immersive VR mode</div>",t+="</div>",ATON.Utils.isMobile()&&(t+="<div style='display:block; width:90%; min-height:50px; vertical-align:top'>",t+="<div style='display:inline-block; width:60px; float:left' id='idNMdevori'></div>",t+="<div style='text-align:left'>Enable or disable device-orientation mode</div>",t+="</div>")),e.popupShow(t)&&(e.uiAddButtonFirstPerson("idNMfp"),e.uiAddButtonDeviceOrientation("idNMdevori"),e.uiAddButtonVR("idNMvr"))}},t=e;exports.default=t;
},{}],"jdcn":[function(require,module,exports) {
"use strict";function e(e,r,o,n,t,i,d){try{var c=e[i](d),a=c.value}catch(u){return void o(u)}c.done?r(a):Promise.resolve(a).then(n,t)}function r(r){return function(){var o=this,n=arguments;return new Promise(function(t,i){var d=r.apply(o,n);function c(r){e(d,t,i,c,a,"next",r)}function a(r){e(d,t,i,c,a,"throw",r)}c(void 0)})}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var o={auType:"audio/wav",auExt:".wav",auBitsPerSecond:9e3,auStreamInterval:1e3,auMinVol:1,init:function(){o._bAudioRecording=!1,o._bStreaming=!1,o.recorder=void 0},realizeAudioRecorder:function(e){if(void 0!==o.recorder)o.recorder.reset(),e&&e();else{if(!ATON.Utils.isConnectionSecure())return;if(!navigator.mediaDevices)return;void 0===o._ds&&(o._ds=setInterval(o._streamChunk,o.auStreamInterval)),navigator.mediaDevices.getUserMedia({video:!1,audio:!0,channelCount:1,echoCancellation:!0}).then(function(){var n=r(regeneratorRuntime.mark(function r(n){return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:o.recorder=RecordRTC(n,{type:"audio",mimeType:o.auType,bitsPerSecond:o.auBitsPerSecond,audioBitsPerSecond:o.auBitsPerSecond,sampleRate:22050,desiredSampRate:22050,disableLogs:!0,numberOfAudioChannels:1}),e&&e();case 2:case"end":return r.stop()}},r)}));return function(e){return n.apply(this,arguments)}}())}},isAudioRecording:function(){return o._bAudioRecording},_stopRecAndSend:function(e){void 0!==o.recorder?o.recorder.stopRecording(function(){o.recorder.getDataURL(function(r){ATON.VRoadcast.socket&&void 0!==ATON.VRoadcast.uid?(ATON.VRoadcast.socket.compress(!1).emit("UTALK",{audio:r,uid:ATON.VRoadcast.uid}),e&&e()):e&&e()})}):e&&e()},_onAuBlob:function(e){e&&ATON.VRoadcast.socket&&ATON.VRoadcast.socket.emit("UTALK",{blob:e,uid:ATON.VRoadcast.uid,vol:o._auAVGvolume})},startRecording:function(){o.realizeAudioRecorder(function(){o.recorder&&(o._bAudioRecording||(console.log("Recording..."),o.recorder.startRecording(),o._bAudioRecording=!0))})},stopRecording:function(){o.recorder&&o.recorder.stopRecording(function(){var e=o.recorder.getBlob();console.log("Stop recording.");var r=new FileReader;r.readAsDataURL(e),r.onloadend=function(){var e=r.result;ATON.fireEvent("AudioRecordCompleted",e)},o._bAudioRecording=!1})},startOrStopRecording:function(){o._bAudioRecording?o.stopRecording():o.startRecording()},_streamChunk:function(){o.recorder&&o._bStreaming&&o._stopRecAndSend(function(){o.recorder.startRecording()})},startMediaStreaming:function(){o.realizeAudioRecorder(function(){o.recorder&&(o._bAudioRecording||(console.log("Start MediaStreaming"),o.recorder.startRecording(),o._bAudioRecording=!0,o._bStreaming=!0))})},stopMediaStreaming:function(){o.recorder&&o._bAudioRecording&&(console.log("Stop MediaStreaming"),o._stopRecAndSend(function(){}),o._bStreaming=!1,o._bAudioRecording=!1)},startOrStopMediaStreaming:function(){o._bAudioRecording?o.stopMediaStreaming():o.startMediaStreaming()}},n=o;exports.default=n;
},{}],"uZX1":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t={EARTH_R_KM:6371};t.EARTH_D_KM=2*t.EARTH_R_KM,t.init=function(){t._bActive=!1,t._wpid=void 0,t._currPos=new THREE.Vector2,t._POIs=[],t._currPOI=void 0,t._closestPOI=void 0,t._maxError=40},t.enableTracking=function(){t._bActive||ATON.Utils.isConnectionSecure()&&navigator.geolocation&&(t._wpid=navigator.geolocation.watchPosition(t._onPosition,t._onError,{enableHighAccuracy:!0}),t._bActive=!0)},t.disableTracking=function(){t._bActive&&(navigator.geolocation.clearWatch(t._wpid),t._bActive=!1)},t.setMaxError=function(o){o>0&&(t._maxError=o)},t._onError=function(){console.log("Geolocation error")},t._onPosition=function(o){if(t._bActive&&o.coords){var r=o.coords.accuracy;r&&r>t._maxError||(t._currPos.x=o.coords.latitude,t._currPos.y=o.coords.longitude,ATON.fireEvent("GeoLocation",o),t._handlePOIs())}},t._handlePOIs=function(){var o=t._POIs.length;if(!(o<=0)){t._closestPOIdist=void 0,t._closestPOI=void 0;for(var r=0;r<o;r++){var e=t._POIs[r],n=t.distance(t._currPos,e.pos);(void 0===t._closestPOIdist||n<t._closestPOIdist)&&(t._closestPOIdist=n,t._closestPOI=r),n<=e.radius?(t._currPOI!==r&&ATON.fireEvent("EnterPOI",{id:r,distance:n}),t._currPOI=r):(void 0!==t._currPOI&&ATON.fireEvent("LeavePOI",{id:t._currPOI,distance:n}),t._currPOI=void 0)}}},t.getCurrentLocation=function(){if(t._bActive)return t._currPos},t.locationFromLatLon=function(t,o){return new THREE.Vector2(t,o)},t.distance_orig=function(o,r){var e=ATON.DEG2RAD*(r.x-o.x),n=ATON.DEG2RAD*(r.y-o.y),i=Math.sin(e/2)*Math.sin(e/2)+Math.cos(ATON.DEG2RAD*o.x)*Math.cos(ATON.DEG2RAD*r.x)*Math.sin(n/2)*Math.sin(n/2),c=2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i));return 1e3*(t.EARTH_R_KM*c)},t.distance=function(o,r){var e=.5-Math.cos((r.x-o.x)*ATON.DEG2RAD)/2+Math.cos(o.x*ATON.DEG2RAD)*Math.cos(r.x*ATON.DEG2RAD)*(1-Math.cos((r.y-o.y)*ATON.DEG2RAD))/2;return 1e3*(t.EARTH_D_KM*Math.asin(Math.sqrt(e)))},t.addPOI=function(o,r){var e={};return e.pos=new THREE.Vector2(o.x,o.y),e.radius=r,t._POIs.push(e),t._bActive||t.enableTracking(),t._handlePOIs(),t._POIs.length-1},t.getPOIbyIndex=function(o){return t._POIs[o]},t.getClosestPOI=function(){return t._closestPOI},t.getClosestPOIdistance=function(){return t._closestPOIdist};var o=t;exports.default=o;
},{}],"Iy9y":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t={init:function(){t._appid=$("meta[name='aton\\:appid']").attr("content"),t._appdata={}},_sendDataPatch:function(e,a,o){return new Promise(function(i,n){if(void 0!==e)if(e.length<3)n("Storage ID too short");else if(void 0!==a)if(void 0!==t._appid){void 0===o&&(o=ATON.PATCH_ADD);var p={};p.wappid=t._appid,p.fid=e,p.data=a,p.mode=o===ATON.PATCH_DEL?"DEL":"ADD";var r=JSON.stringify(p);$.ajax({url:ATON.PATH_RESTAPI+"patch/wapp",type:"POST",data:r,contentType:"application/json; charset=utf-8",dataType:"json",success:function(a){void 0!==a?(t._appdata[e]=a,i(a)):n("Error writing on server")}})}else n("No app-ID");else n("No storage patch");else n("No storage ID specified")})},getAppID:function(){return t._appid},addToStorage:function(e,a){return t._sendDataPatch(e,a,ATON.PATCH_ADD)},deleteFromStorage:function(e,a){return t._sendDataPatch(e,a,ATON.PATCH_DEL)},getStorage:function(e){return new Promise(function(a,o){void 0!==t._appid?void 0!==e?$.getJSON(ATON.PATH_WAPPS+t._appid+"/data/"+e+".json",function(o){console.log(o),t._appdata[e]=o,a(o)}):o("No storage ID specified"):o()})}},e=t;exports.default=e;
},{}],"yaoK":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=m(require("./ATON.node.js")),o=m(require("./ATON.pov.js")),n=m(require("./ATON.lightprobe.js")),i=m(require("./ATON.eventhub.js")),t=m(require("./ATON.mathub.js")),a=m(require("./ATON.utils.js")),r=m(require("./ATON.scenehub.js")),d=m(require("./ATON.audiohub.js")),s=m(require("./ATON.nav.js")),_=m(require("./ATON.xr.js")),u=m(require("./ATON.sui.js")),c=m(require("./ATON.vroadcast.js")),l=m(require("./ATON.semfactory.js")),v=m(require("./ATON.fe.js")),S=m(require("./ATON.mediarec.js")),f=m(require("./ATON.geoloc.js")),p=m(require("./ATON.apphub.js"));function m(e){return e&&e.__esModule?e:{default:e}}var h={};window.ATON=h,h.Node=e.default,h.POV=o.default,h.LightProbe=n.default,h.EventHub=i.default,h.Utils=a.default,h.SceneHub=r.default,h.MatHub=t.default,h.Nav=s.default,h.AudioHub=d.default,h.XR=_.default,h.SUI=u.default,h.VRoadcast=c.default,h.SemFactory=l.default,h.FE=v.default,h.MediaRec=S.default,h.GeoLoc=f.default,h.AppHub=p.default,h.STD_UPVECTOR=new THREE.Vector3(0,1,0),h.ROOT_NID=".",h.RAD2DEG=180/Math.PI,h.DEG2RAD=Math.PI/180,h.PATCH_ADD=0,h.PATCH_DEL=1,h.NTYPES={},h.NTYPES.SCENE=3,h.NTYPES.SEM=4,h.NTYPES.UI=5,h.PATH_RESTAPI=window.location.origin+"/api/",h.PATH_RESTAPI_SCENE=h.PATH_RESTAPI+"scene/",h.PATH_WAPPS=window.location.origin+"/a/",h.PATH_MODS=window.location.origin+"/mods/",h.PATH_DRACO_LIB=window.location.origin+"/dist/draco/",h.PATH_BASIS_LIB=window.location.origin+"/dist/basis/",h.PATH_IFC_LIB=window.location.origin+"/dist/ifc/",h.PATH_COLLECTION=window.location.origin+"/collections/",h.PATH_SCENES=window.location.origin+"/scenes/",h.PATH_RES=window.location.origin+"/res/",h.PATH_FE=window.location.origin+"/fe/",h.SHADOWS_NEAR=.1,h.SHADOWS_FAR=50,h.SHADOWS_SIZE=15,h.SHADOWS_RES=1024,h.AMB_L=.1,h.setPathCollection=function(e){h.PATH_COLLECTION=e},h.setPathScenes=function(e){h.PATH_SCENES=e},h._onUserInteraction=function(){h._elPanoVideo&&!h._vpanoPlaying&&h._elPanoVideo.play(),"suspended"===h.AudioHub._listener.context.state&&h.AudioHub._listener.context.resume()},h._setupBaseListeners=function(){var e=h._renderer.domElement;window.addEventListener("resize",h._onResize,!1),window.onorientationchange=h._readDeviceOrientationMode,screenfull.isEnabled&&screenfull.on("change",function(){h._bFS=screenfull.isFullscreen,h.fireEvent("Fullscreen",h._bFS),h._bFS?console.log("Now fullscreen"):console.log("Exit fullscreen")}),e.addEventListener("mousemove",h._updateScreenMove,!1),e.addEventListener("mousedown",function(e){1===e.button&&h.fireEvent("MouseMidButton"),2===e.button&&h.fireEvent("MouseRightButton")}),e.addEventListener("wheel",h._onMouseWheel,!1),h._bPointerDown=!1,window.addEventListener("pointerdown",function(e){h._bPointerDown=!0,h._onUserInteraction()}),window.addEventListener("pointerup",function(e){h._bPointerDown=!1}),window.addEventListener("pointermove",function(e){h._bPointerDown&&(h._updateScreenMove(e),h._handleQueries())}),window.addEventListener("touchstart",function(e){h._bPointerDown=!0,h._onUserInteraction()}),window.addEventListener("touchend",function(e){h._bPointerDown=!1}),window.addEventListener("touchmove",function(e){h._bPointerDown&&(h._updateScreenMove(e.touches[0]),h._handleQueries())}),Hammer(e).on("doubletap",function(e){h._bPointerDown=!1,h.fireEvent("DoubleTap",e.srcEvent)}),Hammer(e).on("tap",function(e){if(h._bPointerDown=!1,h._onUserInteraction(),h._updateScreenMove(e.srcEvent),h._handleQueries(),h.fireEvent("Tap",e.srcEvent),void 0!==h._hoveredUI){var o=h.getUINode(h._hoveredUI);o&&o.onSelect&&o.onSelect()}}),h.on("DoubleTap",function(e){h.defaultDoubleTapFromScreenCoords(e)}),h._kModShift=!1,h._kModCtrl=!1,h._bListenKeyboardEvents=!0,window.addEventListener("keydown",function(e){h._onUserInteraction(),"Shift"===e.key&&(h._kModShift=!0),"Control"===e.key&&(h._kModCtrl=!0),h._bListenKeyboardEvents&&h.fireEvent("KeyPress",e.key)},!1),window.addEventListener("keyup",function(e){"Shift"===e.key&&(h._kModShift=!1),"Control"===e.key&&(h._kModCtrl=!1),h._bListenKeyboardEvents&&h.fireEvent("KeyUp",e.key)},!1),h.on("KeyPress",function(e){if("+"===e){var o=h.Nav.getFOV()+1;h.Nav.setFOV(o)}if("-"===e){var n=h.Nav.getFOV()-1;h.Nav.setFOV(n)}if("PageUp"===e){var i=h.SUI.mainSelector.scale.x+.02;h.SUI.setSelectorRadius(i)}if("PageDown"===e){var t=h.SUI.mainSelector.scale.x-.02;t=Math.max(t,.01),h.SUI.setSelectorRadius(t)}})},h._onResize=function(){h.Nav._camera.aspect=window.innerWidth/window.innerHeight,h.Nav._camera.updateProjectionMatrix(),h._renderer.setSize(window.innerWidth,window.innerHeight),console.log("onResize")},h._onMouseWheel=function(e){e.preventDefault(),h.fireEvent("MouseWheel",e.deltaY)},h.focusOn3DView=function(){h._renderer.domElement.focus()},h._SUIactivation=function(){var e=h.getUINode(h._hoveredUI);return void 0!==e&&(void 0!==e.onSelect&&(e.onSelect(),!0))},h._stdActivation=function(){if(!h._SUIactivation()&&h.Nav._bControl){if(h.XR._bPresenting)return"immersive-vr"===_.default._sessionType&&_.default.teleportOnQueriedPoint(),void h.FE.playAudioFromSemanticNode(h._hoveredSemNode);if(h.Nav.isFirstPerson()||h.Nav.isDevOri()){if(h.Nav.currentQueryValidForLocomotion()){var e=h._queryDataScene.p,o=h.Nav._vDir,n=new THREE.Vector3(e.x,e.y+h.userHeight,e.z),i=new THREE.Vector3(n.x+o.x,n.y+o.y,n.z+o.z),t=(new h.POV).setPosition(n).setTarget(i).setFOV(h.Nav._currPOV.fov);h.Nav.requestPOV(t,.5)}}else{var a=h.getSemanticNode(h._hoveredSemNode);h._queryDataSem&&a?h.Nav.requestPOVbyNode(a,.5):h._queryDataScene&&h.Nav.requestRetarget(h._queryDataScene.p,void 0,.5)}}},h.defaultDoubleTapFromScreenCoords=function(e){h._updateScreenMove(e),h._handleQueryScene(),h._stdActivation()},h.isFullscreen=function(){return h._bFS},h.toggleFullScreen=function(){screenfull.toggle()},h.realize=function(){console.log("Initialize ATON..."),h.Utils.init(),h.Utils.profileDevice(),h._clock=new THREE.Clock(!0),h._bFS=!1;h._renderer=new THREE.WebGLRenderer({antialias:!0,alpha:!0,powerPreference:"high-performance"}),h._renderer.setSize(window.innerWidth,window.innerHeight),h._stdpxd=1,h._renderer.setPixelRatio(h._stdpxd),h._fps=60,h._dt=.01,h._dtAccum=0,h._avgFPScount=0,h._avgFPSaccum=0,h._avgFPS=60,h._bDynamicDensity=!1,h._aniMixers=[],h._renderer.outputEncoding=THREE.sRGBEncoding,h._renderer.toneMapping=THREE.LinearToneMapping,h._renderer.toneMappingExposure=1,h._renderer.setAnimationLoop(h._onFrame),h._maxAnisotropy=h._renderer.capabilities.getMaxAnisotropy(),console.log(h._renderer.capabilities),THREE.Cache.enabled=!0,h.userHeight=1.7,document.body.appendChild(h._renderer.domElement);var e=h._renderer.domElement;e.style.outline="none",e.style.border="none",h._vpanoPlaying=!1,h._bUserInts=0,h.EventHub.init(),h.MatHub.init(),h._assetsManager={},h._aLoader=new THREE.GLTFLoader,h._dracoLoader=new THREE.DRACOLoader,h._dracoLoader.setDecoderPath(h.PATH_DRACO_LIB),h._aLoader.setDRACOLoader(h._dracoLoader),h._numReqLoad=0,h._ccModels=[],h._updRoutines=[],h._lps=[],h._bAutoLP=!1,h._envMapInt=1,h._bShadowsFixedBound=!1,h._shadowsNear=h.SHADOWS_NEAR,h._shadowsFar=h.SHADOWS_FAR,h._shadowsSize=h.SHADOWS_SIZE,h._shadowsRes=h.SHADOWS_RES,h.initGraphs(),h.SceneHub.init(),h._tsets=[],h.AudioHub.init(),h.Nav.init(),h.XR.init(),h.SUI.init(),h.VRoadcast.init(),h.MediaRec.init(),h.SemFactory.init(),h.AppHub.init(),h.GeoLoc.init(),h._queryDataScene=void 0,h._queryDataSem=void 0,h._queryDataUI=void 0,h._hoveredSemNode=void 0,h._hoveredUI=void 0,h._bQuerySemOcclusion=!0,h._bQueryNormals=!0,h._bPauseQuery=!1,h._bqScene=!1,h._bqSem=!1,h._tgiDur=void 0,h._tgiPer=void 0,h._tHover=void 0,h._screenPointerCoords=new THREE.Vector2(0,0),h._rcScene=new THREE.Raycaster,h._rcScene.layers.set(h.NTYPES.SCENE),h._rcSemantics=new THREE.Raycaster,h._rcSemantics.layers.set(h.NTYPES.SEM),h._rcUI=new THREE.Raycaster,h._rcUI.layers.set(h.NTYPES.UI),h._registerRCS(),h._setupBaseListeners(),h.device.isMobile&&h._readDeviceOrientationMode(),h._wappID=void 0,h.focusOn3DView()},h.setTimedGazeDuration=function(e){h._tgiDur=e},h.getTimedGazeProgress=function(){if(void 0!==h._tgiDur)return h._tgiPer},h.getElapsedTime=function(){return h._clock.elapsedTime},h.renderPause=function(){h._renderer.setAnimationLoop(void 0)},h.renderResume=function(){h._renderer.setAnimationLoop(h._onFrame)},h._setupLoadManager=function(){h._loadManager=new THREE.LoadingManager,h._loadManager.onStart=function(e,o,n){console.log("Started loading file: "+e+".\nLoaded "+o+" of "+n+" files."),h.fireEvent("NodeRequestFired",e)},h._loadManager.onLoad=function(){console.log("Loading complete!"),h.fireEvent("AllNodeRequestsCompleted")},h._loadManager.onProgress=function(e,o,n){},h._loadManager.onError=function(e){console.log("There was an error loading "+e)}},h.setDefaultPixelDensity=function(e){h._stdpxd=e,h._renderer.setPixelRatio(e),void 0!==h._renderer.xr&&(h.device.isMobile?h._renderer.xr.setFramebufferScaleFactor(h._stdpxd*h.XR.MOBILE_DENSITY_F):h._renderer.xr.setFramebufferScaleFactor(h._stdpxd))},h.resetPixelDensity=function(){h._renderer.setPixelRatio(h._stdpxd)},h._readDeviceOrientationMode=function(){90===Math.abs(window.orientation)?(console.log("Landscape Mode"),h.fireEvent("MobileLandscapeMode")):(console.log("Portrait Mode"),h.fireEvent("MobilePortraitMode")),setTimeout(h._onResize,500)},h.snodes={},h.semnodes={},h.uinodes={},h.createSceneNode=function(e){return new h.Node(e,h.NTYPES.SCENE)},h.getSceneNode=function(e){if(void 0!==e)return h.snodes[e]},h.getOrCreateSceneNode=function(e){var o=h.getSceneNode(e);return void 0!==o?o:h.createSceneNode(e)},h.getRootScene=function(){return h._rootVisible},h.createSemanticNode=function(e){return new h.Node(e,h.NTYPES.SEM)},h.getSemanticNode=function(e){if(void 0!==e)return h.semnodes[e]},h.getOrCreateSemanticNode=function(e){var o=h.getSemanticNode(e);return void 0!==o?o:h.createSemanticNode(e)},h.getRootSemantics=function(){return h._rootSem},h.createUINode=function(e){return new h.Node(e,h.NTYPES.UI)},h.getUINode=function(e){if(void 0!==e)return h.uinodes[e]},h.getRootUI=function(){return h._rootUI},h._assetReqNew=function(e){h._numReqLoad++,h.fireEvent("NodeRequestFired",e)},h._assetReqComplete=function(e){h.fireEvent("NodeRequestCompleted",e),h._numReqLoad--,h._numReqLoad<=0&&h._onAllReqsCompleted()},h._onAllReqsCompleted=function(){var e=h._rootVisible.getBound().center,o=h._rootVisible.getBound().radius;h._renderer.shadowMap.enabled&&(h._rootVisible.traverse(function(e){e.isMesh&&(e.castShadow=!0,e.receiveShadow=!0)}),h.adjustShadowsParamsFromSceneBounds(),h._bShadowsFixedBound&&h.updateDirShadows(e)),h._bAutoLP&&(void 0===h._lps[0]?h.addLightProbe((new h.LightProbe).setPosition(e).setNear(o)):h._lps[0].setPosition(e.x,e.y,e.z).setNear(o),console.log("Auto LP")),e&&h._mMainPano&&h._mMainPano.position.copy(e),h.getRootScene().assignLightProbesByProximity(),h.fireEvent("AllNodeRequestsCompleted"),h._postAllReqsCompleted(),setTimeout(function(){h.updateLightProbes(),h._renderer.shadowMap.enabled&&h._bShadowsFixedBound&&0===h._aniMixers.length&&(h._dMainL.shadow.autoUpdate=!1,console.log("Lazy shadows"))},1e3)},h._postAllReqsCompleted=function(e){for(var o in void 0===e&&(e=h._rootVisible),e.children){var n=e.children[o];n&&n.toggle&&(h._postAllReqsCompleted(n),n.toggle(n.visible))}},h.initGraphs=function(){h._mainRoot=new THREE.Scene,h._mainRoot.background=new THREE.Color(.7,.7,.7),h._rootVisibleGlobal=new THREE.Group,h._mainRoot.add(h._rootVisibleGlobal),h._rootVisible=h.createSceneNode().setAsRoot(),h._rootVisibleGlobal.add(h._rootVisible),h._rootSem=h.createSemanticNode().setAsRoot(),h._mainRoot.add(h._rootSem),h._rootUI=h.createUINode().setAsRoot(),h._mainRoot.add(h._rootUI),h.ambLight=new THREE.AmbientLight(new THREE.Color(1,1,1)),h._rootVisibleGlobal.add(h.ambLight)},h.setBackgroundColor=function(e){h._mainRoot.background=e},h.setAutoLP=function(e){h._bAutoLP=e},h.setNeutralAmbientLight=function(e){h.ambLight.color=new THREE.Color(e,e,e)},h.addLightProbe=function(e){void 0!==e&&(0===h._lps.length&&h.setNeutralAmbientLight(h.AMB_L),h._lps.push(e),void 0!==h.SUI.gLPIcons&&u.default.addLPIcon(e))},h.updateLightProbes=function(){if(0!==h._lps.length){for(var e in h._lps)h._lps[e].update();h._lps[0]&&(h._indLP&&h._mainRoot.remove(h._indLP),h._indLP=THREE.LightProbeGenerator.fromCubeRenderTarget(h._renderer,h._lps[0]._prevCCtarget),h._indLP.intensity=1,h._mainRoot.add(h._indLP)),h._rootVisible.traverse(function(e){var o=e.userData.LP;void 0!==o&&o instanceof h.LightProbe&&(e.material.envMap=o.getEnvTex(),e.material.combine=THREE.AddOperation,e.material.envMapIntensity=h._envMapInt)}),console.log("LPs updated.")}},h.setMainPanorama=function(e){var o=void 0;e=h.Utils.resolveCollectionURL(e),h.Utils.isVideo(e)?(void 0===h._elPanoVideo&&(h._elPanoVideo=document.createElement("video"),h._elPanoVideo.id="idPanoVideo",h._elPanoVideo.innerHTML="<source src='"+e+"'>",h._elPanoVideo.crossOrigin="anonymous",h._elPanoVideo.loop=!0,h._elPanoVideo.playsinline=!0,h._elPanoVideo.style.cssText="display:none;",h._elPanoVideo.autoplay=!0,h._elPanoVideo.onplaying=function(){console.log("VideoPano playing"),h._vpanoPlaying=!0}),(o=new THREE.VideoTexture(h._elPanoVideo)).encoding=THREE.sRGBEncoding):((o=(new THREE.TextureLoader).load(e)).encoding=THREE.sRGBEncoding,o.generateMipmaps=!0),void 0===h._matMainPano?(h._gMainPano=new THREE.SphereBufferGeometry(1,60,60),h._gMainPano.castShadow=!1,h._gMainPano.receiveShadow=!1,h._matMainPano=new THREE.MeshBasicMaterial({map:o,depthTest:!1,depthWrite:!1}),h._mMainPano=new THREE.Mesh(h._gMainPano,h._matMainPano),h._mMainPano.frustumCulled=!1,h._mMainPano.renderOrder=-100,h.setMainPanoramaRadius(.8*h.Nav.STD_FAR),h._mMainPano.onAfterRender=function(){h.Nav._currPOV&&h._mMainPano.position.copy(h.Nav._currPOV.pos)},h._rootVisibleGlobal.add(h._mMainPano)):h._matMainPano.map=o},h.setMainPanoramaRadius=function(e){void 0!==h._gMainPano&&h._gMainPano.scale(-e,e,e)},h.setMainPanoramaRotation=function(e){void 0!==h._mMainPano&&h._mMainPano.rotation.set(0,e,0)},h.setMainLightDirection=function(e){var o=e.clone();o.normalize(),o.x*=.5*h.SHADOWS_FAR,o.y*=.5*h.SHADOWS_FAR,o.z*=.5*h.SHADOWS_FAR,void 0===h._dMainL&&(h._dMainL=new THREE.DirectionalLight(new THREE.Color(1,1,1),1),h._dMainL.castShadow=!1,h._dMainLtgt=new THREE.Object3D,h._rootVisibleGlobal.add(h._dMainLtgt),h._dMainL.target=h._dMainLtgt,h._rootVisibleGlobal.add(h._dMainL),h._dMainLpos=new THREE.Vector3),h._dMainLdir=o,h._dMainL.position.set(-o.x,-o.y,-o.z),h._renderer.shadowMap.enabled&&(h._dMainL.shadow.needsUpdate=!0),h.toggleMainLight(!0)},h.getMainLightDirection=function(){if(void 0!==h._dMainLdir){var e=h._dMainLdir.clone();return e.normalize(),e}},h.toggleMainLight=function(e){void 0!==h._dMainL&&(h._dMainL.visible=e,e?(h.setNeutralAmbientLight(h.AMB_L),h.updateDirShadows()):h.setNeutralAmbientLight(1))},h.isMainLightEnabled=function(){return void 0!==h._dMainL&&!!h._dMainL.visible},h.setExposure=function(e){h._renderer.toneMappingExposure=e},h.getExposure=function(){return h._renderer.toneMappingExposure},h.adjustShadowsParamsFromSceneBounds=function(){var e=h._rootVisible.getBound().radius;h._rootVisible.getBound().center;e<=0||e>=h.SHADOWS_SIZE?(h._bShadowsFixedBound=!1,h._shadowsSize=h.SHADOWS_SIZE):(h._bShadowsFixedBound=!0,h._shadowsSize=1.5*e),h._dMainL.shadow.map&&(h._dMainL.shadow.map.dispose(),h._dMainL.shadow.map=null),h._dMainL.shadow.camera.left=-h._shadowsSize,h._dMainL.shadow.camera.right=h._shadowsSize,h._dMainL.shadow.camera.bottom=-h._shadowsSize,h._dMainL.shadow.camera.top=h._shadowsSize,h._dMainL.shadow.mapSize.width=h._shadowsRes,h._dMainL.shadow.mapSize.height=h._shadowsRes,h._dMainL.shadow.camera.near=h._shadowsNear,h._dMainL.shadow.camera.far=h._shadowsFar,h._dMainL.shadow.bias=-5e-4},h.toggleShadows=function(e){if(void 0!==h._dMainL)if(e){if(h._dMainL.castShadow=!0,h._renderer.shadowMap.enabled=!0,h.device.isMobile?h._renderer.shadowMap.type=THREE.PCFShadowMap:h._renderer.shadowMap.type=THREE.PCFSoftShadowMap,h._rootVisible.traverse(function(e){e.isMesh&&(e.castShadow=!0,e.receiveShadow=!0)}),h.adjustShadowsParamsFromSceneBounds(),h._bShadowsFixedBound){var o=h._rootVisible.getBound().center;h.updateDirShadows(o)}else h.updateDirShadows();h._dMainL.shadow.needsUpdate=!0,console.log("Shadows ON")}else h._dMainL.castShadow=!1,h._renderer.shadowMap.enabled=!1,console.log("Shadows OFF")},h.updateDirShadows=function(e){void 0!==h._dMainLdir&&(void 0===e?(e=h.Nav.getCurrentEyeLocation(),h._dMainLpos.x=e.x+h.Nav._vDir.x*h._shadowsSize,h._dMainLpos.y=e.y+h.Nav._vDir.y*h._shadowsSize,h._dMainLpos.z=e.z+h.Nav._vDir.z*h._shadowsSize):(h._dMainLpos.x=e.x,h._dMainLpos.y=e.y,h._dMainLpos.z=e.z),h._dMainL.position.set(h._dMainLpos.x-h._dMainLdir.x,h._dMainLpos.y-h._dMainLdir.y,h._dMainLpos.z-h._dMainLdir.z),h._dMainLtgt.position.copy(h._dMainLpos))},h._updateEnvironment=function(){h._renderer.shadowMap.enabled&&(h._bShadowsFixedBound||h.updateDirShadows())},h.setGlobalAudio=function(e,o){void 0!==e&&(void 0===o&&(o=!0),e=h.Utils.resolveCollectionURL(e),void 0===h._auMain||null===h._auMain?h._auMain=new THREE.Audio(h.AudioHub._listener):h._auMain.isPlaying&&h._auMain.stop(),h.AudioHub._loader.load(e,function(e){h._auMain.setBuffer(e),h._auMain.setLoop(o),h._auMain.play()}))},h._markFPS=function(){if(!(h._numReqLoad>0)){var e=1/h._dt;if(h._avgFPScount+=1,h._dtAccum+=h._dt,h._avgFPSaccum+=e,!(h._dtAccum<1)&&(h._fps=h._avgFPSaccum/h._avgFPScount,h._avgFPSaccum=0,h._avgFPScount=0,h._dtAccum=0,h._bDynamicDensity)){var o=h._renderer.getPixelRatio();h._fps<30&&(o*=.75)>=.1&&(h._renderer.setPixelRatio(o),console.log(o)),h._fps>50&&(o*=1.33)<=h._stdpxd&&(h._renderer.setPixelRatio(o),console.log(o))}}},h._onFrame=function(){h._dt=h._clock.getDelta(),h._markFPS(),h.XR._bPresenting?h.XR.update():h.Nav._controls.update(h._dt),h._handleQueries(),h.Nav.update(),h.VRoadcast.update(),h.SUI.update(),h.MatHub.update(),h._updateEnvironment(),h._updateAniMixers(),h._updateRoutines(),h._updateTSets(),h._renderer.render(h._mainRoot,h.Nav._camera)},h.addUpdateRoutine=function(e){void 0!==e&&h._updRoutines.push(e)},h.deleteAllUpdateRoutines=function(){h._updRoutines=[]},h._updateRoutines=function(){var e=h._updRoutines.length;if(!(e<=0))for(var o=0;o<e;o++)h._updRoutines[o]()},h._updateTSets=function(){var e=h._tsets.length;if(!(e<=0)){h.Nav._camera.updateMatrixWorld();for(var o=0;o<e;o++){h._tsets[o].update()}}},h._updateAniMixers=function(){var e=h._aniMixers.length;if(!(e<1))for(var o=0;o<e;o++){h._aniMixers[o].update(h._dt)}},h._updateScreenMove=function(e){if(e.preventDefault&&e.preventDefault(),h.Nav._mode===h.Nav.MODE_DEVORI)return h._screenPointerCoords.x=0,void(h._screenPointerCoords.y=0);h._screenPointerCoords.x=e.clientX/window.innerWidth*2-1,h._screenPointerCoords.y=-e.clientY/window.innerHeight*2+1},h._registerRCS=function(){h._rcRR=0,h._rcHandlers=[],h._rcHandlers.push(h._handleQueryScene),h._rcHandlers.push(h._handleQuerySemantics),h._rcHandlers.push(h._handleQueryUI)},h._handleQueries=function(){if(!h._bPauseQuery&&!h.Nav._bInteracting&&!(h._numReqLoad>0||h.Nav.isTransitioning()||(h._handleQueryUI(),h._bqScene&&h._handleQueryScene(),h._bqSem&&h._handleQuerySemantics(),h.Nav.locomotionValidator(),void 0===h._tgiDur||void 0===h._tHover))){var e=h._clock.elapsedTime-h._tHover;e>=h._tgiDur?(h._stdActivation(),h._tHover=void 0,h._tgiPer=void 0):h._tgiPer=e/h._tgiDur}},h._handleQueryScene=function(){if(h.XR.isPresenting()?h.XR.setupQueryRay(h._rcScene):h._rcScene.setFromCamera(h._screenPointerCoords,h.Nav._camera),h._hitsScene=[],h._rcScene.intersectObjects(h._mainRoot.children,!0,h._hitsScene),h._hitsScene.length<=0)h._queryDataScene=void 0;else{var e=h._hitsScene[0];h._queryDataScene={},h._queryDataScene.p=e.point,h._queryDataScene.d=e.distance,h._queryDataScene.o=e.object,h._bQueryNormals&&null!==e.face&&void 0!==e.face.normal&&(h._queryDataScene.matrixWorld=(new THREE.Matrix3).getNormalMatrix(e.object.matrixWorld),h._queryDataScene.n=e.face.normal.clone().applyMatrix3(h._queryDataScene.matrixWorld).normalize())}},h.getSceneQueriedPoint=function(){if(void 0!==h._queryDataScene)return h._queryDataScene.p},h.getSceneQueriedDistance=function(){if(void 0!==h._queryDataScene)return h._queryDataScene.d},h.getSceneQueriedNormal=function(){if(void 0!==h._queryDataScene)return h._queryDataScene.n},h._handleQuerySemantics=function(){if(h.XR.isPresenting()?h.XR.setupQueryRay(h._rcSemantics):h._rcSemantics.setFromCamera(h._screenPointerCoords,h.Nav._camera),h._hitsSem=[],h._rcSemantics.intersectObjects(h._mainRoot.children,!0,h._hitsSem),h._hitsSem.length<=0){if(h._queryDataSem=void 0,h._hoveredSemNode){h.fireEvent("SemanticNodeLeave",h._hoveredSemNode);var e=h.getSemanticNode(h._hoveredSemNode);e&&e.onLeave&&e.onLeave()}return h._hoveredSemNode=void 0,void(h._tHover=void 0)}var o=h._hitsSem[0];if(h._bQuerySemOcclusion&&h._queryDataScene&&h._queryDataScene.d<o.distance){if(h._queryDataSem=void 0,h._hoveredSemNode){h.fireEvent("SemanticNodeLeave",h._hoveredSemNode);var n=h.getSemanticNode(h._hoveredSemNode);n&&n.onLeave&&n.onLeave()}return h._hoveredSemNode=void 0,void(h._tHover=void 0)}h._queryDataSem={},h._queryDataSem.p=o.point,h._queryDataSem.d=o.distance,h._queryDataSem.o=o.object,h._queryDataSem.list=[];for(var i=h._queryDataSem.list,t=o.object.parent;t;)t.nid&&t.nid!==h.ROOT_NID&&i.push(t.nid),t=t.parent;var a=i[0];if(a&&h._hoveredSemNode!==a){if(h._hoveredSemNode){h.fireEvent("SemanticNodeLeave",h._hoveredSemNode);var r=h.getSemanticNode(h._hoveredSemNode);r&&r.onLeave&&r.onLeave(),h._tHover=void 0}h._hoveredSemNode=a,h.fireEvent("SemanticNodeHover",a);var d=h.getSemanticNode(a);d&&d.onHover&&d.onHover(),h._tHover=h._clock.elapsedTime}},h._handleQueryUI=function(){if(h.XR.isPresenting()?h.XR.setupQueryRay(h._rcUI):h._rcUI.setFromCamera(h._screenPointerCoords,h.Nav._camera),h._hitsUI=[],h._rcUI.intersectObjects(h._mainRoot.children,!0,h._hitsUI),h._hitsUI.length<=0){if(h._queryDataUI=void 0,h._hoveredUI){h.fireEvent("UINodeLeave",h._hoveredUI);var e=h.getUINode(h._hoveredUI);e&&e.onLeave&&e.onLeave()}return h._hoveredUI=void 0,void(h._tHover=void 0)}var o=h._hitsUI[0];if(h._queryDataScene&&h._queryDataScene.d<o.distance){if(h._queryDataUI=void 0,h._hoveredUI){h.fireEvent("UINodeLeave",h._hoveredUI);var n=h.getUINode(h._hoveredUI);n&&n.onLeave&&n.onLeave()}return h._hoveredUI=void 0,void(h._tHover=void 0)}h._queryDataUI={},h._queryDataUI.p=o.point,h._queryDataUI.d=o.distance,h._queryDataUI.o=o.object,h._queryDataUI.list=[];for(var i=h._queryDataUI.list,t=o.object.parent;t;)t.nid&&t.nid!==h.ROOT_NID&&i.push(t.nid),t=t.parent;var a=i[0];if(a&&h._hoveredUI!==a){if(h._hoveredUI){h.fireEvent("UINodeLeave",h._hoveredUI);var r=h.getUINode(h._hoveredUI);r&&r.onLeave&&r.onLeave(),h._tHover=void 0}h._hoveredUI=a,h.fireEvent("UINodeHover",a);var d=h.getUINode(a);d&&d.onHover&&d.onHover(),h._tHover=h._clock.elapsedTime}};var g=h;exports.default=g;
},{"./ATON.node.js":"XTSP","./ATON.pov.js":"CwXu","./ATON.lightprobe.js":"MNcy","./ATON.eventhub.js":"LryX","./ATON.mathub.js":"R8yv","./ATON.utils.js":"P9TA","./ATON.scenehub.js":"qC8Z","./ATON.audiohub.js":"mYhb","./ATON.nav.js":"nomA","./ATON.xr.js":"jROx","./ATON.sui.js":"xSlA","./ATON.vroadcast.js":"mY3J","./ATON.semfactory.js":"dQQK","./ATON.fe.js":"Z6YW","./ATON.mediarec.js":"jdcn","./ATON.geoloc.js":"uZX1","./ATON.apphub.js":"Iy9y"}]},{},["yaoK"], null)
//# sourceMappingURL=/ATON.min.js.map