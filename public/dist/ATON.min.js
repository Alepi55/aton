parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"XTSP":[function(require,module,exports) {
"use strict";function t(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;class e extends THREE.Group{constructor(e,i){super(),t(this,"updateLightProbes",()=>(this.traverse(t=>{if(t.isMesh&&t.geometry){let e=t.userData.LP;void 0!==e&&(e.update(),t.material.envMap=e.getEnvTex())}}),this)),this.type=i||ATON.NTYPES.SCENE,this.enablePicking(),this.type===ATON.NTYPES.SCENE&&(this._rootG=ATON._rootVisible,this._nodes=ATON.snodes),this.type===ATON.NTYPES.SEM&&(this._rootG=ATON._rootSem,this._nodes=ATON.semnodes),this.type===ATON.NTYPES.UI&&(this._rootG=ATON._rootUI,this._nodes=ATON.uinodes),this.as(e),this.kwords=void 0,this._bCloneOnLoadHit=!0,this._tlist=void 0,this._aniMixers=void 0,this.castShadow=!1,this.receiveShadow=!1,this.onHover=void 0,this.onLeave=void 0,this.onSelect=void 0}as(t){if(void 0!==t&&t!==ATON.ROOT_NID)return this._nodes[t]=this,this.nid=t,this.name=t,this}setAsRoot(){return this._nodes[ATON.ROOT_NID]=this,this.nid=ATON.ROOT_NID,this}setCloneOnLoadHit(t){return this._bCloneOnLoadHit=t,this}addKeywords(t){let e=t.split(",");void 0===this.kwords&&(this.kwords={});for(let i in e){let t=e[i].trim();t.length>0&&(this.kwords[t]=!0)}for(let i in this.children){let e=this.children[i];void 0!==e.type&&e.addKeywords(t)}return this}hasKeyword(t){if(void 0!==this.kwords)return void 0!==this.kwords[t]}setDescription(t){return this.userData.description=t,this}getDescription(){return this.userData.description}setAudio(t){return this.userData.audio=t,this}getAudio(){return this.userData.audio}hide(){return this.visible=!1,ATON.Utils.setPicking(this,this.type,!1),ATON._renderer.shadowMap.enabled&&(ATON._dMainL.shadow.needsUpdate=!0),this}show(){return this.visible=!0,ATON.Utils.setPicking(this,this.type,this.bPickable),ATON._renderer.shadowMap.enabled&&void 0!==ATON._dMainL&&void 0!==ATON._dMainL.shadow&&(ATON._dMainL.shadow.needsUpdate=!0),this}toggle(t){return void 0===t?this.visible?this.hide():this.show():t?this.show():this.hide()}disablePicking(){return this.bPickable=!1,ATON.Utils.setPicking(this,this.type,this.bPickable),this}enablePicking(){return this.bPickable=!0,ATON.Utils.setPicking(this,this.type,this.bPickable),this}setPickable(t){return t?this.enablePicking():this.disablePicking(),this}setMaterial(t){this.userData.cMat=t,this.traverse(e=>{e.isMesh&&(e.material=t),e.type&&(this.userData.cMat=t)});for(let e in this.children){let i=this.children[e];i.setMaterial&&i.setMaterial(t)}return this}getMaterial(){return this.userData.cMat}setDefaultAndHighlightMaterials(t,e){return this.userData.matSTD=t,this.userData.matHL=e,this}highlight(){return this.userData.matHL&&this.setMaterial(this.userData.matHL),this}restoreDefaultMaterial(){return this.userData.matSTD&&this.setMaterial(this.userData.matSTD),this}setOpacity(t){return this.traverse(e=>{e.isMesh&&(e.material.opacity=t)}),this}setShadowCast(t){return this.castShadow=t,this.traverse(e=>{e.isMesh&&(e.castShadow=t)}),this}setShadowReceive(t){return this.receiveShadow=t,this.traverse(e=>{e.isMesh&&(e.receiveShadow=t)}),this}setEnvMap(t){return this.traverse(e=>{e.isMesh&&(e.material.envMap=t)}),this}assignLightProbe(t){return this.traverse(e=>{e.isMesh&&e.geometry&&ATON.Utils.assignLightProbeToMesh(t,e)}),this}assignLightProbesByProximity(){return 0===ATON._lps.length?this:(this.traverse(t=>{if(t.isMesh&&t.geometry){let e=new THREE.Vector3,i=((new THREE.Box3).setFromObject(t).getCenter(e),void 0),s=void 0;for(let t in ATON._lps){let r=ATON._lps[t],o=e.distanceToSquared(r.pos);(void 0===i||o<s)&&(s=o,i=r)}i&&ATON.Utils.assignLightProbeToMesh(i,t)}}),this)}duplicate(){let t=this.clone();return t.traverse(t=>{t.isMesh&&(t.material=t.material.clone())}),t}delete(){let t=this.parent;void 0!==t&&void 0!==t.nid&&t.removeChild(this)}removeChild(t){if(void 0===t)return;t.nid;return void 0!==t.nid&&(this._nodes[t.nid]=void 0),t.parent=void 0,t.traverse(t=>{t.geometry&&t.geometry.dispose(),t.material&&t.material.dispose()}),this.remove(t),this}removeChildren(){for(let t=this.children.length-1;t>=0;t--)this.removeChild(this.children[t]);return this}attachTo(t){let e="string"==typeof t?this._nodes[t]:t;return e&&(e.add(this),void 0!==e.userData.cMat&&(this.userData.cMat=e.userData.cMat),void 0!==e.bPickable&&(this.bPickable=e.bPickable)),e}attachToRoot(){return this._rootG.add(this),void 0!==this._rootG.userData.cMat&&(this.userData.cMat=this._rootG.userData.cMat),void 0!==this._rootG.bPickable&&(this.bPickable=this._rootG.bPickable),this._rootG}getBound(){let t=(new THREE.Box3).setFromObject(this),e=new THREE.Sphere;return t.getBoundingSphere(e),e}setPosition(t,e,i){return t instanceof THREE.Vector3?this.position.copy(t):this.position.set(t,e,i),this}setScale(t,e,i){return t instanceof THREE.Vector3?this.scale.copy(t):(void 0===e&&(e=t,i=t),this.scale.set(t,e,i)),this}setRotation(t,e,i){return t instanceof THREE.Vector3?this.rotation.copy(t):this.rotation.set(t,e,i),this}orientToCamera(){return this.quaternion.copy(ATON.Nav._qOri),this}setYup(){return this.rotation.set(-1.57079632679,0,0),this}addTransform(t){let e=void 0;return"string"==typeof t&&(e=ATON.Utils.parseTransformString(t)),void 0===e?this:(void 0===this._tlist&&(this._tlist=[]),this._tlist.push(e),this)}load(t,e){if(void 0===t)return this;t=ATON.Utils.resolveCollectionURL(t);let i=this;if(t.endsWith("tileset.json"))return ATON.Utils.loadTileSet(t,i),ATON._bqScene=!0,e&&e(),i;if(i._bCloneOnLoadHit&&void 0!==ATON._assetsManager[t])return ATON._assetsManager[t].then(t=>{let s=t.clone();if(ATON.Utils.modelVisitor(i,s),void 0!==i._tlist)for(let e in i._tlist)i._tlist[e].add(s.clone()),i.add(i._tlist[e]);else i.add(s);e&&e()}),console.log("HIT!"),i;ATON._assetReqNew(t);let s=new Promise((s,r)=>{ATON._aLoader.load(t,r=>{let o=r.scene||r.scene[0];if(ATON.Utils.modelVisitor(i,o),void 0!==i._tlist)for(let t in i._tlist)i._tlist[t].add(o.clone()),i.add(i._tlist[t]);else i.add(o);ATON.Utils.registerAniMixers(i,r),ATON.Utils.ccExtract(r),s(o),console.log("Model loaded"),ATON._assetReqComplete(t),i.type===ATON.NTYPES.SCENE&&(ATON._bqScene=!0),i.type===ATON.NTYPES.SEM&&(ATON._bqSem=!0),i.bPickable&&i.enablePicking(),e&&e()},void 0,i=>{console.log("Error loading model"),ATON._assetReqComplete(t),e&&e()})});return i._bCloneOnLoadHit&&(ATON._assetsManager[t]=s),this}exportAs(t){return ATON.Utils.exportNode(this,t),this}setOnHover(t){return this.onHover=t,this}setOnLeave(t){return this.onLeave=t,this}setOnSelect(t){return this.onSelect=t,this}}var i=e;exports.default=i;
},{}],"CwXu":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;class t{constructor(t){this.pos=new THREE.Vector3(1,0,0),this.target=new THREE.Vector3(0,0,0),this.up=ATON.STD_UPVECTOR,this.fov=void 0,this.nextPOV=void 0,this.prevPOV=void 0,this.as(t)}as(t){if(void 0!==t)return ATON.Nav.povlist[t]=this,this.id=t,this}setPosition(t,s,e){return t instanceof THREE.Vector3?this.pos.copy(t):this.pos.set(t,s,e),this}setTarget(t,s,e){return t instanceof THREE.Vector3?this.target.copy(t):this.target.set(t,s,e),this}setFOV(t){return this.fov=t,this}addKeywords(t){let s=t.split(",");void 0===this.kwords&&(this.kwords={});for(let e in s){let t=s[e].trim();t.length>0&&(this.kwords[t]=!0)}return this}hasKeyword(t){if(void 0!==this.kwords)return void 0!==this.kwords[t]}setNextPOV(t){if(t)return this.nextPOV=t,this}setPrevPOV(t){if(t)return this.prevPOV=t,this}}var s=t;exports.default=s;
},{}],"MNcy":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;class e{constructor(e,t,s){this.pos=new THREE.Vector3(0,0,0),this._res=void 0!==e?e:64,this._near=void 0!==t?t:1,this._far=void 0!==s?s:ATON.Nav.STD_FAR,this._envtex=void 0,this._prevCCtarget=void 0}setPosition(e,t,s){return e instanceof THREE.Vector3?this.pos.copy(e):this.pos.set(e,t,s),this}setNear(e){return this._near=e,this}setFar(e){return this._far=e,this}update(){this._envtex&&this._envtex.dispose(),this._prevCCtarget&&this._prevCCtarget.dispose();let e=new THREE.WebGLCubeRenderTarget(this._res,{format:THREE.RGBEFormat,generateMipmaps:!0,minFilter:THREE.LinearMipmapLinearFilter,encoding:THREE.sRGBEncoding}),t=new THREE.CubeCamera(this._near,this._far,e);return t.position.copy(this.pos),t.update(ATON._renderer,ATON._rootVisibleGlobal),this._envtex=e.texture,this._prevCCtarget=e,this}getEnvTex(){return this._envtex}assignToNode(e){}}var t=e;exports.default=t;
},{}],"LryX":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;let e={init:()=>{e.evLocal={},e.evNetwork={},ATON.on=e.on,ATON.fireEvent=e.fireEvent,ATON.clearEventHandlers=e.clearEventHandlers},clearEventHandlers:t=>{e.evLocal[t]=[],e.evNetwork[t]=[]},executeHandlers:(e,t)=>{if(e)for(let o=0;o<e.length;o++){const n=e[o];n&&n(t)}},on:(t,o,n)=>{if(void 0!==o){const n=e.evLocal;void 0===n[t]&&(n[t]=[]),n[t].push(o)}void 0!==n&&ATON.VRoadcast.on(t,n)},fireEvent:(t,o,n)=>{const r=e.evLocal[t];e.executeHandlers(r,o),n&&ATON.VRoadcast.fireEvent(t,o)}};var t=e;exports.default=t;
},{}],"R8yv":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;let e={init:()=>{e.materials={},e.colors={},e._loader=new THREE.MaterialLoader,e._uSem={time:{type:"float",value:0},tint:{type:"vec4",value:new THREE.Vector4(.2,.2,1,.2)}},e.addDefaults()},getDefVertexShader:()=>"\n        varying vec3 vPositionW;\n        varying vec3 vNormalW;\n        varying vec3 vNormalV;\n\n        void main(){\n            vPositionW = vec3( vec4( position, 1.0 ) * modelMatrix);\n            vNormalW   = normalize( vec3( vec4( normal, 0.0 ) * modelMatrix ) );\n            vNormalV   = normalize( vec3( normalMatrix * normal ));\n\n            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n        }\n    ",addDefaults:()=>{e.colors.white=new THREE.Color(1,1,1),e.colors.black=new THREE.Color(0,0,0),e.colors.green=new THREE.Color(0,1,0),e.colors.yellow=new THREE.Color(1,1,0),e.colors.red=new THREE.Color(1,0,0),e.colors.blue=new THREE.Color(0,0,1),e.colors.orange=new THREE.Color(1,.5,0),e.colors.defUI=new THREE.Color(0,1,.5),e.colors.sem=new THREE.Color(0,1,.5),e.colors.darksem=new THREE.Color(0,0,.1),e.materials.fullyTransparent=new THREE.MeshBasicMaterial({transparent:!0,depthWrite:!1,opacity:0}),e.materials.defUI=new THREE.ShaderMaterial({uniforms:{color:{type:"vec3",value:e.colors.defUI},opacity:{type:"float",value:.8}},vertexShader:e.getDefVertexShader(),fragmentShader:"\n            varying vec3 vPositionW;\n\t\t    varying vec3 vNormalW;\n            varying vec3 vNormalV;\n            uniform vec3 color;\n            uniform float opacity;\n\n\t\t    void main(){\n\t\t        //vec3 viewDirectionW = normalize(cameraPosition - vPositionW);\n\n                float f;\n\t\t        //f = dot(viewDirectionW, vNormalW);\n                f = dot(vNormalV, vec3(0,0,1));\n\t\t        f = clamp(1.0 - f, 0.2, 1.0);\n\n\t\t        gl_FragColor = vec4(color.rgb, f * opacity);\n\t\t    }\n        ",transparent:!0,depthWrite:!1}),e.materials.selector=e.materials.defUI.clone(),e.materials.controllerRay=e.materials.defUI.clone(),e.materials.controllerRay.uniforms.color.value=e.colors.white,e.materials.teleportLoc=new THREE.MeshBasicMaterial({transparent:!0,opacity:1,depthWrite:!1,side:THREE.DoubleSide}),ATON.Utils.textureLoader.load(ATON.PATH_RES+"grad.png",t=>{e.materials.teleportLoc.map=t}),e.materials.measurement=new THREE.MeshBasicMaterial({color:e.colors.white,transparent:!0,depthWrite:!1,opacity:.5,depthTest:!1}),e.materials.semanticShape=new THREE.ShaderMaterial({uniforms:e._uSem,vertexShader:e.getDefVertexShader(),fragmentShader:"\n            varying vec3 vPositionW;\n\t\t    varying vec3 vNormalW;\n            varying vec3 vNormalV;\n\n            uniform float time;\n            uniform vec4 tint;\n\n\t\t    void main(){\n\t\t        //vec3 viewDirectionW = normalize(cameraPosition - vPositionW);\n\n                //float ff = dot(vNormalV, vec3(0,0,1));\n\t\t        //ff = clamp(1.0-ff, 0.0, 1.0);\n\n                float f = (1.0 * cos(time*2.0)); // - 0.5;\n                //f = cos(time + (vPositionW.y*10.0));\n                f = clamp(f, 0.0,1.0);\n\n\t\t        gl_FragColor = vec4(tint.rgb, tint.a * f);\n                //gl_FragColor = vec4(tint.rgb, ff);\n\t\t    }\n        ",transparent:!0,depthWrite:!1}),e.materials.semanticShapeHL=new THREE.MeshBasicMaterial({color:e.colors.sem,transparent:!0,depthWrite:!1,opacity:.2}),e.materials.semanticShapeEdit=new THREE.MeshBasicMaterial({color:e.colors.orange,transparent:!0,depthWrite:!1,opacity:.5}),e.semIcon=new THREE.SpriteMaterial({map:(new THREE.TextureLoader).load(ATON.PATH_RES+"sui-sem.png"),transparent:!0,opacity:1,depthTest:!1}),e.materials.lp=new THREE.ShaderMaterial({vertexShader:e.getDefVertexShader(),fragmentShader:"\n            varying vec3 vPositionW;\n\t\t    varying vec3 vNormalW;\n            varying vec3 vNormalV;\n\n\t\t    void main(){\n\t\t        vec3 viewDirectionW = normalize(cameraPosition - vPositionW);\n\n                float f;\n\t\t        //f = dot(viewDirectionW, vNormalW);\n                f = dot(vNormalV, vec3(0,0,1));\n\t\t        f = clamp(1.0 - f, 0.0, 1.0);\n\n\t\t        gl_FragColor = vec4(1.0,1.0,1.0, f);\n\t\t    }\n        ",transparent:!0,depthWrite:!1}),e.lpIcon=new THREE.SpriteMaterial({map:(new THREE.TextureLoader).load(ATON.PATH_RES+"sui-lp.png"),transparent:!0,opacity:1,depthWrite:!1}),e.semIcon.sizeAttenuation=!1,e.lpIcon.sizeAttenuation=!1},addMaterial:(t,a)=>{e.materials[t]?console.log("MatHub: material "+t+" already registered"):e.materials[t]=a},loadMaterial:(t,a)=>{e._loader.load(a,a=>{e.addMaterial(t,a)},void 0,e=>{console.log(e)})},getMaterial:t=>e.materials[t],update:()=>{e._uSem.time.value+=ATON._dt}};var t=e;exports.default=t;
},{}],"P9TA":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;let e={TSTRING_SEPARATOR:" ",init:()=>{ATON.device={},e.geomUnitSphere=new THREE.SphereGeometry(1,16,16),e.exporterGLTF=void 0,e.exporterOBJ=void 0,e._dlink=document.createElement("a"),e._dlink.style.display="none",document.body.appendChild(e._dlink),e.textureLoader=new THREE.TextureLoader},generateID:e=>(void 0===e&&(e="id"),e+"-"+Math.random().toString(36).substr(2,9)),goToURL:e=>{window.location.href=e},isConnectionSecure:()=>window.isSecureContext,profileDevice:()=>{ATON.device.isMobile=!1;ATON.device.isMobile=(()=>!(!/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(navigator.userAgent)&&!/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(navigator.userAgent.substr(0,4))))(),ATON.device.xrSupported={},ATON.device.xrSupported["immersive-vr"]=!1,ATON.device.xrSupported["immersive-ar"]=!1,"xr"in navigator&&(navigator.xr.isSessionSupported("immersive-vr").then(e=>{ATON.device.xrSupported["immersive-vr"]=!!e,console.log("WebXR VR session support: "+ATON.device.xrSupported["immersive-vr"]),ATON.fireEvent("XR_support",{type:"immersive-vr",v:ATON.device.xrSupported["immersive-vr"]})}),navigator.xr.isSessionSupported("immersive-ar").then(e=>{ATON.device.xrSupported["immersive-ar"]=!!e,console.log("WebXR AR session support: "+ATON.device.xrSupported["immersive-ar"]),ATON.fireEvent("XR_support",{type:"immersive-ar",v:ATON.device.xrSupported["immersive-ar"]})}))},profileRenderingCapabilities:()=>{if(void 0===ATON._renderer)return;let e=ATON._renderer.capabilities;void 0!==e&&(ATON.device.lowGPU=!1,e.isWebGL2||(ATON.device.lowGPU=!0),e.maxTextureSize<8192&&(ATON.device.lowGPU=!0),console.log(e))},isMobile:()=>ATON.device.isMobile,isVRsupported:()=>ATON.device.xrSupported["immersive-vr"],isARsupported:()=>ATON.device.xrSupported["immersive-ar"],getFileExtension:e=>e.substr(e.lastIndexOf(".")+1).toLowerCase(),removeFileExtension:e=>e.replace(/\.[^/.]+$/,""),isVideo:r=>{let t=e.getFileExtension(r);return"mp4"===t||("webm"===t||void 0)},getBaseFolder:e=>{var r=e.lastIndexOf("/");return-1!==r?e.substring(0,r+1):""},isResourceURL:e=>!!e.startsWith("http://")||!!e.startsWith("https://"),URLify:e=>{const r=e.match(/(((ftp|https?):\/\/)[\-\w@:%_\+.~#?,&\/\/=]+)/g);return r&&r.forEach(function(r){e=e.replace(r,'<a target="_blank" href="'+r+'">'+r+"</a>")}),e},resolveCollectionURL:e=>e.startsWith("http")?e:ATON.PATH_COLLECTION+e,postJSON:(e,r,t,a)=>{$.ajax({url:e,type:"POST",xhrFields:{withCredentials:!0},data:JSON.stringify(r),contentType:"application/json; charset=utf-8",dataType:"json",success:e=>{t&&t(e)}}).fail(e=>{console.log(e),a&&a()})},mergeObject:e=>{e.updateMatrixWorld(!0);const r=[];e.traverse(e=>{if(e.isMesh){const t=e.geometry;t.applyMatrix4(e.matrixWorld),r.push(t.toNonIndexed())}});const t=THREE.BufferGeometryUtils.mergeBufferGeometries(r,!1),a=THREE.BufferGeometryUtils.mergeVertices(t).center(),o=new THREE.Group,i=new THREE.Mesh(a);return o.add(i),o},setPicking:(e,r,t)=>{void 0===t&&(t=!0),e.traverse(e=>{t?e.layers.enable(r):e.layers.disable(r)})},graphPostVisitor:r=>{r.visible?console.log(r):e.setPicking(r,r.type,!1)},updateTSetsCamera:e=>{void 0===e&&(e=ATON.Nav._camera);const r=ATON._tsets.length;if(!(r<=0))for(let t=0;t<r;t++){const r=ATON._tsets[t];for(let e in r.cameras)r.deleteCamera(r.cameras[e]);r.setCamera(e),r.setResolution(e,200,200)}},loadTileSet:(r,t)=>{let a=new TILES.TilesRenderer(r);if(!a)return;a.fetchOptions.mode="cors",a.setCamera(ATON.Nav._camera),a.setResolutionFromRenderer(ATON.Nav._camera,ATON._renderer);let o=!1;a.onLoadModel=(e=>{o||(ATON._onAllReqsCompleted(),o=!0),e.traverse(e=>{e.isMesh&&(e.castShadow=!0,e.receiveShadow=!0),e.material&&(t.userData.cMat&&(e.material=t.userData.cMat),e.material.map&&(e.material.map.minFilter=THREE.LinearMipmapLinearFilter,e.material.map.magFilter=THREE.LinearFilter))})}),a.onDisposeModel=(e=>{e.traverse(e=>{e.isMesh&&e.material.dispose()})}),t.add(a.group),e.setPicking(t,t.type,!0),ATON._tsets.push(a)},modelVisitor:(e,r)=>{if(void 0===r)return;if(void 0===e)return;let t=e.type;r.traverse(r=>{r.isMesh&&(t===ATON.NTYPES.SCENE&&(r.castShadow=!0,r.receiveShadow=!0,r.geometry&&(r.geometry.computeBoundsTree(),console.log("Computed visible BVH")),null!==r.material.map&&(r.material.map.generateMipmaps=!0,r.material.map.anisotropy=ATON.device.isMobile?0:ATON._maxAnisotropy,r.material.map.minFilter=THREE.LinearMipmapLinearFilter,r.material.map.magFilter=THREE.LinearFilter)),t===ATON.NTYPES.SEM&&(r.material=ATON.MatHub.materials.semanticShape,r.geometry&&(r.geometry.computeBoundsTree(),console.log("Computed semantic BVH"))),e.userData.cMat&&(r.material=e.userData.cMat))})},registerAniMixers:(e,r)=>{let t=r.scene||r.scene[0],a=!1;if(void 0===r.animations)return;let o=new THREE.AnimationMixer(t);r.animations.forEach(e=>{o.clipAction(e).play(),a=!0}),a&&(ATON._aniMixers.push(o),void 0===e._aniMixers&&(e._aniMixers=[]),e._aniMixers.push(o))},ccExtract:e=>{if(void 0===e)return;if(void 0===e.asset)return;let r={};if(e.asset.copyright&&(r.copyright=e.asset.copyright),e.asset.extras)for(let t in e.asset.extras)r[t]=e.asset.extras[t];e.asset.generator&&(r.generator=e.asset.generator),(e.asset.copyright||e.asset.extras)&&ATON._ccModels.push(r),console.log(r)},parseTransformString:r=>{let t=new THREE.Group,a=r.split(e.TSTRING_SEPARATOR),o=a.length;return o<3?t:(t.position.set(parseFloat(a[0]),parseFloat(a[1]),parseFloat(a[2])),o<6?t:(t.rotation.set(parseFloat(a[3]),parseFloat(a[4]),parseFloat(a[5])),o<9?t:(t.scale.set(parseFloat(a[6]),parseFloat(a[7]),parseFloat(a[8])),t)))},setVectorPrecision:(e,r)=>(e.x=parseFloat(e.x.toPrecision(r)),e.y=parseFloat(e.y.toPrecision(r)),e.z=parseFloat(e.z.toPrecision(r)),e),parseMD:e=>e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=e.replace(/^\s*\n\*/gm,"<ul>\n*")).replace(/^(\*.+)\s*\n([^\*])/gm,"$1\n</ul>\n\n$2")).replace(/^\*(.+)/gm,"<li>$1</li>")).replace(/^\s*\n\d\./gm,"<ol>\n1.")).replace(/^(\d\..+)\s*\n([^\d\.])/gm,"$1\n</ol>\n\n$2")).replace(/^\d\.(.+)/gm,"<li>$1</li>")).replace(/^\>(.+)/gm,"<blockquote>$1</blockquote>")).replace(/[\#]{6}(.+)/g,"<h6>$1</h6>")).replace(/[\#]{5}(.+)/g,"<h5>$1</h5>")).replace(/[\#]{4}(.+)/g,"<h4>$1</h4>")).replace(/[\#]{3}(.+)/g,"<h3>$1</h3>")).replace(/[\#]{2}(.+)/g,"<h2>$1</h2>")).replace(/[\#]{1}(.+)/g,"<h1>$1</h1>")).replace(/^(.+)\n\=+/gm,"<h1>$1</h1>")).replace(/^(.+)\n\-+/gm,"<h2>$1</h2>")).replace(/\!\[([^\]]+)\]\(([^\)]+)\)/g,'<img src="$2" alt="$1" />')).replace(/[\[]{1}([^\]]+)[\]]{1}[\(]{1}([^\)\"]+)(\"(.+)\")?[\)]{1}/g,'<a href="$2" title="$4">$1</a>')).replace(/[\*\_]{2}([^\*\_]+)[\*\_]{2}/g,"<b>$1</b>")).replace(/[\*\_]{1}([^\*\_]+)[\*\_]{1}/g,"<i>$1</i>")).replace(/[\~]{2}([^\~]+)[\~]{2}/g,"<del>$1</del>")).replace(/^\s*\n\`\`\`(([^\s]+))?/gm,'<pre class="$2">')).replace(/^\`\`\`\s*\n/gm,"</pre>\n\n")).replace(/[\`]{1}([^\`]+)[\`]{1}/g,"<code>$1</code>")).replace(/^\s*(\n)?(.+)/gm,function(e){return/\<(\/)?(h\d|ul|ol|li|blockquote|pre|img)/.test(e)?e:"<p>"+e+"</p>"})).replace(/(\<pre.+\>)\s*\n\<p\>(.+)\<\/p\>/gm,"$1$2"),checkAuth:e=>{$.ajax({type:"GET",url:ATON.PATH_RESTAPI+"user",xhrFields:{withCredentials:!0},dataType:"json",success:r=>{e(r)}})},getHumanReadableDistance:e=>{let r=" m";return e<.01?(r=" mm",r=(e*=1e3).toPrecision(3)+r):e<1?(r=" cm",r=(e*=100).toPrecision(3)+r):e>1e3?(r=" km",r=e.toPrecision(3)+r):r=e.toPrecision(3)+r},stripHTMLtagsFromString:e=>e=e.replace(/(<([^>]+)>)/gi,""),requestFullscreen:()=>{let e=document.documentElement;return e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen(),!0},downloadBlob:(r,t)=>{void 0!==t&&(e._dlink.href=URL.createObjectURL(r),e._dlink.download=t,e._dlink.click())},downloadText:(r,t)=>{e.downloadBlob(new Blob([r],{type:"text/plain"}),t)},downloadJSONobj:(r,t)=>{e.downloadText(JSON.stringify(r),t)},downloadArrayBuffer:(r,t)=>{e.downloadBlob(new Blob([r],{type:"application/octet-stream"}),t)},exportNode:(r,t)=>{let a=e.getFileExtension(t);if(!(a.length<1)){if("glb"===a||"gltf"===a){let o={binary:"glb"===a};void 0===e.exporterGLTF&&(e.exporterGLTF=new THREE.GLTFExporter),e.exporterGLTF.parse(r,r=>{r instanceof ArrayBuffer?e.downloadArrayBuffer(r,t):(console.log(r),e.downloadJSONobj(r,t))},o)}if("obj"===a){void 0===e.exporterOBJ&&(e.exporterOBJ=new THREE.OBJExporter);let a=e.exporterOBJ.parse(r);e.downloadText(a,t)}}},takeScreenshot:(r,t)=>{let a=new Image;console.log("Screenshot with size:"+r),ATON.Nav._camera.aspect=1,ATON.Nav._camera.updateProjectionMatrix(),ATON._renderer.setSize(r,r),ATON._renderer.render(ATON._mainRoot,ATON.Nav._camera);let o=ATON._renderer.domElement;if(ATON.FX.composer){ATON.FX.composer.setSize(r,r);let e=ATON.FX.passes[ATON.FX.PASS_AA].material.uniforms;e&&e.resolution.value.set(1/r,1/r),ATON.FX.composer.render(),o=ATON.FX.composer.renderer.domElement}let i=ATON._renderer.domElement.toDataURL();return a.src=i,t&&(e._dlink.href=i.replace("image/png","image/octet-stream"),e._dlink.download=t,e._dlink.click()),ATON._onResize(),a},assignLightProbeToMesh:(e,r)=>{void 0!==e&&void 0!==r&&(r.noLP||(r.userData.LP=e))},createATONCube:r=>{let t=new THREE.BoxBufferGeometry(1,1,1),a=new THREE.MeshStandardMaterial;e.textureLoader.load(ATON.PATH_RES+"models/aton-cube.jpg",e=>{e.encoding=THREE.sRGBEncoding,a.map=e});let o=ATON.createSceneNode(r);return o.add(new THREE.Mesh(t)),o.setMaterial(a),o.enablePicking(),o},createATONCubePBR:r=>{let t=new THREE.BoxBufferGeometry(1,1,1),a=new THREE.MeshStandardMaterial;a.metalness=1,e.textureLoader.load(ATON.PATH_RES+"models/aton-cube.jpg",e=>{e.encoding=THREE.sRGBEncoding,a.map=e}),e.textureLoader.load(ATON.PATH_RES+"models/aton-cube-pbr.jpg",e=>{e.encoding=THREE.sRGBEncoding,a.metalnessMap=e,a.roughnessMap=e}),e.textureLoader.load(ATON.PATH_RES+"models/aton-cube-nrm.png",e=>{e.encoding=THREE.sRGBEncoding,a.normalMap=e});let o=ATON.createSceneNode(r);return o.add(new THREE.Mesh(t)),o.setMaterial(a),o.enablePicking(),o},createGround:(r,t,a)=>{void 0===t&&(t=1),void 0===a&&(a=1);let o=new THREE.PlaneBufferGeometry(t,a),i=new THREE.MeshStandardMaterial;void 0!==r&&e.textureLoader.load(r,e=>{e.encoding=THREE.sRGBEncoding,i.map=e});let s=ATON.createSceneNode().rotateX(.5*-Math.PI);return s.add(new THREE.Mesh(o,i)),s.enablePicking(),s}};var r=e;exports.default=r;
},{}],"qC8Z":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;let e={MODE_ADD:0,MODE_DEL:1,FLOAT_PREC:5,init:()=>{e.currID=void 0,e.currData=void 0,e._bEdit=!1,e._bLoading=!1,e._title=void 0,e._descr=void 0,e.initBaseParsers()},setEditMode:o=>{e._bEdit=o,console.log("Edit mode:"+o)},load:(o,t,i)=>(e._bLoading=!0,console.log("Loading Scene: "+t),$.getJSON(o,o=>{e.currData=o,e.currID=t,e._bLoading=!1,e.parseScene(o),i&&i(),ATON.fireEvent("SceneJSONLoaded",t)})),parseScene:o=>{if(void 0!==(o=void 0===o?e.currData:o))for(let t in o)e._jsonParsers[t]&&e._jsonParsers[t](o[t])},getJSONchildren:(e,o)=>{void 0===o&&(o=ATON.NTYPES.SCENE);let t=void 0,i=[];if(o===ATON.NTYPES.SEM&&(t=ATON.getSemanticNode(e)),o===ATON.NTYPES.SCENE&&(t=ATON.getSceneNode(e)),void 0!==t){for(let e in t.children){let o=t.children[e];void 0!==o.nid&&i.push(o.nid)}return i}},getJSONgraphEdges:e=>{void 0===e&&(e=ATON.NTYPES.SCENE);let o=ATON.snodes;e===ATON.NTYPES.SEM&&(o=ATON.semnodes),e===ATON.NTYPES.UI&&(o=ATON.uinodes);let t={};for(let i in o){let e=o[i];e&&e.parent&&e.parent.nid&&(void 0===t[e.parent.nid]&&(t[e.parent.nid]=[]),t[e.parent.nid].push(e.nid))}return t},getJSONsemanticSpheresList:o=>{let t=ATON.getSemanticNode(o);if(void 0===t)return;let i=[];for(let s in t.children){let o=t.children[s];o.type&&i.push([parseFloat(o.position.x.toPrecision(e.FLOAT_PREC)),parseFloat(o.position.y.toPrecision(e.FLOAT_PREC)),parseFloat(o.position.z.toPrecision(e.FLOAT_PREC)),parseFloat(o.scale.x.toPrecision(e.FLOAT_PREC))])}return i},getJSONsemanticConvexShapes:e=>{let o=ATON.getSemanticNode(e);if(void 0===o)return;let t=[];for(let i in o.children){let e=o.children[i];e.userData._convexPoints&&t.push(e.userData._convexPoints)}return t},initBaseParsers:()=>{e._jsonParsers={},e._jsonParsers.title=(o=>{void 0!==o&&e.setTitle(o)}),e._jsonParsers.description=(o=>{void 0!==o&&e.setDescription(o)}),e._jsonParsers.fx=(e=>{e.ao&&(ATON.FX.togglePass(ATON.FX.PASS_AO,!0),e.ao.i&&ATON.FX.setAOintensity(parseFloat(e.ao.i))),e.bloom&&(ATON.FX.togglePass(ATON.FX.PASS_BLOOM,!0),e.bloom.i&&ATON.FX.setBloomStrength(parseFloat(e.bloom.i)),e.bloom.t&&ATON.FX.setBloomThreshold(parseFloat(e.bloom.t))),e.dof&&(ATON.FX.togglePass(ATON.FX.PASS_DOF,!0),e.dof.f&&ATON.FX.setDOFfocus(parseFloat(e.dof.f)))}),e._jsonParsers.environment=(e=>{let o=e.mainpano;e.mainpano&&(o.url&&ATON.setMainPanorama(o.url),o.rotation&&ATON.setMainPanoramaRotation(o.rotation)),e.bgcolor&&ATON.setBackgroundColor(new THREE.Color(e.bgcolor[0],e.bgcolor[1],e.bgcolor[2]));let t=e.mainlight;t?(t.direction&&ATON.setMainLightDirection(new THREE.Vector3(t.direction[0],t.direction[1],t.direction[2])),ATON._dMainL?(t.color&&(ATON._dMainL.color=new THREE.Color(t.color[0],t.color[1],t.color[2])),t.intensity&&(ATON._dMainL.intensity=t.intensity),void 0!==t.shadows?ATON.toggleShadows(t.shadows):ATON.toggleShadows(!1)):ATON.toggleMainLight(!1)):ATON.toggleMainLight(!1);let i=e.lightprobes;i&&i.auto&&ATON.setAutoLP(!0),e.exposure&&ATON.setExposure(e.exposure)}),e._jsonParsers.soundscape=(e=>{void 0!==e&&e.global&&ATON.setGlobalAudio(e.global.url,e.global.loop)}),e._jsonParsers.navmode=(e=>{void 0!==e&&ATON.Nav.setNavMode(e)}),e._jsonParsers.measurements=(e=>{if(void 0!==e)for(let o in e){let t=e[o];if(t.points&&6===t.points.length){let e=new THREE.Vector3(parseFloat(t.points[0]),parseFloat(t.points[1]),parseFloat(t.points[2])),o=new THREE.Vector3(parseFloat(t.points[3]),parseFloat(t.points[4]),parseFloat(t.points[5]));ATON.SUI.addMeasurementPoint(e),ATON.SUI.addMeasurementPoint(o)}}}),e._jsonParsers.viewpoints=(e=>{if(void 0!==e)for(let o in e){let t=e[o];"home"===o?ATON.Nav.setHomePOV((new ATON.POV).setPosition(t.position[0],t.position[1],t.position[2]).setTarget(t.target[0],t.target[1],t.target[2]).setFOV(t.fov)):new ATON.POV(o).setPosition(t.position[0],t.position[1],t.position[2]).setTarget(t.target[0],t.target[1],t.target[2]).setFOV(t.fov)}}),e._jsonParsers.scenegraph=(e=>{if(void 0===e)return;let o=e.nodes,t=e.edges;for(let i in o){let e=o[i],t=ATON.getOrCreateSceneNode(i).removeChildren(),s=e.transform;s&&(s.position&&t.setPosition(s.position[0],s.position[1],s.position[2]),s.rotation&&t.setRotation(s.rotation[0],s.rotation[1],s.rotation[2]),s.scale&&t.setScale(s.scale[0],s.scale[1],s.scale[2]),s.list&&Array.isArray(s.list));let r=e.urls;r&&(Array.isArray(r)?r.forEach(e=>{ATON.createSceneNode().load(e).attachTo(t)}):t.load(r)),e.shadowcast&&t.setShadowCast(e.shadowcast),e.shadowreceive&&t.setShadowCast(e.shadowreceive),e.toYup&&t.setYup(),e.keywords&&(t.kwords=e.keywords)}for(let i in t){let e=t[i],o=ATON.getSceneNode(i);if(void 0!==o)for(let t in e){let i=e[t],s=ATON.getSceneNode(i);void 0!==s&&s.attachTo(o)}}for(let i in o){let e=o[i],t=ATON.getSceneNode(i);if(void 0!==t&&(void 0!==e.show&&(e.show?(t.show(),console.log("show "+i)):(t.hide(),console.log("hide "+i))),e.material)){let o=new THREE.MeshStandardMaterial(e.material);t.setMaterial(o)}}}),e._jsonParsers.semanticgraph=(e=>{if(void 0===e)return;let o=e.nodes,t=e.edges;for(let i in o){let e=o[i],t=ATON.getOrCreateSemanticNode(i).removeChildren(),s=e.urls;s&&(Array.isArray(s)?s.forEach(e=>{ATON.createSemanticNode().load(e).attachTo(t)}):t.load(s)),e.toYup&&t.setYup(),e.description&&t.setDescription(e.description),e.audio&&t.setAudio(e.audio),e.keywords&&(t.kwords=e.keywords);let r=e.spheres;if(Array.isArray(r))for(let o in r){let e=r[o],t=new THREE.Vector3(parseFloat(e[0]),parseFloat(e[1]),parseFloat(e[2]));ATON.SemFactory.createSphere(i,t,parseFloat(e[3]))}let a=e.convexshapes;if(Array.isArray(a))for(let o in a){let e=a[o],t=[];for(let o=0;o<e.length;o+=3){let i=new THREE.Vector3(e[o],e[o+1],e[o+2]);t.push(i)}ATON.SemFactory.createConvexShape(i,t)}}for(let i in t){let e=t[i],o=ATON.getSemanticNode(i);if(void 0!==o)for(let t in e){let i=e[t],s=ATON.getSemanticNode(i);void 0!==s&&s.attachTo(o)}}for(let i in o){let e=o[i],t=ATON.getSemanticNode(i);if(void 0!==t&&(void 0!==e.show&&(e.show?(t.show(),console.log("show "+i)):(t.hide(),console.log("hide "+i))),e.nopicking&&t.disablePicking(),e.material)){let o=new THREE.MeshStandardMaterial(e.material);t.setMaterial(o)}}})},addSceneParser:(o,t)=>{e._jsonParsers[o]=t},sendEdit:(o,t,i)=>{if(e._bLoading||!e._bEdit)return;if(void 0===o)return;void 0===t&&(t=e.MODE_ADD);let s=e.currID,r={};r.sid=s,r.data=o,r.mode=t===e.MODE_DEL?"DEL":"ADD";let a=JSON.stringify(r);o=null,r=null,$.ajax({url:ATON.PATH_RESTAPI+"edit/scene",type:"POST",data:a,contentType:"application/json; charset=utf-8",dataType:"json",success:o=>{o&&(e.currData=o),i&&i()}})},setTitle:o=>{e._title=o},getTitle:()=>e._title,setDescription:o=>{e._descr=o},getDescription:()=>e._descr};var o=e;exports.default=o;
},{}],"mYhb":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;let e={init:()=>{e._listener=new THREE.AudioListener,e._loader=new THREE.AudioLoader},playOnceGlobally:l=>{l=ATON.Utils.resolveCollectionURL(l);let o=new THREE.Audio(ATON.AudioHub._listener);e._loader.load(l,e=>{o.setBuffer(e),o.play()})}};var l=e;exports.default=l;
},{}],"nomA":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;const e=function(e){return(1-Math.cos(e*Math.PI))/2};let t={STD_FOV:50,STD_NEAR:.01,STD_FAR:800,FP_EPS:.01,STD_POV_TRANS_DURATION:2,MODE_ORBIT:0,MODE_FP:1,MODE_DEVORI:2,init:()=>{t._mode=void 0,t.POVtransitionDuration=t.STD_POV_TRANS_DURATION,t._rotSpeedOrbit=.4,t._rotSpeedFP=-.2,t._inertia=.08,t._bControl=!0,t._bInteracting=!1,t._prevMode=void 0,t.setOrbitControl(),t._currPOV=(new ATON.POV).setFOV(ATON.Nav.STD_FOV),t._fromPOV=new ATON.POV,t._reqPOV=new ATON.POV,t.homePOV=void 0,t._tPOVcall=-1,t._tPOVprogress=0,t.povlist={},t._vDir=new THREE.Vector3(1,0,0),t._qOri=new THREE.Quaternion,t._motionAmt=0,t._motionDir=new THREE.Vector3(0,1,0),t._bValidLocomotion=!1},getCurrentEyeLocation:()=>t._currPOV.pos,getCurrentDirection:()=>t._vDir,copyCurrentPOV:()=>{let e=new ATON.POV;return e.pos.copy(t._currPOV.pos),e.target.copy(t._currPOV.target),e.fov=t._currPOV.fov,e},addPOV:(e,t)=>{if(void 0!==e)return e.as(t),e},isTransitioning:()=>t._tPOVcall>=0,currentQueryValidForLocomotion:()=>t._bValidLocomotion,locomotionValidator:()=>{if(void 0===ATON._queryDataScene)return void(t._bValidLocomotion=!1);ATON._queryDataScene.p;let e=ATON._queryDataScene.n;e?e.y<=.7?t._bValidLocomotion=!1:t._bValidLocomotion=!0:t._bValidLocomotion=!1},setUserControl:e=>{void 0!==e&&e!==t._bControl&&(t._bControl=e,void 0!==t._controls&&(t._controls.enabled=e),t._cOrbit&&(t._cOrbit.enabled=e),t._cFirstPerson&&(t._cFirstPerson.enabled=e),console.log("Nav controls: "+t._bControl))},toggleUserControl:()=>{t.setUserControl(!t._bControl)},isUserControlEnabled:()=>t._bControl,isOrbit:()=>t._mode===t.MODE_ORBIT,isFirstPerson:()=>t._mode===t.MODE_FP,isDevOri:()=>t._mode===t.MODE_DEVORI,setNavMode:e=>{void 0!==e&&(e===t.MODE_ORBIT&&t.setOrbitControl(),e===t.MODE_FP&&t.setFirstPersonControl(),e===t.MODE_DEVORI&&t.setDeviceOrientationControl())},restorePreviousNavMode:()=>{void 0===t._prevMode&&t.setOrbitControl(),t.setNavMode(t._prevMode)},_updCamera:e=>{if(void 0===e&&(e=t._camera),ATON.FX.composer){let t=ATON.FX.composer.passes;if(t)for(let r=0;r<t.length;r++)t[r].camera&&(t[r].camera=e)}ATON.Utils.updateTSetsCamera(e)},setOrbitControl:()=>{if(!ATON.XR.isPresenting()){if(t._prevMode=t._mode,t._mode=t.MODE_ORBIT,t._bInteracting=!1,void 0===t._cOrbit){t._camOrbit=new THREE.PerspectiveCamera(t.STD_FOV,window.innerWidth/window.innerHeight,t.STD_NEAR,t.STD_FAR),t._camOrbit.layers.enableAll(),t._cOrbit=new THREE.OrbitControls(t._camOrbit,ATON._renderer.domElement);let e=t._cOrbit;e.rotateSpeed=t._rotSpeedOrbit,e.enablePan=!0,t._inertia>0&&(e.enableDamping=!0,e.dampingFactor=t._inertia),e.screenSpacePanning=!0,e.enableZoom=!0,e.minDistance=.03,e.maxDistance=100,t._bControl||(e.enabled=!1),e.addEventListener("start",()=>{t._bInteracting=!0}),e.addEventListener("end",()=>{t._bInteracting=!1})}t._controls=t._cOrbit,t._camera=t._camOrbit,ATON.AudioHub._listener&&t._camera.children.length<1&&t._camera.add(ATON.AudioHub._listener),t._updCamera(),t._controls.update(),t._currPOV&&t.syncCurrCamera(),ATON._onResize(),ATON.toggleCenteredQuery(!1),ATON.fireEvent("NavMode",t._mode)}},setFirstPersonControl:()=>{if(!ATON.XR.isPresenting()){if(t._prevMode=t._mode,ATON.SUI.getSelectorRadius()>.5&&ATON.SUI.setSelectorRadius(.5),t._mode=t.MODE_FP,t._bInteracting=!1,void 0===t._cFirstPerson){t._camFP=new THREE.PerspectiveCamera(t.STD_FOV,window.innerWidth/window.innerHeight,t.STD_NEAR,t.STD_FAR),t._camFP.layers.enableAll(),t._cFirstPerson=new THREE.OrbitControls(t._camFP,ATON._renderer.domElement);let e=t._cFirstPerson;e.enableZoom=!1,e.enablePan=!1,e.rotateSpeed=t._rotSpeedFP,t._inertia>0&&(e.enableDamping=!0,e.dampingFactor=t._inertia),e.target.copy(t._camera.position),e.minDistance=.01,e.maxDistance=.01,t._bControl||(e.enabled=!1)}t._controls=t._cFirstPerson,t._camera=t._camFP,ATON.AudioHub._listener&&t._camera.children.length<1&&t._camera.add(ATON.AudioHub._listener),t._updCamera(),t._controls.update(),t._currPOV&&t.syncCurrCamera(),ATON._onResize(),ATON.toggleCenteredQuery(!1),ATON.fireEvent("NavMode",t._mode)}},setDeviceOrientationControl:()=>{ATON.Utils.isMobile()&&(t._prevMode=t._mode,t._mode=t.MODE_DEVORI,t._bInteracting=!1,ATON._screenPointerCoords.set(0,0),void 0===t._cDevOri&&(t._camDevOri=new THREE.PerspectiveCamera(t.STD_FOV,window.innerWidth/window.innerHeight,t.STD_NEAR,t.STD_FAR),t._camDevOri.layers.enableAll(),t._cDevOri=new THREE.DeviceOrientationControls(t._camDevOri,ATON._renderer.domElement),t._cDevOri.alphaOffset=0),t._controls=t._cDevOri,t._camera=t._camDevOri,ATON.AudioHub._listener&&t._camera.children.length<1&&t._camera.add(ATON.AudioHub._listener),t._updCamera(),t._controls.update(),t._currPOV&&t.syncCurrCamera(),ATON._onResize(),ATON.toggleCenteredQuery(!0),ATON.fireEvent("NavMode",t._mode))},setMotionAmount:e=>{t._motionAmt=e},setMotionDirection:e=>{t._motionDir.copy(e)},stop:()=>{t._motionAmt=0},setFOV:e=>{if(ATON.XR.isPresenting())return;t._currPOV.fov=e;let r=t._camera;r.fov=e,r.updateProjectionMatrix()},getFOV:()=>t._currPOV.fov,syncCurrPOV:()=>{if(ATON.XR.isPresenting())return ATON.XR._cam=ATON._renderer.xr.getCamera(t._camera),ATON.XR._cam.getWorldPosition(t._currPOV.pos),ATON.XR._cam.getWorldQuaternion(t._qOri),void ATON.XR._cam.getWorldDirection(t._vDir);const e=t._controls,r=t._camera;if(r.getWorldDirection(t._vDir),r.getWorldQuaternion(t._qOri),t._mode!==t.MODE_DEVORI){if(t._mode===t.MODE_FP)return t._currPOV.pos.copy(e.target),t._currPOV.target.x=t._currPOV.pos.x+t._vDir.x,t._currPOV.target.y=t._currPOV.pos.y+t._vDir.y,void(t._currPOV.target.z=t._currPOV.pos.z+t._vDir.z);t._currPOV.pos.copy(r.position),t._currPOV.target.copy(e.target)}else t._currPOV.pos.copy(r.position)},handlePOV:()=>{ATON.XR.isPresenting()?t.handleXRtransition():t.handlePOVtransition()},handleMotion:()=>{if(!t.isTransitioning()&&0!=t._motionAmt){ATON.XR.controller0&&ATON.XR.controller0.visible?(ATON.XR.controller0.getWorldDirection(t._motionDir),t._motionDir.negate()):t._motionDir.copy(t._vDir);let e=t._motionDir.clone();e.multiplyScalar(t._motionAmt*ATON._dt),t._currPOV.pos.add(e),t._currPOV.target.add(e)}},handlePOVtransition:()=>{if(!(t._tPOVcall<0)){if(t.POVtransitionDuration<=0?t._tPOVprogress=1:t._tPOVprogress=(ATON._clock.elapsedTime-t._tPOVcall)/t.POVtransitionDuration,t._tPOVprogress>=1)return t._tPOVcall=-1,t._currPOV.pos.copy(t._reqPOV.pos),t._currPOV.target.copy(t._reqPOV.target),t._currPOV.fov=t._reqPOV.fov,void ATON.fireEvent("POVTransitionCompleted",t._reqPOV.id);t._tPOVprogress=e(t._tPOVprogress),t._currPOV.pos.lerpVectors(t._fromPOV.pos,t._reqPOV.pos,t._tPOVprogress),t._currPOV.target.lerpVectors(t._fromPOV.target,t._reqPOV.target,t._tPOVprogress),t._fromPOV.fov&&t._reqPOV.fov&&(t._currPOV.fov=THREE.MathUtils.lerp(t._fromPOV.fov,t._reqPOV.fov,t._tPOVprogress),t._camera.fov=t._currPOV.fov,t._camera.updateProjectionMatrix())}},handleXRtransition:()=>{if(!(t._tPOVcall<0)){if(t.POVtransitionDuration<=0?t._tPOVprogress=1:t._tPOVprogress=(ATON._clock.elapsedTime-t._tPOVcall)/t.POVtransitionDuration,t._tPOVprogress>=1)return t._tPOVcall=-1,ATON.XR._currPos.copy(ATON.XR._reqPos),console.log("XR height"+ATON.XR._currPos.y),console.log("HMD height"+t._currPOV.pos.y),void ATON.fireEvent("POVTransitionCompleted",t._reqPOV.id);ATON.XR._currPos.lerpVectors(ATON.XR._fromPos,ATON.XR._reqPos,t._tPOVprogress)}},syncCurrCamera:()=>{if(ATON.XR.isPresenting())return;let e=t._controls,r=t._camera,o=t._currPOV.pos,i=t._currPOV.target;t._mode!==t.MODE_DEVORI?(t._vDir.subVectors(i,o),t._vDir.normalize(),t._mode===t.MODE_FP?(e.target.copy(o),r.position.x=e.target.x-t._vDir.x*t.FP_EPS,r.position.y=e.target.y-t._vDir.y*t.FP_EPS,r.position.z=e.target.z-t._vDir.z*t.FP_EPS):(r.position.copy(o),e.target.copy(i))):r.position.copy(o)},update:()=>{t.syncCurrPOV(),t.handlePOV(),t.syncCurrCamera()},requestPOV:(e,r)=>{ATON._tPOVcall>=0||void 0!==e&&(ATON.fireEvent("POVTransitionRequested",e.id),void 0!==r&&(t.POVtransitionDuration=r),t._tPOVcall=ATON._clock.elapsedTime,ATON.XR.isPresenting()?(t._reqPOV.pos.copy(e.pos?e.pos:t._currPOV.pos),t._fromPOV.pos.copy(t._currPOV.pos),ATON.XR._reqPos.copy(e.pos?e.pos:t._currPOV.pos),ATON.XR._fromPos.copy(ATON.XR._currPos)):(t._reqPOV.pos.copy(e.pos?e.pos:t._currPOV.pos),t._reqPOV.target.copy(e.target?e.target:t._currPOV.target),t._reqPOV.fov=e.fov?e.fov:t._currPOV.fov,t._fromPOV.pos.copy(t._currPOV.pos),t._fromPOV.target.copy(t._currPOV.target),t._fromPOV.fov=t._currPOV.fov))},requestPOVbyBound:(e,r)=>{if(void 0===e)return;let o=new THREE.Vector3,i=3*e.radius;o.x=e.center.x-i*t._vDir.x,o.y=e.center.y-i*t._vDir.y,o.z=e.center.z-i*t._vDir.z;let n=(new ATON.POV).setPosition(o).setTarget(e.center);t.requestPOV(n,r)},requestPOVbyNode:(e,r)=>{if(void 0===e)return;let o=e.getBound();t.requestPOVbyBound(o,r)},requestRetarget:(e,r,o)=>{let i=new THREE.Vector3;if(void 0===r)i.lerpVectors(e,t._currPOV.pos,.8);else{let o=e.distanceTo(t._currPOV.pos);o*=.5,i.x=e.x+r.x*o,i.y=e.y+r.y*o,i.z=e.z+r.z*o}let n=e.distanceTo(i);ATON.FX.setDOFfocus(n);let a=(new ATON.POV).setPosition(i).setTarget(e).setFOV(t._currPOV.fov);t.requestPOV(a,o),console.log(a)},computeDefaultHome:e=>{void 0===e&&(e=new THREE.Vector3(1,.7,1));let r=ATON.getRootScene().getBound(),o=new THREE.Vector3(r.center.x+r.radius*e.x*1.5,r.center.y+r.radius*e.y*1.5,r.center.z+r.radius*e.z*1.5);t.homePOV=(new ATON.POV).setPosition(o).setTarget(r.center)},setHomePOV:e=>{t.homePOV=e},computeAndRequestDefaultHome:(e,r)=>{t.computeDefaultHome(r),t.requestPOV(t.homePOV,e)},requestHome:e=>{t.requestPOV(t.homePOV,e)},setAndRequestHomePOV:(e,r)=>{t.setHomePOV(e),t.requestPOV(e,r)},DeviceOrientationControls:function(e){let t=this;this.object=e,this.object.rotation.reorder("YXZ"),this.enabled=!0,this.deviceOrientation={},this.screenOrientation=0,this.alphaOffset=0,this.absolute=!1,this.alphaOffsetDevice=void 0,this.alphaOffsetScreen=void 0;let r=function(e){t.absolute||(t.deviceOrientation=e)},o=function(e){t.deviceOrientation=e,t.absolute=!0},i=function(){t.screenOrientation=window.orientation||0},n=function(){let e=new THREE.Vector3(0,0,1),t=new THREE.Euler,r=new THREE.Quaternion,o=new THREE.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5));return function(i,n,a,s,_){t.set(a,n,-s,"YXZ"),i.setFromEuler(t),i.multiply(o),i.multiply(r.setFromAxisAngle(e,-_))}}();this.connect=function(){i(),window.addEventListener("orientationchange",i,!1),window.addEventListener("deviceorientation",r,!1),window.addEventListener("deviceorientationabsolute",o,!1),t.enabled=!0},this.disconnect=function(){window.removeEventListener("orientationchange",i,!1),window.removeEventListener("deviceorientation",r,!1),window.removeEventListener("deviceorientationabsolute",o,!1),t.enabled=!1},this.update=function(){if(!1===t.enabled)return;let e;if(e=t.deviceOrientation){let r=this.getDirection()?THREE.Math.degToRad(this.getDirection())+t.alphaOffset:0,o=e.beta?THREE.Math.degToRad(e.beta):0,i=e.gamma?THREE.Math.degToRad(e.gamma):0,a=t.screenOrientation?THREE.Math.degToRad(t.screenOrientation):0;n(t.object.quaternion,r,o,i,a)}},this.dispose=(()=>{t.disconnect()}),this.iOSOrientationPermission=(()=>{"function"==typeof DeviceOrientationEvent.requestPermission&&DeviceOrientationEvent.requestPermission().then(e=>{console.log(e)}).catch(console.error)}),this.getDirection=(()=>void 0!==t.deviceOrientation.webkitCompassHeading?t.deviceOrientation.webkitCompassHeading:t.deviceOrientation.alpha),this.getDirectionMap=(()=>void 0!==t.deviceOrientation.webkitCompassHeading?360-t.deviceOrientation.webkitCompassHeading:t.deviceOrientation.alpha),this.connect()}};var r=t;exports.default=r;
},{}],"jROx":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;let e={STD_TELEP_DURATION:.03,HAND_R:0,HAND_L:1,MOBILE_DENSITY_F:.5,init:()=>{ATON._renderer.xr.enabled=!0,ATON._renderer.xr.setReferenceSpaceType("local"),ATON.device.isMobile?ATON._renderer.xr.setFramebufferScaleFactor(ATON._stdpxd*e.MOBILE_DENSITY_F):ATON._renderer.xr.setFramebufferScaleFactor(ATON._stdpxd),e._bPresenting=!1,e.currSession=null,e._sessionType="immersive-vr",e.rig=new THREE.Group,e.rig.add(ATON.Nav._camera),ATON._rootUI.add(e.rig),e._cam=void 0,e._currPos=e.rig.position,e._fromPos=new THREE.Vector3,e._reqPos=new THREE.Vector3,e.gControllers=void 0,e.controller0=void 0,e.controller1=void 0,e.controller0pos=new THREE.Vector3,e.controller1pos=new THREE.Vector3,e.controller0dir=new THREE.Vector3,e.controller1dir=new THREE.Vector3,e._lastPosR=void 0,e._lastPosL=void 0,e._pointerLineGeom=void 0,e._pointerLineMesh=void 0,e.gpad0=void 0,e.gpad1=void 0,e._urlHand=ATON.PATH_RES+"models/hand/hand.glb",ATON.on("XRselectStart",r=>{r===e.HAND_R&&ATON._stdActivation()}),ATON.on("XRselectEnd",e=>{}),ATON.on("XRsqueezeStart",e=>{console.log("Squeeze "+e)}),ATON.on("VRC_IDassigned",e=>{let r=ATON.getUINode("Rhand"),o=ATON.getUINode("Lhand"),t=ATON.MatHub.materials.avatars,n=t[e%t.length];o&&o.setMaterial(n),r&&r.setMaterial(n)})},setSessionType:r=>{void 0!==r&&("immersive-vr"!==r&&"immersive-ar"!==r||(e._sessionType=r,console.log("Session type: "+r)))},isPresenting:()=>e._bPresenting,teleportOnQueriedPoint:()=>{if(!ATON.Nav.currentQueryValidForLocomotion())return!1;const r=ATON._queryDataScene.p;return ATON.Nav.requestPOV((new ATON.POV).setPosition(r.x,r.y+ATON.userHeight,r.z),e.STD_TELEP_DURATION),!0},setupQueryRay:r=>{void 0!==r&&(e.controller0?r.set(e.controller0pos,e.controller0dir):r.set(ATON.Nav.getCurrentEyeLocation(),ATON.Nav.getCurrentDirection()))},setRefSpaceLocation:r=>{e.rig.position.copy(r)},_setupControllerR:(r,o)=>{e.controller0||(e.controller0=r,console.log("R controller"),r.addEventListener("selectstart",()=>{ATON.fireEvent("XRselectStart",e.HAND_R)}),r.addEventListener("selectend",()=>{ATON.fireEvent("XRselectEnd",e.HAND_R)}),r.addEventListener("squeezestart",()=>{ATON.fireEvent("XRsqueezeStart",e.HAND_R)}),r.addEventListener("squeezeend",()=>{ATON.fireEvent("XRsqueezeEnd",e.HAND_R)}),e.setupControllerUI(e.HAND_R,o),ATON.fireEvent("XRcontrollerConnected",e.HAND_R))},_setupControllerL:(r,o)=>{e.controller1||(e.controller1=r,console.log("L controller"),r.addEventListener("selectstart",()=>{ATON.fireEvent("XRselectStart",e.HAND_L)}),r.addEventListener("selectend",()=>{ATON.fireEvent("XRselectEnd",e.HAND_L)}),r.addEventListener("squeezestart",()=>{ATON.fireEvent("XRsqueezeStart",e.HAND_L)}),r.addEventListener("squeezeend",()=>{ATON.fireEvent("XRsqueezeEnd",e.HAND_L)}),e.setupControllerUI(e.HAND_L,o),ATON.fireEvent("XRcontrollerConnected",e.HAND_L))},onSessionStarted:r=>{e.currSession||(r.addEventListener("end",e.onSessionEnded),console.log(e._sessionType+" session started."),ATON.MediaRec.stopMediaStreaming(),ATON._renderer.xr.setSession(r).then(()=>{e.currSession=r,console.log(e.currSession),"immersive-ar"===e._sessionType&&(ATON._mainRoot.background=null,ATON._mMainPano&&(ATON._mMainPano.visible=!1));for(let r=0;r<2;r++){const o=ATON._renderer.xr.getController(r);void 0===o||o.userData.bXRconfig||(o.visible=!1,o.userData.bXRconfig=!0,o.addEventListener("connected",r=>{let t=r.data.handedness;console.log("Hand "+t),"left"===t?e._setupControllerL(o,!0):"right"===t?e._setupControllerR(o,!0):(o.addEventListener("selectstart",()=>{ATON.fireEvent("XRselectStart",e.HAND_R),console.log("Head-aligned select")}),o.addEventListener("selectend",()=>{ATON.fireEvent("XRselectEnd",e.HAND_R)}),ATON.fireEvent("XRcontrollerConnected",e.HAND_R))}))}e.rig.add(ATON.Nav._camera),e.setRefSpaceLocation(ATON.Nav._currPOV.pos),console.log(ATON.Nav._currPOV.pos),e._bPresenting=!0,console.log("XR now presenting"),ATON.fireEvent("XRmode",!0),ATON.SUI.getSelectorRadius()>.5&&ATON.SUI.setSelectorRadius(.5);let o=ATON._renderer.xr.getCamera();ATON.Nav._updCamera(o),setTimeout(()=>{ATON.SUI.getSelectorRadius()>.5&&ATON.SUI.setSelectorRadius(.5)},2e3)}))},onSessionEnded:()=>{e.currSession.removeEventListener("end",e.onSessionEnded),e.currSession=null,e._bPresenting=!1,e.setRefSpaceLocation(new THREE.Vector3(0,0,0)),ATON.fireEvent("XRmode",!1),ATON.MediaRec.stopMediaStreaming(),ATON.Nav.requestHome(),ATON.Nav._updCamera(),console.log("Quit XR")},toggle:r=>{if(e.setSessionType(r),ATON.device.xrSupported[e._sessionType])if(null===e.currSession){let r={optionalFeatures:[]};navigator.xr.requestSession(e._sessionType,r).then(e.onSessionStarted)}else e.currSession.end()},setupControllerUI:(r,o)=>{let t=void 0,n=void 0;if(void 0===e.gControllers&&(e.gControllers=ATON.createUINode(),e.gControllers.disablePicking(),e.rig.add(e.gControllers)),r===e.HAND_L?(e.gControllers.add(e.controller1),o&&(n=ATON.createUINode("Lhand").load(e._urlHand).setMaterial(ATON.MatHub.materials.controllerRay).setScale(-1,1,1),e.controller1.add(n))):(e.gControllers.add(e.controller0),o&&(e._pointerLineGeom=new THREE.CylinderBufferGeometry(.003,.003,1,4),e._pointerLineGeom.rotateX(-Math.PI/2),e._pointerLineGeom.translate(0,0,-.5),e._pointerLineMesh=new THREE.Mesh(e._pointerLineGeom,ATON.MatHub.materials.controllerRay),e.controller0.add(e._pointerLineMesh),e._pointerLineMesh.visible=!1,t=ATON.createUINode("Rhand").load(e._urlHand).setMaterial(ATON.MatHub.materials.controllerRay),e.controller0.add(t))),void 0!==ATON.VRoadcast.uid&&o){let o=ATON.MatHub.materials.avatars,l=o[ATON.VRoadcast.uid%o.length];r===e.HAND_L?n.setMaterial(l):t.setMaterial(l)}},switchHands:()=>{let r=e.controller1;e.controller1=e.controller0,e.controller0=r;for(let o in e.controller0.children)e.controller0.remove(e.controller0.children[o]);for(let o in e.controller1.children)e.controller1.remove(e.controller1.children[o]);e.gControllers.removeChildren(),e.setupControllerUI(e.HAND_L),e.setupControllerUI(e.HAND_R),console.log("VR controllers switched")},getControllerSpace:r=>{1===r?e.getControllerGrip(1):e.getControllerGrip(0)},getControllerWorldLocation:r=>1===r?e.controller1pos:e.controller0pos,getControllerWorldDirection:r=>1===r?e.controller1dir:e.controller0dir,_deltaMotionController:r=>{if(r===e.HAND_L&&void 0===e._lastPosL)return;if(r===e.HAND_R&&void 0===e._lastPosR)return;let o=r===e.HAND_L?e.controller1pos:e.controller0pos,t=r===e.HAND_L?e._lastPosL:e._lastPosR;THREE.Vector3(o.x-t.x,o.y-t.y,o.z-t.z).lengthSq();r===e.HAND_L?e._lastPosL=o:e._lastPosR=o},update:()=>{e.controller0&&e.controller0.visible&&(e.controller0.getWorldPosition(e.controller0pos),e.controller0.getWorldDirection(e.controller0dir),e.controller0dir.negate()),e.controller1&&e.controller1.visible&&(e.controller1.getWorldPosition(e.controller1pos),e.controller1.getWorldDirection(e.controller1dir),e.controller1dir.negate())}};var r=e;exports.default=r;
},{}],"fWYX":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t=e(require("./ATON.node.js"));function e(t){return t&&t.__esModule?t:{default:t}}class i extends t.default{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;super(t,ATON.NTYPES.UI),this.baseColor=ATON.MatHub.colors.black,this.switchColor=ATON.MatHub.colors.green,this.baseOpacity=.5,this.hoverOpacity=.8,this._bSwitched=!1,this.container=new ThreeMeshUI.Block({width:.1*e,height:.1,padding:.01,borderRadius:.02,backgroundColor:this.baseColor,backgroundOpacity:this.baseOpacity,fontFamily:ATON.SUI.PATH_FONT_JSON,fontTexture:ATON.SUI.PATH_FONT_TEX,justifyContent:"center",alignContent:"center"}),this.add(this.container),this.uiText=new ThreeMeshUI.Text({content:"",fontSize:.02*i,fontColor:ATON.MatHub.colors.white}),this.container.add(this.uiText);let s=.9*ATON.SUI.STD_BTN_SIZE*e,r=.9*ATON.SUI.STD_BTN_SIZE;this._trigger=new THREE.Mesh(new THREE.PlaneGeometry(s,r,2),ATON.MatHub.materials.fullyTransparent),this._trigger.position.set(0,0,.002),this.add(this._trigger),this.onHover=(()=>{this.container.set({backgroundOpacity:this.hoverOpacity})}),this.onLeave=(()=>{this.container.set({backgroundOpacity:this.baseOpacity})}),this.enablePicking()}setBaseColor(t){return this.baseColor=t,this._bSwitched||this.container.set({backgroundColor:this.baseColor}),this}setSwitchColor(t){return this.switchColor=t,this._bSwitched&&this.container.set({backgroundColor:this.switchColor}),this}setBackgroundOpacity(t){return this.container.set({backgroundOpacity:t}),this.baseOpacity=t,this}setText(t){return this.uiText.set({content:t}),this}switch(t){return this._bSwitched=t,t?this.container.set({backgroundColor:this.switchColor}):this.container.set({backgroundColor:this.baseColor}),this}setIcon(t,e){return ATON.Utils.textureLoader.load(t,t=>{this._trigger.material=new THREE.MeshStandardMaterial({map:t,transparent:!0,depthWrite:!1}),e&&(this.setBackgroundOpacity(0),this.hoverOpacity=0),this.uiText.position.set(0,-.035,0)}),this}}var s=i;exports.default=s;
},{"./ATON.node.js":"XTSP"}],"iqtl":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t=e(require("./ATON.node.js"));function e(t){return t&&t.__esModule?t:{default:t}}class o extends t.default{constructor(t){super(t,ATON.NTYPES.UI),this.baseColor=ATON.MatHub.colors.black,this.container=new ThreeMeshUI.Block({width:.2,height:.05,padding:.001,borderRadius:.01,backgroundColor:this.baseColor,backgroundOpacity:.5,fontFamily:ATON.SUI.PATH_FONT_JSON,fontTexture:ATON.SUI.PATH_FONT_TEX,justifyContent:"center",alignContent:"center"}),this.container.position.z=.05,this.add(this.container),this.uiText=new ThreeMeshUI.Text({content:"Label",fontSize:.03,fontColor:ATON.MatHub.colors.white}),this.container.add(this.uiText)}setBaseColor(t){return this.baseColor=t,this.container.set({backgroundColor:this.baseColor}),this}setTextColor(t){return this.uiText.set({fontColor:t}),this}setText(t){return this.uiText.set({content:t}),this}}var r=o;exports.default=r;
},{"./ATON.node.js":"XTSP"}],"xSlA":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=t(require("./ATON.sui.button.js")),o=t(require("./ATON.sui.label.js"));function t(e){return e&&e.__esModule?e:{default:e}}let i={STD_BTN_SIZE:.1};i.Button=e.default,i.Label=o.default,i.init=(()=>{i.mainSelector=ATON.createUINode(),i._mSelectorSphere=new THREE.Mesh(ATON.Utils.geomUnitSphere,ATON.MatHub.getMaterial("selector")),i._mSelectorSphere.renderOrder=100,i.mainSelector.add(i._mSelectorSphere),i.mainSelector.disablePicking(),i.setSelectorRadius(.05),i.mainSelector.visible=!1,ATON._rootUI.add(i.mainSelector),i.fpTeleport=ATON.createUINode();let e=new THREE.CylinderBufferGeometry(.4,.4,.9,32,1,!0),o=new THREE.Mesh(e,ATON.MatHub.getMaterial("teleportLoc"));o.renderOrder=100,i.fpTeleport.add(o),i.fpTeleport.disablePicking(),i.fpTeleport.visible=!1,ATON._rootUI.add(i.fpTeleport),i.PATH_FONT_JSON=ATON.PATH_RES+"fonts/custom-msdf.json",i.PATH_FONT_TEX=ATON.PATH_RES+"fonts/custom.png",i.gMeasures=ATON.createUINode(),i._prevMPoint=void 0,i._measLabels=[],ATON._rootUI.add(i.gMeasures);let t=(new THREE.BufferGeometry).setFromPoints([new THREE.Vector3,new THREE.Vector3]);i._measLine=new THREE.Line(t,ATON.MatHub.getMaterial("measurement")),i._measLine.visible=!1,ATON._rootUI.add(i._measLine),i.gPoints=ATON.createUINode(),ATON._rootUI.add(i.gPoints),i.buildInfoNode(),i.bShowInfo=!0,i._labelScale=ATON.Utils.isMobile()?50:60,i._labelScaleVR=2,ATON.on("SemanticNodeHover",e=>{i.setInfoNodeText(e),i.gSemIcons&&i.gSemIcons.hide()}),ATON.on("SemanticNodeLeave",e=>{i.gSemIcons&&i.gSemIcons.show()}),i._sync=0}),i.enableLPIcons=(()=>{i.gLPIcons=ATON.createUINode(),i.gLPIcons.disablePicking(),ATON._rootUI.add(i.gLPIcons)}),i.enableSemIcons=(()=>{i.gSemIcons=ATON.createUINode(),i.gSemIcons.disablePicking(),ATON._rootUI.add(i.gSemIcons)}),i.setSelectorRadius=(e=>{i._selectorRad=e,i.mainSelector.scale.set(e,e,e)}),i.getSelectorRadius=(()=>i._selectorRad),i.setSelectorModel=((e,o)=>{void 0!==e&&(i.mainSelector.removeChildren(),i.mainSelector.load(e).disablePicking(),o&&i.mainSelector.setMaterial(ATON.MatHub.getMaterial("selector")))}),i.setSelectorColor=((e,o)=>{ATON.MatHub.materials.selector.uniforms.color.value=e,void 0!==o&&(ATON.MatHub.materials.selector.uniforms.opacity.value=o)}),i.addSemIcon=((e,o)=>{if(void 0===i.gSemIcons)return;let t=(new THREE.Box3).setFromObject(o),a=new THREE.Sphere;t.getBoundingSphere(a);let n=new THREE.Sprite(ATON.MatHub.semIcon);n.position.copy(a.center);n.scale.set(.035,.035,1),n.name=e,i.gSemIcons.add(n)}),i.addLPIcon=(e=>{if(void 0===i.gLPIcons)return;let o=e._near,t=new THREE.Sprite(ATON.MatHub.lpIcon);t.position.copy(e.pos),t.scale.set(.1,.1,.1);let a=new THREE.Mesh(ATON.Utils.geomUnitSphere,ATON.MatHub.materials.lp);a.scale.set(o,o,o),a.position.copy(e.pos),i.gLPIcons.add(t),i.gLPIcons.add(a)}),i.setSemIconsOpacity=(e=>{ATON.MatHub.semIcon.opacity=void 0===e?1:e}),i.buildInfoNode=(()=>{i.infoNode=ATON.createUINode(),i.infoNode.attachToRoot(),i.infoContainer=new ThreeMeshUI.Block({width:.15,height:.05,padding:.01,borderRadius:.02,backgroundColor:ATON.MatHub.colors.black,fontFamily:i.PATH_FONT_JSON,fontTexture:i.PATH_FONT_TEX,alignContent:"center",justifyContent:"center"}),i.infoNode.add(i.infoContainer),i.infoNodeText=new ThreeMeshUI.Text({content:"Info",fontSize:.02,fontColor:ATON.MatHub.colors.white}),i.infoContainer.add(i.infoNodeText)}),i.getInfoNode=(()=>i.infoNode),i.setInfoNodeText=(e=>{i.bShowInfo&&(i.infoNodeText.set({content:e}),ThreeMeshUI.update())}),i.createToolbar=((e,o)=>{let t=ATON.createUINode(),a=e.length,n=.3*i.STD_BTN_SIZE,r=new ThreeMeshUI.Block({width:i.STD_BTN_SIZE*a*1.1+n,height:i.STD_BTN_SIZE+n,padding:.01,borderRadius:.02,backgroundColor:o||ATON.MatHub.colors.black,backgroundOpacity:.3,fontFamily:i.PATH_FONT_JSON,fontTexture:i.PATH_FONT_TEX,alignContent:"center",justifyContent:"center"}),s=.5*a*i.STD_BTN_SIZE*1.1;s-=.5*i.STD_BTN_SIZE;for(let l=0;l<a;l++){let o=e[l];o&&(o.position.set(l*i.STD_BTN_SIZE*1.1-s,0,.005),r.add(o))}return t.add(r),t}),i.addMeasurementPoint=(e=>{if(void 0===e)return;let o=.01,t=.001;if(void 0===i._prevMPoint){i._prevMPoint=e;let o=i._measLine.geometry.attributes.position.array;return o[0]=e.x,o[1]=e.y,void(o[2]=e.z)}i._measLine.visible=!1;let a=i._prevMPoint.distanceTo(e);o*=a,t*=a;let n=new THREE.Mesh(ATON.Utils.geomUnitSphere,ATON.MatHub.getMaterial("measurement"));n.position.copy(i._prevMPoint),n.scale.set(o,o,o),i.gMeasures.add(n);let r=new THREE.Mesh(ATON.Utils.geomUnitSphere,ATON.MatHub.getMaterial("measurement"));r.position.copy(e),r.scale.set(o,o,o),i.gMeasures.add(r);let s=2*a,l=(new THREE.BufferGeometry).setFromPoints([i._prevMPoint,e]);i.gMeasures.add(new THREE.Line(l,ATON.MatHub.getMaterial("measurement")));let c=new i.Label;c.setBaseColor(ATON.MatHub.colors.white).setTextColor(ATON.MatHub.colors.black),c.setPosition(.5*(i._prevMPoint.x+e.x),.5*(i._prevMPoint.y+e.y),.5*(i._prevMPoint.z+e.z)),c.setScale(s).setText(ATON.Utils.getHumanReadableDistance(a)),i.gMeasures.add(c),i._measLabels.push(c);let T={};return T.A=i._prevMPoint.clone(),T.B=e.clone(),i._prevMPoint=void 0,T}),i.clearMeasurements=(()=>{i.gMeasures.removeChildren(),i._measLabels=[]}),i._updateMeasurements=(()=>{if(!(i._measLabels.length<=0))for(let e in i._measLabels)i._measLabels[e].orientToCamera()}),i.update=(()=>{if(ATON.Nav.isTransitioning()||ATON._bPauseQuery)i.infoNode.visible=!1;else{if(ThreeMeshUI.update(),i._prevMPoint){if(ATON._queryDataScene){let e=i._measLine.geometry.attributes.position.array;e[3]=ATON._queryDataScene.p.x,e[4]=ATON._queryDataScene.p.y,e[5]=ATON._queryDataScene.p.z,i._measLine.geometry.attributes.position.needsUpdate=!0}i._measLine.visible=!0}else i._measLine.visible=!1;if(ATON._queryDataScene&&!ATON.Nav._bInteracting?(i.mainSelector.visible=!0,i.mainSelector.position.copy(ATON._queryDataScene.p)):i.mainSelector.visible=!1,i.gSemIcons&&(ATON.Nav._bInteracting?i.gSemIcons.hide():void 0===ATON._hoveredSemNode&&i.gSemIcons.show()),ATON.Nav.isOrbit()&&!ATON.XR._bPresenting||!ATON.Nav.currentQueryValidForLocomotion()?i.fpTeleport.visible=!1:(i.fpTeleport.visible=!0,i.fpTeleport.position.copy(ATON._queryDataScene.p)),ATON.XR._pointerLineMesh){let e=0;ATON._queryDataScene&&(e=ATON._queryDataScene.d),ATON._queryDataUI&&(e<=0||ATON._queryDataUI.d<e)&&(e=ATON._queryDataUI.d,i.mainSelector.visible=!1,i.fpTeleport.visible=!1),e>0?(ATON.XR._pointerLineMesh.visible=!0,ATON.XR._pointerLineMesh.scale.set(1,1,e)):ATON.XR._pointerLineMesh.visible=!1}if(i._updateMeasurements(),ATON._queryDataSem){if(ATON.XR._bPresenting)ATON.XR.controller0?(i.infoNode.position.copy(ATON.XR.controller0pos),i.infoNode.position.x-=.1*ATON.XR.controller0dir.x,i.infoNode.position.y-=.1*ATON.XR.controller0dir.y,i.infoNode.position.z-=.1*ATON.XR.controller0dir.z,i.infoNode.setScale(i._labelScaleVR)):(i.infoNode.position.lerpVectors(ATON._queryDataSem.p,ATON.Nav._currPOV.pos,.5),i.infoNode.setScale(ATON._queryDataSem.d*i._labelScaleVR));else{i.infoNode.position.lerpVectors(ATON._queryDataSem.p,ATON.Nav._currPOV.pos,.2);const e=ATON._queryDataSem.d*(ATON.Nav._currPOV.fov/i._labelScale);i.infoNode.setScale(e)}i.infoNode.orientToCamera(),i.bShowInfo&&(i.infoNode.visible=!0),ATON.VRoadcast._bStreamFocus||(i.mainSelector.visible=!1)}else i.infoNode.visible=!1;if(i.mainSelector.visible&&ATON.VRoadcast._bStreamFocus){let e=i._selectorRad*(1+.2*Math.cos(10*ATON._clock.elapsedTime));i.mainSelector.scale.set(e,e,e)}}});var a=i;exports.default=a;
},{"./ATON.sui.button.js":"fWYX","./ATON.sui.label.js":"iqtl"}],"Qwfv":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=s(require("./ATON.node.js"));function s(e){return e&&e.__esModule?e:{default:e}}class t extends e.default{constructor(e){super(void 0,ATON.NTYPES.UI),this.userid=e,this.username=void 0,this.message="...",this._auTalk=new THREE.PositionalAudio(ATON.AudioHub._listener),this._auTalk.setRefDistance(30),this.add(this._auTalk),this._bPlayingAudio=!1,this._auChunks=[],this._tStateCall=-1,this._tProgress=0,this._tFocCall=-1,this._currFocusPos=new THREE.Vector3,this._tgtFocusPos=void 0,this._currState={},this._currState.position=new THREE.Vector3,this._currState.quaternion=new THREE.Quaternion,this._tgtState=void 0,this.realize()}setTalkDistance(e){e>0&&this._auTalk.setRefDistance(e)}getAvatarMaterialByUID(e){let s=ATON.MatHub.materials.avatars;return s[e%s.length]}realize(){let e=new THREE.SphereGeometry(.2,16,16);this.usermaterial=this.getAvatarMaterialByUID(this.userid);let s=new THREE.Mesh(e,this.usermaterial);this.usermeshnode=ATON.createUINode(),this.usermeshnode.add(s),this.usermeshnode.setMaterial(this.usermaterial),this.usermeshnode.setCloneOnLoadHit(!1),this.userauinode=new THREE.Sprite(ATON.VRoadcast.uspritemats[this.userid%ATON.VRoadcast.uspritemats.length]),this.userauinode.position.set(0,0,0),this.userauinode.visible=!1,this.userfpnode=new THREE.Sprite(ATON.VRoadcast.ufocmats[this.userid%ATON.VRoadcast.ufocmats.length]),this.userfpnode.position.set(0,0,0),this.userfpnode.visible=!1,this.userlabelnode=ATON.createUINode(),this.labelcontainer=new ThreeMeshUI.Block({width:.7,height:.25,padding:.03,borderRadius:.05,backgroundColor:ATON.MatHub.colors.black,fontFamily:ATON.PATH_RES+"fonts/custom-msdf.json",fontTexture:ATON.PATH_RES+"fonts/custom.png"}),this.userlabelnode.position.y=.4,this.userlabelnode.add(this.labelcontainer),this.usernametext=new ThreeMeshUI.Text({content:"User #"+this.userid,fontSize:.09,fontColor:ATON.VRoadcast.ucolors[this.userid%ATON.VRoadcast.ucolors.length]}),this.usernametext.position.y=0,this.usermessagetext=new ThreeMeshUI.Text({content:"\nHello World!",fontSize:.03,fontColor:ATON.MatHub.colors.white}),this.usermessagetext.position.y=-.03,this.labelcontainer.add(this.usernametext),this.labelcontainer.add(this.usermessagetext),this.add(this.usermeshnode),this.add(this.userlabelnode),this.add(this.userauinode),void 0===ATON.VRoadcast._focNodes[this.userid]&&(ATON.VRoadcast._focNodes[this.userid]=this.userfpnode,ATON.VRoadcast.focGroup.add(this.userfpnode))}destroy(){this.usermaterial&&this.usermaterial.dispose(),this.usermeshnode&&this.usermeshnode.dispose(),this.userauinode&&this.userauinode.dispose(),this.userfpnode&&this.userfpnode.dispose(),ATON.VRoadcast._focNodes[this.userid]&&ATON.VRoadcast._focNodes[this.userid].dispose(),this.userlabelnode&&this.userlabelnode.dispose(),this.labelcontainer&&this.labelcontainer.dispose(),this.usernametext&&this.usernametext.dispose(),this.usermessagetext&&this.usermessagetext.dispose(),this.dispose()}loadRepresentation(e){let s=this;return void 0!==s.usermeshnode.children[0]&&s.usermeshnode.remove(s.usermeshnode.children[0]),s.usermeshnode.load(e),this}setUsername(e){return this.username=e,this.usernametext.set({content:e}),this}getUsername(){if(void 0!==this.userid)return void 0===this.username?"User #"+this.userid:this.username}setMessage(e){return this.message=e,this.usermessagetext.set({content:"\n"+e}),this}setTalkVolume(e){if(void 0!==e)if(e>0){this.userauinode.visible=!0;let s=.1+.03*e;this.userauinode.scale.set(s,s,s)}else this.userauinode.visible=!1;else this.userauinode.visible=!1}hideFocalPoint(){this.userfpnode.visible=!1}requestFocus(e){this._tFocCall>=0||(this._tFocCall=ATON._clock.elapsedTime,this._currFocusPos.copy(this.userfpnode.position),this._tgtFocusPos=new THREE.Vector3(parseFloat(e[0]),parseFloat(e[1]),parseFloat(e[2])),this._tgtFocusRad=2*parseFloat(e[3]),this.userfpnode.scale.set(this._tgtFocusRad,this._tgtFocusRad,this._tgtFocusRad),this.userfpnode.visible=!0)}handleFocusTransition(){if(this._tFocCall<0)return;let e=ATON.VRoadcast.USER_STATE_FREQ,s=(ATON._clock.elapsedTime-this._tFocCall)/e;if(s>=1)return this._tFocCall=-1,this.userfpnode.position.copy(this._tgtFocusPos),this.userfpnode.scale.set(this._tgtFocusRad,this._tgtFocusRad,this._tgtFocusRad),void(this.userfpnode.visible=!0);this.userfpnode.position.lerpVectors(this._currFocusPos,this._tgtFocusPos,s),this.userfpnode.visible=!0}requestStateTransition(e){this._tStateCall>=0||(this._tStateCall=ATON._clock.elapsedTime,this._currState.position.copy(this.position),this._currState.quaternion.copy(this.quaternion),this._tgtState=e)}handleStateTransition(){if(this._tStateCall<0)return;let e=ATON.VRoadcast.USER_STATE_FREQ;this._tProgress=e<=0?1:(ATON._clock.elapsedTime-this._tStateCall)/e;let s=this._currState,t=this._tgtState;if(this._tProgress>=1)return this._tStateCall=-1,this.position.copy(t.position),void this.usermeshnode.quaternion.copy(t.quaternion);this.position.lerpVectors(s.position,t.position,this._tProgress),this.usermeshnode.quaternion.slerp(t.quaternion,this._tProgress)}update(){if(this.handleStateTransition(),this.userfpnode.visible){this.handleFocusTransition();let e=this.userfpnode.scale.x;e>.001?this.userfpnode.scale.set(.99*e,.99*e,.99*e):this.userfpnode.visible=!1}let e=ATON.Nav._camera,s=ATON.Nav._currPOV.pos;if(void 0===e||void 0===s)return;this.userlabelnode.orientToCamera();let t=this.userauinode.scale.x;(t*=.99)>.01?this.userauinode.scale.set(t,t,t):this.userauinode.visible=!1}_handleTalk(){if(this._bPlayingAudio)return;if(this._auChunks.length<1)return;let e=this._auChunks.shift(),s=new Audio;s.src=e.data,s.play(),this._bPlayingAudio=!0,s.onended=(()=>{this._bPlayingAudio=!1}),this.setTalkVolume(5)}}exports.default=t;
},{"./ATON.node.js":"XTSP"}],"mY3J":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=t(require("./ATON.avatar.js"));function t(e){return e&&e.__esModule?e:{default:e}}let o={USER_STATE_FREQ:.25,REPLICATED_EVT:"EREP",THRES_STATE_POS:.01,THRES_STATE_ORI:.08};o.Avatar=e.default,o.init=(()=>{o.address=window.location.origin,o.initMaterials(),o.socket=void 0,o._connected=!1,o._username=void 0,o.uid=void 0,o._bStreamFocus=!1,o._numUsers=1,o.avatarList=[],o.avaGroup=ATON.createUINode("avatars"),o.avaGroup.attachToRoot(),o.focGroup=ATON.createUINode("focus"),o.focGroup.attachTo(o.avaGroup),o._focNodes=[],o.bSendState=!0,window.setInterval(o.sendState,1e3*o.USER_STATE_FREQ),o._lastStateSent=void 0,o._bShowAvaG=!0,console.log("VRoadcast initialized"),o.enableChatLog()}),o.enableChatLog=(()=>{o._elChat=$("<div></div>").text("")}),o.getNumUsers=(()=>o._numUsers),o.initMaterials=(()=>{o.ucolors=[],o.ucolors.push(new THREE.Color(1,0,0)),o.ucolors.push(new THREE.Color(1,1,0)),o.ucolors.push(new THREE.Color(0,1,0)),o.ucolors.push(new THREE.Color(0,1,1)),o.ucolors.push(new THREE.Color(0,0,1)),o.ucolors.push(new THREE.Color(1,0,1)),o.ucolorsdark=[],o.ucolorsdark.push(new THREE.Color(.2,0,0)),o.ucolorsdark.push(new THREE.Color(.2,.2,0)),o.ucolorsdark.push(new THREE.Color(0,.2,0)),o.ucolorsdark.push(new THREE.Color(0,.2,.2)),o.ucolorsdark.push(new THREE.Color(0,0,.2)),o.ucolorsdark.push(new THREE.Color(.2,0,.2)),o.ucolorhex=[],o.ucolorhex.push("#F00"),o.ucolorhex.push("#FF0"),o.ucolorhex.push("#0F0"),o.ucolorhex.push("#0FF"),o.ucolorhex.push("#00F"),o.ucolorhex.push("#F0F");let e=ATON.MatHub.materials;e.avatars=[];let t=ATON.MatHub.materials.defUI.clone();t.uniforms.color.value=o.ucolors[0],e.avatars.push(t);for(let s=1;s<o.ucolors.length;s++){let r=t.clone();r.uniforms.color.value=o.ucolors[s],e.avatars.push(r)}o.uspritemats=[];let r=(new THREE.TextureLoader).load(ATON.PATH_RES+"useraui.png");for(let s=0;s<o.ucolors.length;s++){let e=new THREE.SpriteMaterial({map:r,depthWrite:!1,color:o.ucolors[s]});e.sizeAttenuation=!0,o.uspritemats.push(e)}o.ufocmats=[];let a=(new THREE.TextureLoader).load(ATON.PATH_RES+"focus.png");for(let s=0;s<o.ucolors.length;s++){let e=new THREE.SpriteMaterial({map:a,depthWrite:!1,depthTest:!1,color:o.ucolors[s]});e.sizeAttenuation=!0,o.ufocmats.push(e)}}),o.fireEvent=((e,t)=>{if(!o._connected)return;let r=o.socket;r&&r.emit(o.REPLICATED_EVT,{e:e,d:t})}),o.on=((e,t)=>{if(void 0===t)return;let o=ATON.EventHub.evNetwork;void 0===o[e]&&(o[e]=[]),o[e].push(t)}),o.isConnected=(()=>void 0!==o.socket&&o._connected),o.hasID=(()=>void 0!==o.uid),o.log=(e=>{if(!o._connected)return;let t=o.socket;t&&t.emit("LOG",e)}),o.joinSession=(e=>{o.socket&&(void 0===e&&(e=ATON.SceneHub.currID),void 0!==e?(console.log("Joining VRC session "+e+"..."),o.socket.emit("SENTER",e)):console.log("VRC ERROR: current session ID is undefined"))}),o.requestSceneState=(()=>{o.socket&&o.socket.emit("SSTATE")}),o.setAvatarsVisibility=(e=>{o._bShowAvaG=e,e?o.avaGroup.show():o.avaGroup.hide()}),o.connect=(e=>{if(o._connected)return;e&&(o.address=e);let t={};"https:"===window.location.protocol?(t.path="/svrc/socket.io",t.secure=!0,t.rejectUnauthorized=!1):t.path="/vrc/socket.io",o.socket=io.connect(o.address,t),void 0!==o.socket&&(o._connected=o.socket.connected,o._registerSocketHandlers())}),o.disconnect=(()=>{void 0!==o.socket&&(o._numUsers=1,o.socket.disconnect(),o._connected=!1)}),o._onConnected=(()=>{}),o.setUsername=(e=>{o._username=e,void 0!==o.socket&&void 0!==o.uid&&(o._elChat&&o._elChat.append("<i>Your username is now: "+e+"</i><br>"),o.socket.emit("UNAME",e))}),o.setMessage=(e=>{o._msg=e,void 0!==o.socket&&void 0!==o.uid&&(o._elChat&&(o._elChat.append("<span style='color:"+o.ucolorhex[o.uid%6]+"'><b>YOU</b>: "+e+"</span><br>"),o._elChat.scrollTop(o._elChat.scrollHeight)),o.socket.emit("UMSG",e))}),o._registerSocketHandlers=(()=>{o.socket.on("connect",()=>{o._connected=!0,void 0!==ATON.SceneHub.currID&&o.joinSession(),console.log("Connected to VRC service!"),ATON.fireEvent("VRC_Connected"),o._onConnected()}),o.socket.on("disconnect",()=>{o._connected=!1,o.uid=void 0,o.avaGroup.hide(),o._elChat&&o._elChat.append("<i>YOU disconnected from VRoadcast service</i><br>"),console.log("VRC disconnected!"),ATON.fireEvent("VRC_Disconnected")}),o.socket.on(o.REPLICATED_EVT,e=>{let t=e.e,o=e.d,r=ATON.EventHub.evNetwork[t];ATON.EventHub.executeHandlers(r,o)}),o.socket.on("ID",e=>{console.log("Your ID is "+e),o.uid=e,o._bShowAvaG&&o.avaGroup.show(),o._elChat&&o._elChat.append("<i>Your ID is #"+e+"</i><br>"),o.requestSceneState(),ATON.fireEvent("VRC_IDassigned",e)}),o.socket.on("SSTATE",e=>{o._numUsers=e.numUsers,console.log("Num. users: "+o._numUsers),ATON.fireEvent("VRC_SceneState",e)}),o.socket.on("UENTER",e=>{let t=e;console.log("User #"+t+" entered the scene"),o._elChat&&o._elChat.append("<i>User #"+t+" entered the scene</i><br>"),o.touchAvatar(t),o.requestSceneState(),ATON.fireEvent("VRC_UserEnter",t)}),o.socket.on("ULEAVE",e=>{let t=e;if(void 0===t)return;let r=o.avatarList[t];r&&r.hide(),console.log("User #"+t+" left the scene"),o._elChat&&o._elChat.append("<i>User #"+t+" left the scene</i><br>"),o.requestSceneState(),ATON.fireEvent("VRC_UserLeave",t)}),o.socket.on("USTATE",e=>{if(!o._bShowAvaG)return;let t=o.decodeState(e),r=t.userid;o.touchAvatar(r).requestStateTransition(t)}),o.socket.on("UFOCUS",e=>{let t=e.uid,r=e.fp;o.touchAvatar(t).requestFocus(r)}),o.socket.on("UNAME",e=>{let t=e.uid,r=e.name;void 0!==t&&(o.touchAvatar(t).setUsername(r),console.log("User #"+t+" changed username to: "+r),o._elChat&&o._elChat.append("<i>User #"+t+" changed username to: "+r+"</i><br>"))}),o.socket.on("UMSG",e=>{let t=e.uid,r=e.msg;if(void 0===t)return;let a=o.touchAvatar(t);a.setMessage(r),console.log("User #"+t+": "+r),o._elChat&&o._elChat.append("<span style='color:"+o.ucolorhex[t%6]+"'><b>"+a.getUsername()+"</b>: "+r+"</span><br>")}),o.socket.on("UTALK",e=>{let t=e.uid;if(void 0===t)return;let r=e.audio,a=o.touchAvatar(t);a.setTalkVolume(5),a._auTalk.isPlaying&&a._auTalk.stop(),ATON.AudioHub._loader.load(r,e=>{a._auTalk.setBuffer(e),a._auTalk.setLoop(!1),a._auTalk.play()}),r=null})}),o.encodeState=(e=>{if(!e)return;let t=new Float32Array(6);t[0]=e.position.x,t[1]=e.position.y,t[2]=e.position.z;var o=new Int8Array(t.buffer);return o[16]=128*e.quaternion.x,o[17]=128*e.quaternion.y,o[18]=128*e.quaternion.z,o[19]=128*e.quaternion.w,o[20]=e.userid,o}),o.decodeState=(e=>{let t={},o=new Int8Array(e);return t.userid=o[20],t.quaternion=new THREE.Quaternion(o[16]/128,o[17]/128,o[18]/128,o[19]/128),o=new Float32Array(e),t.position=new THREE.Vector3(o[0],o[1],o[2]),t}),o.update=(()=>{if(o._connected)for(let e=0;e<o.avatarList.length;e++){let t=o.avatarList[e];t&&t.visible&&t.update()}}),o.setFocusStreaming=(e=>{if(void 0!==e){if(e)return o._bStreamFocus||ATON.fireEvent("VRC_FocusStreamingStarted"),void(o._bStreamFocus=!0);{o._bStreamFocus&&ATON.fireEvent("VRC_FocusStreamingStopped");let e=ATON.SUI._selectorRad;ATON.SUI.mainSelector.scale.set(e,e,e),o._bStreamFocus=!1}}}),o.sendState=(()=>{if(!o.bSendState)return;if(void 0===o.uid)return;if(!o.socket||!o._connected)return;let e=ATON.Nav._currPOV;if(!e)return;let t=ATON.getSceneQueriedPoint();if(o._bStreamFocus&&void 0!==t){let e=t.x.toPrecision(5),r=t.y.toPrecision(5),a=t.z.toPrecision(5),s=ATON.SUI.getSelectorRadius().toPrecision(5);o.socket.emit("UFOCUS",[e,r,a,s])}let r={};if(r.position=new THREE.Vector3,r.quaternion=new THREE.Quaternion,r.position.copy(e.pos),r.quaternion.copy(ATON.Nav._qOri),r.userid=o.uid,void 0!==o._lastStateSent){let t=o._lastStateSent.position,r=o._lastStateSent.quaternion,a=t.distanceToSquared(e.pos),s=r.angleTo(ATON.Nav._qOri);if(a<o.THRES_STATE_POS&&s<o.THRES_STATE_ORI)return}let a=o.encodeState(r);o.socket.emit("USTATE",a),o._lastStateSent=r}),o.getAvatar=(e=>o.avatarList[e]),o.touchAvatar=(e=>{if(void 0===o.avatarList[e]){let t=new o.Avatar(e);t.attachTo(o.avaGroup),t.loadRepresentation(ATON.PATH_RES+"models/vrc/head.gltf"),o.avatarList[e]=t}let t=o.avatarList[e];return t.visible||(o._numUsers++,ATON.fireEvent("VRC_UserEnter",e)),o._bShowAvaG&&t.show(),t}),o.destroyAvatar=(e=>{let t=o.avatarList[e];void 0!==t&&t.destroy()}),o.clearAllAvatars=(()=>{for(let e in o.avatarList){o.avatarList[e].hide()}});var r=o;exports.default=r;
},{"./ATON.avatar.js":"Qwfv"}],"dQQK":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;let e={FLOAT_PREC:5,init:()=>{e.bConvexBuilding=!1,e.convexPoints=[],e.convexNode=void 0,e.currConvexMesh=void 0,e.currSemNode=ATON.createSemanticNode(),e.currSemNode.disablePicking(),e.currSemNode.attachToRoot(),e.resetMaterial(),e._numShapes=0},resetMaterial:()=>{e.currMaterial=ATON.MatHub.getMaterial("semanticShapeHL")},setMaterial:t=>{void 0!==t&&(e.currMaterial=t)},addConvexPoint:t=>{if(void 0===t)return!1;if(e.convexPoints.length>0){let n=e.convexPoints[e.convexPoints.length-1];if(t.equals(n))return!1}e.convexPoints.push(t);let n=e.convexPoints.length,r=new THREE.Mesh(ATON.Utils.geomUnitSphere,ATON.MatHub.getMaterial("semanticShapeEdit"));if(r.position.copy(t),r.scale.set(.001,.001,.001),ATON.SUI.gPoints.add(r),n<4)return!1;let o=new THREE.ConvexGeometry(e.convexPoints),i=new THREE.Mesh(o,ATON.MatHub.getMaterial("semanticShapeEdit"));if(e.bConvexBuilding){let n=e.currConvexMesh;n.geometry.dispose(),n.geometry=o,ATON.Utils.setVectorPrecision(t,4),n.userData._convexPoints.push(t.x),n.userData._convexPoints.push(t.y),n.userData._convexPoints.push(t.z)}else{e.currSemNode.add(i),i.userData._convexPoints=[];for(let t=0;t<n;t++)ATON.Utils.setVectorPrecision(e.convexPoints[t],e.FLOAT_PREC),i.userData._convexPoints.push(e.convexPoints[t].x),i.userData._convexPoints.push(e.convexPoints[t].y),i.userData._convexPoints.push(e.convexPoints[t].z);e.currConvexMesh=i,e.bConvexBuilding=!0}return!0},undoConvexPoint:()=>{if(0!==e.convexPoints.length&&(e.convexPoints.pop(),e.currConvexMesh)){let t=e.currConvexMesh.userData;t._convexPoints&&t._convexPoints.pop()}},stopCurrentConvex:()=>{e.convexPoints=[],e.bConvexBuilding=!1,e.currSemNode.removeChildren(),ATON.SUI.gPoints.removeChildren()},getCurrentConvexShape:()=>e.currSemNode,isBuildingShape:()=>e.convexPoints.length>0,completeConvexShape:t=>{if(e.convexPoints=[],e.bConvexBuilding=!1,void 0===e.currSemNode)return;void 0===t&&(t="sem"+e._numShapes);let n=ATON.getSemanticNode(t)||ATON.createSemanticNode(t),r=e.currSemNode.children[0];return ATON.SUI.addSemIcon(t,r),n.add(r),n.setMaterial(ATON.MatHub.materials.semanticShape),n.setDefaultAndHighlightMaterials(ATON.MatHub.materials.semanticShape,e.currMaterial),n.enablePicking(),e.currSemNode.removeChildren(),e._numShapes++,ATON.SUI.gPoints.removeChildren(),ATON._bqSem=!0,n},createConvexShape:(t,n)=>{let r=new THREE.ConvexGeometry(n),o=new THREE.Mesh(r,ATON.MatHub.materials.semanticShape);o.userData._convexPoints=[];for(let e=0;e<n.length;e++){let t=n[e];ATON.Utils.setVectorPrecision(t,4),o.userData._convexPoints.push(t.x),o.userData._convexPoints.push(t.y),o.userData._convexPoints.push(t.z)}ATON.SUI.addSemIcon(t,o);let i=ATON.getOrCreateSemanticNode(t);return i.add(o),i.setDefaultAndHighlightMaterials(ATON.MatHub.materials.semanticShape,e.currMaterial),i.enablePicking(),ATON._bqSem=!0,i},addSurfaceConvexPoint:t=>{if(void 0===ATON._queryDataScene)return!1;void 0===t&&(t=.02);let n=ATON._queryDataScene.p,r=ATON.Nav.getCurrentEyeLocation();return n.lerpVectors(n,r,t),e.addConvexPoint(n),n},createSphere:(t,n,r)=>{if(void 0===n)return;if(void 0===r)return;void 0===t&&(t="sem"+e._numShapes);let o=ATON.getOrCreateSemanticNode(t),i=new THREE.Mesh(ATON.Utils.geomUnitSphere,ATON.MatHub.materials.semanticShape),a=new THREE.Object3D;return a.position.copy(n),a.scale.set(r,r,r),a.add(i),ATON.SUI.addSemIcon(t,a),o.add(a),o.enablePicking(),o.setDefaultAndHighlightMaterials(ATON.MatHub.materials.semanticShape,e.currMaterial),e._numShapes++,ATON._bqSem=!0,o},createSurfaceSphere:t=>{if(!ATON._queryDataScene)return;let n=ATON._queryDataScene.p,r=ATON.SUI.getSelectorRadius();return e.createSphere(t,n,r)},deleteSemanticNode:e=>{let t=ATON.getSemanticNode(e);if(void 0===t)return!1;if(t.removeChildren(),void 0===ATON.SUI.gSemIcons)return!0;for(let n in ATON.SUI.gSemIcons.children){let t=ATON.SUI.gSemIcons.children[n];t&&t.name===e&&ATON.SUI.gSemIcons.removeChild(t)}return!0}};var t=e;exports.default=t;
},{}],"Z6YW":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;let e={SEMSHAPE_SPHERE:0,SEMSHAPE_CONVEX:1,POPUP_DELAY:300,realize:()=>{e.PATH_RES_ICONS=ATON.PATH_RES+"icons/",e._bPopup=!1,e.popupBlurBG=0,e._userAuth={},e._bControlLight=!1,e._bControlSelScale=!1,e._cLightDir=new THREE.Vector3,e._auSemNode=void 0,e._auSemNodePlaying=!1,e._bReqHome=!1,e._vrcAddr=void 0,e._bVRCsetup=!1,e.urlParams=new URLSearchParams(window.location.search),e._uiSetupBase(),e._uiProfiles={},e._uiCurrProfile=void 0,e._selRanges=[.01,50],e._selRefRadius=.5,ATON.realize(),ATON.on("Fullscreen",t=>{e.uiSwitchButton("fullscreen",t)});let t=ATON.FE.urlParams.get("d");t&&t>0&&ATON.setDefaultPixelDensity(t);let o=ATON.FE.urlParams.get("dd");o&&o>0&&ATON.toggleDynamicDensity(!0)},_handleHomeReq:()=>{e._bReqHome||(e._bReqHome=!0,void 0!==ATON.Nav.homePOV?ATON.Nav.requestHome(1):ATON.Nav.computeAndRequestDefaultHome(.5))},addBasicLoaderEvents:()=>{ATON.on("NodeRequestFired",()=>{$("#idLoader").show()}),ATON.on("SceneJSONLoaded",()=>{ATON.SceneHub.getDescription()&&$("#btn-info").show(),void 0!==ATON.Nav.homePOV&&ATON.Nav.requestHome(1)}),ATON.on("AllNodeRequestsCompleted",()=>{$("#idLoader").hide(),ATON._ccModels.length>0&&$("#btn-cc").show(),e.computeSelectorRanges(),ATON.Nav.isOrbit()&&ATON.SUI.setSelectorRadius(e._selRefRadius),e._handleHomeReq()}),ATON.addUpdateRoutine(e._update)},controlLight:t=>{e._bControlLight=t,ATON.Nav.setUserControl(!t)},controlSelectorScale:t=>{e._bControlSelScale=t,ATON._bPauseQuery=t,ATON.Nav.setUserControl(!t)},useMouseWheelToScaleSelector:t=>{void 0===t&&(t=.9),ATON.on("MouseWheel",o=>{if(ATON._kModCtrl){let e=ATON.Nav.getFOV();return o>0?e+=1:e-=1,void ATON.Nav.setFOV(e)}if(ATON._kModShift){let i=ATON.SUI.mainSelector.scale.x;return o>0?i*=t:i/=t,i<e._selRanges[0]&&(i=e._selRanges[0]),i>e._selRanges[1]&&(i=e._selRanges[1]),void ATON.SUI.setSelectorRadius(i)}})},loadSceneID:e=>{if(void 0===e)return;let t=ATON.PATH_RESTAPI_SCENE+e;ATON.SceneHub.load(t,e),$("meta[property=og\\:image]").attr("content",ATON.PATH_SCENES+e+"/cover.png"),$("meta[property=og\\:image\\:secure_url]").attr("content",ATON.PATH_SCENES+e+"/cover.png"),$("meta[property=og\\:image\\:type]").attr("content","image/png"),$("meta[property=og\\:image\\:width]").attr("content","200"),$("meta[property=og\\:image\\:height]").attr("content","200"),console.log(t)},_update:()=>{if(e._bControlLight){const t=ATON._screenPointerCoords.x,o=ATON._screenPointerCoords.y;e._cLightDir.x=-Math.cos(t*Math.PI),e._cLightDir.y=4*-o,e._cLightDir.z=-Math.sin(t*Math.PI),e._cLightDir.normalize(),ATON.setMainLightDirection(e._cLightDir)}},uiBasicSetup:()=>{e.uiAddButton("idTopToolbar","fullscreen",ATON.toggleFullScreen),ATON.Utils.isConnectionSecure()&&e.uiAddButton("idTopToolbar","vr",ATON.XR.toggle),e.uiAddButton("idBottomToolbar","home",()=>{ATON.Nav.requestHome(.1)})},_uiSetupBase:()=>{$("#idPopup").click(e.popupClose),$("#idLoader").html("<img src='"+ATON.PATH_RES+"loader.png'>")},uiAddButton:(t,o,i,d)=>{let s,a;o.endsWith(".png")?(s=o,a=o.slice(0,-4)):(s=e.PATH_RES_ICONS+o+".png",a=o);let n=$("<div id='"+("btn-"+a)+"' class='atonBTN' ><img src='"+s+"'></div>");$("#"+t).append(n),i&&n.click(i),d&&n.attr("title",d)},uiSwitchButton:(e,t)=>{t?$("#btn-"+e).addClass("switchedON"):$("#btn-"+e).removeClass("switchedON")},uiAddButtonHome:t=>{e.uiAddButton(t,"home",()=>{ATON.Nav.requestHome(.3)},"Home viewpoint")},uiAddButtonFirstPerson:t=>{e.uiAddButton(t,"fp",()=>{ATON.Nav.isFirstPerson()?(ATON.Nav.setOrbitControl(),e.uiSwitchButton("fp",!1)):(ATON.Nav.setFirstPersonControl(),e.uiSwitchButton("fp",!0))},"First-person navigation mode"),ATON.Nav.isFirstPerson()?e.uiSwitchButton("fp",!0):e.uiSwitchButton("fp",!1)},uiAddButtonVR:t=>{ATON.Utils.isConnectionSecure()&&e.uiAddButton(t,"vr",()=>{ATON.XR.toggle("immersive-vr")},"Immersive VR mode")},uiAddButtonAR:t=>{ATON.Utils.isConnectionSecure()&&e.uiAddButton(t,"ar",()=>{ATON.XR.toggle("immersive-ar")},"Immersive AR mode")},uiAddButtonDeviceOrientation:t=>{ATON.Utils.isConnectionSecure()&&ATON.Utils.isMobile()&&(e.uiAddButton(t,"devori",()=>{ATON.Nav.isDevOri()?(ATON.Nav.restorePreviousNavMode(),e.uiSwitchButton("devori",!1)):(ATON.Nav.setDeviceOrientationControl(),e.uiSwitchButton("devori",!0))},"Device-orientation mode"),ATON.Nav.isDevOri()?e.uiSwitchButton("devori",!0):e.uiSwitchButton("devori",!1))},uiAddButtonNav:t=>{e.uiAddButton(t,"nav",()=>{e.popupNav()},"Navigation")},uiAddButtonTalk:t=>{ATON.Utils.isConnectionSecure()&&(e.uiAddButton(t,"talk",()=>{ATON.MediaRec.isAudioRecording()?(ATON.MediaRec.stopMediaStreaming(),$("#btn-talk").removeClass("atonBTN-rec")):(ATON.MediaRec.startMediaStreaming(),$("#btn-talk").addClass("atonBTN-rec"))},"Talk ON/OFF"),ATON.MediaRec.isAudioRecording()?$("#btn-talk").addClass("atonBTN-rec"):$("#btn-talk").removeClass("atonBTN-rec"))},uiAddButtonStreamFocus:t=>{e.uiAddButton(t,"focus",()=>{ATON.VRoadcast._bStreamFocus?(ATON.VRoadcast.setFocusStreaming(!1),$("#btn-focus").removeClass("atonBTN-rec")):(ATON.VRoadcast.setFocusStreaming(!0),$("#btn-focus").addClass("atonBTN-rec"))},"Focus streaming ON/OFF"),ATON.VRoadcast._bStreamFocus?$("#btn-focus").addClass("atonBTN-rec"):$("#btn-focus").removeClass("atonBTN-rec")},uiAddButtonQR:t=>{e.uiAddButton(t,"qr",e.popupQR,"QR-code")},uiAddButtonScreenshot:t=>{e.uiAddButton(t,"sshot",e.popupScreenShot,"Screenshot")},uiAddButtonInfo:t=>{e.uiAddButton(t,"info",ATON.FE.popupSceneInfo,"Scene information"),$("#btn-info").hide()},uiAddButtonFullScreen:t=>{e.uiAddButton(t,"fullscreen",()=>{ATON.toggleFullScreen()},"Fullscreen"),e.uiSwitchButton("fullscreen",ATON.isFullscreen())},uiAddKeywordsArea:(t,o,i,d)=>{let s="";s+="Add keyword: <input id='idKWordInput' list='lkwords' type='text' maxlength='100' size='20'><div class='atonBTN atonBTN-green' id='idKWadd'><img src='"+ATON.FE.PATH_RES_ICONS+"add.png'></div><br>",s+="<div id='idKWords'></div>",$("#"+t).html(s),e.uiAttachInputFilterID("idKWordInput"),$.getJSON(ATON.PATH_RESTAPI+"keywords/",e=>{let o="<datalist id='lkwords'>";for(let t in e)o+="<option>"+t+"</option>";o+="</datalist>",$("#"+t).append(o)});let a={},n=e=>{a[e]||(e=e.toLowerCase().trim(),$("#idKWordInput").val(""),a[e]=1,console.log("Added keyword "+e),i&&i(e),$("#idKWords").append("<div class='atonKeyword atonKeywordActivable' id='idkw-"+e+"'>"+e+"</div>"),$("#idkw-"+e).click(()=>{$("#idkw-"+e).remove(),a[e]=void 0,console.log("Removed keyword "+e),d&&d(e)}))};if(o)for(let e in o)n(o[e]);$("#idKWordInput").keypress(function(e){if("13"!=(e.keyCode?e.keyCode:e.which))return;let t=$("#idKWordInput").val().toLowerCase().trim();!t||t.length<3||n(t)}),$("#idKWadd").click(()=>{let e=$("#idKWordInput").val().toLowerCase().trim();!e||e.length<3||n(e)})},getVRCclassFromID:e=>{return"atonVRCu"+e%6},_setupVRCevents:()=>{e._bVRCsetup||(ATON.on("VRC_IDassigned",t=>{$("#btn-vrc").addClass(e.getVRCclassFromID(t)),ATON.SUI.setSelectorColor(ATON.VRoadcast.ucolors[t%6]),e.checkAuth(e=>{void 0!==e.username&&ATON.VRoadcast.setUsername(e.username)})}),ATON.on("VRC_SceneState",e=>{let t=ATON.VRoadcast.getNumUsers();t>1?$("#idVRCnumusers").html(t):$("#idVRCnumusers").html(""),console.log("Users: "+t)}),ATON.on("VRC_Disconnected",()=>{$("#btn-vrc").attr("class","atonBTN"),ATON.SUI.setSelectorColor(ATON.MatHub.colors.defUI),$("#idVRCnumusers").html("")}),e._bVRCsetup=!0)},uiAddButtonVRC:t=>{e.uiAddButton(t,"vrc",()=>{ATON.VRoadcast.isConnected()?e.popupVRC():ATON.VRoadcast.connect(e._vrcAddr)},"VRoadcast (collaborative session)"),$("#btn-vrc").append("<span id='idVRCnumusers' class='atonVRCcounter'></span>"),e._setupVRCevents(),void 0!==ATON.VRoadcast.uid?$("#btn-vrc").addClass(e.getVRCclassFromID(ATON.VRoadcast.uid)):$("#btn-vrc").attr("class","atonBTN")},uiAddButtonUser:t=>{e.uiAddButton(t,"user",()=>{e.popupUser()},"User"),e.checkAuth(e=>{void 0!==e.username?$("#btn-user").addClass("switchedON"):$("#btn-user").removeClass("switchedON")})},uiAddButtonEditMode:t=>{e.uiAddButton(t,"edit",()=>{e.checkAuth(t=>{void 0!==t.username?(ATON.SceneHub._bEdit=!ATON.SceneHub._bEdit,e.uiSwitchButton("edit",ATON.SceneHub._bEdit)):e.popupUser()})})},uiAddProfile:(t,o)=>{"function"==typeof o&&(e._uiProfiles[t]=o)},uiLoadProfile:t=>{let o=e._uiProfiles[t];void 0!==o&&(o(),e._uiCurrProfile=t,console.log("Loaded UI Profile: "+e._uiCurrProfile))},attachHandlerToButton:(e,t)=>{void 0!==t&&$("#"+e).click(()=>{t()})},uiAttachInputFilterID:e=>{$("#"+e).on("keyup change input",()=>{let t=$("#"+e).val(),o=new RegExp("[^A-Za-z0-9-_]","ig");$("#"+e).val(t.replace(o,""))})},switchNode:(e,t,o)=>{let i=void 0;void 0!==(i=o===ATON.NTYPES.SEM?ATON.getSemanticNode(e):ATON.getSceneNode(e))&&(i.toggle(t),ATON.fireEvent("FE_NodeSwitch",{nid:e,t:o,v:t}))},uiCreateGraph:e=>{let t=ATON.snodes;e===ATON.NTYPES.SEM&&(t=ATON.semnodes);let o="";for(let i in t){let d=t[i].visible?"checked":"";"."!==i&&(o+="<input type='checkbox' "+d+" onchange=\"ATON.FE.switchNode('"+i+"',this.checked,"+e+');">'+i+"<br>")}return o},setupBasicUISounds:()=>{e.auLib={},e.auLib.switch=new Audio(ATON.PATH_RES+"audio/switch.wav"),e.auLib.switch.loop=!1},playAudioFromSemanticNode:t=>{if(void 0===t)return;let o=ATON.getSemanticNode(t);if(void 0===o)return;let i=o.getAudio();void 0!==i&&(void 0===e._auSemNode||null===e._auSemNode?e._auSemNode=new THREE.Audio(ATON.AudioHub._listener):e._auSemNode.stop(),ATON.AudioHub._loader.load(i,t=>{e._auSemNode.setBuffer(t),e._auSemNode.setLoop(!1),e._auSemNode.play()}))},popupShow:(t,o)=>{if(e._bPopup)return!1;let i="atonPopup ";o&&(i+=o);let d="<div id='idPopupContent' class='"+i+"'>";return d+=t+"</div>",$("#idPopup").html(d),$("#idPopupContent").click(e=>{e.stopPropagation()}),$("#idPopup").fadeIn(e.POPUP_DELAY),e._bPopup=!0,ATON._bListenKeyboardEvents=!1,e.popupBlurBG>0&&(ATON._renderer.domElement.style.filter="blur("+e.popupBlurBG+"px)"),ATON._bPauseQuery=!0,$("#idTopToolbar").hide(),$("#idBottomToolbar").hide(),$("#idBottomRToolbar").hide(),$("#idPoweredBy").hide(),!0},popupClose:t=>{e._bPopup=!1,ATON._bListenKeyboardEvents=!0,e.popupBlurBG>0&&(ATON._renderer.domElement.style.filter="none"),!0===t?$("#idPopup").hide():$("#idPopup").fadeOut(e.POPUP_DELAY),ATON._bPauseQuery=!1,$("#idTopToolbar").show(),$("#idBottomToolbar").show(),$("#idBottomRToolbar").show(),$("#idPoweredBy").show(),ATON.focusOn3DView()},subPopup:e=>{ATON.FE.popupClose(),setTimeout(e,ATON.FE.POPUP_DELAY)},popupQR:()=>{let e="<div class='atonPopupTitle'>Share</div>";if(e+="<div class='atonQRcontainer' id='idQRcode'></div><br><br>",!ATON.FE.popupShow("<div class='atonPopupTitle'>Share</div><div class='atonQRcontainer' id='idQRcode'></div><br><br>"))return;let t=window.location.href;new QRCode(document.getElementById("idQRcode"),t)},popupScreenShot:()=>{let t=ATON.Utils.takeScreenshot(200);e.checkAuth(o=>{let i="<div class='atonPopupTitle'>Screenshot</div>";i+="This is a preview of what your screenshot will look like:<br><br>",i+="<img src='"+t.src+"'><br>",i+="Resolution: <input id='isShotSize' type='number' min='100' max='4000' value='200'>px<br>",i+="<div class='atonBTN atonBTN-green' id='btnScreenShot' style='width:90%'><img src='"+e.PATH_RES_ICONS+"sshot.png'>SHOT</div>",void 0!==o.username&&(i+="<div class='atonBTN atonBTN-green' id='btnSetCover' style='width:90%'>Set as Cover</div>"),ATON.FE.popupShow(i)&&($("#btnScreenShot").click(()=>{ATON.FE.popupClose();let e=parseInt($("#isShotSize").val());ATON.Utils.takeScreenshot(e,"shot.png")}),$("#btnSetCover").click(()=>{ATON.FE.popupClose(),ATON.Utils.postJSON(ATON.PATH_RESTAPI+"cover/scene/",{sid:ATON.SceneHub.currID,img:t.src},e=>{console.log(e)})}))})},popupVRC:()=>{let e="",t=ATON.VRoadcast.getNumUsers();e+=t>1?"<div class='atonPopupTitle'>Collaborative Session ("+t+" users)</div>":"<div class='atonPopupTitle'>Collaborative Session</div>",e+="<input id='idVRCusername' type='text' size='10' placeholder='username...' style='display:none'>",e+="<div id='idVRCusernameBTN' class='atonBTN' style='width:150px; display:none'>"+ATON.VRoadcast._username+"</div>",e+="<div id='idChatBox' style='width:100%; height:150px; text-align:left;' class='scrollableY'></div>",e+="<input id='idVRCmsg' style='width:90%' type='text' placeholder='message...'>",e+="<div class='atonBTN' id='idVRCdisconnect' style='width:90%'>LEAVE</div>",ATON.FE.popupShow(e,"atonPopupLarge")&&(void 0===ATON.VRoadcast._username?($("#idVRCusername").show(),$("#idVRCusernameBTN").hide()):($("#idVRCusername").val(ATON.VRoadcast._username),$("#idVRCusername").hide(),$("#idVRCusernameBTN").show()),void 0!==ATON.VRoadcast.uid&&$("#idVRCusernameBTN").addClass("atonVRCu"+ATON.VRoadcast.uid%6),$("#idChatBox").append(ATON.VRoadcast._elChat),$("#idVRCmsg").keypress(e=>{if("13"==(e.keyCode?e.keyCode:e.which)){let e=$("#idVRCmsg").val();ATON.VRoadcast.setMessage(e),$("#idVRCmsg").val("")}}),$("#idVRCusername").keypress(e=>{if("13"==(e.keyCode?e.keyCode:e.which)){let e=$("#idVRCusername").val();ATON.VRoadcast.setUsername(e),$("#idVRCusername").hide(),$("#idVRCusernameBTN").html(ATON.VRoadcast._username),$("#idVRCusernameBTN").show()}}),$("#idVRCusernameBTN").click(()=>{$("#idVRCusername").show(),$("#idVRCusernameBTN").hide()}),$("#idVRCdisconnect").click(()=>{ATON.VRoadcast.disconnect(),ATON.FE.popupClose()}))},checkAuth:t=>{ATON.Utils.checkAuth(o=>{e._userAuth=o,void 0!==o.username?($("#btn-user").addClass("switchedON"),void 0===ATON.VRoadcast._username&&ATON.VRoadcast.setUsername(o.username)):$("#btn-user").removeClass("switchedON"),t&&t(o)})},popupUser:()=>{e.checkAuth(t=>{if(void 0!==t.username){let o="<img src='"+e.PATH_RES_ICONS+"user.png'><br>";if(o+="<b>'"+t.username+"'</b><br><br>",Object.keys(e._uiProfiles)){o+="UI Profile:<br><div class='select' style='width:150px;'><select id='idUIProfiles'>";for(let t in e._uiProfiles)o+="<option value='"+t+"'>"+t+"</option>";o+="</select><div class='selectArrow'></div></div><br><br>"}if(o+="<div class='atonBTN atonBTN-red' id='idLogoutBTN' style='width:90%'>LOGOUT</div>",!ATON.FE.popupShow(o))return;e._uiCurrProfile&&(console.log(e._uiCurrProfile),$("#idUIProfiles").val(e._uiCurrProfile)),$("#idLogoutBTN").click(()=>{$.get(ATON.PATH_RESTAPI+"logout",e=>{console.log(e),ATON.SceneHub.setEditMode(!1),ATON.fireEvent("Logout"),$("#btn-user").removeClass("switchedON")}),ATON.FE.popupClose()}),$("#idSHUscenes").click(()=>{ATON.Utils.goToURL("/shu/scenes/")}),$("#idSHUuser").click(()=>{ATON.Utils.goToURL("/shu/auth/")}),$("#idUIProfiles").on("change",()=>{let t=$("#idUIProfiles").val();e.uiLoadProfile(t),ATON.FE.popupClose()})}else{let t="<img src='"+e.PATH_RES_ICONS+"user.png'><br>";if(t+="username:<input id='idUsername' type='text' maxlength='15' size='15' ><br>",t+="password:<input id='idPassword' type='password' maxlength='15' size='15' ><br>",t+="<div class='atonBTN atonBTN-green' id='idLoginBTN' style='width:90%'>LOGIN</div>",!ATON.FE.popupShow(t))return;$("#idLoginBTN").click(()=>{let e=JSON.stringify({username:$("#idUsername").val(),password:$("#idPassword").val()});$.ajax({url:ATON.PATH_RESTAPI+"login",type:"POST",data:e,contentType:"application/json; charset=utf-8",dataType:"json",success:e=>{console.log(e),e&&(ATON.fireEvent("Login",e),$("#btn-user").addClass("switchedON"),ATON.FE.popupClose())}}).fail(e=>{$("#idLoginBTN").html("LOGIN FAILED"),$("#idLoginBTN").attr("class","atonBTN atonBTN-red")})})}})},popupSceneInfo:()=>{let e=ATON.SceneHub.getTitle();void 0===e&&(e=ATON.SceneHub.currID);let t=ATON.SceneHub.getDescription(),o="<div class='atonPopupTitle'>"+e+"</div>";t&&(o+="<div class='atonPopupDescriptionContainer'>"+JSON.parse(t)+"</div>"),o+="<div class='atonBTN atonBTN-green' id='btnOK' style='width:90%'>OK</div>",ATON.FE.popupShow(o)&&$("#btnOK").click(()=>{ATON.FE.popupClose()})},computeSelectorRanges:()=>{let t=ATON.getRootScene().getBound().radius;t<=0||(e._selRanges[0]=.001*t,e._selRefRadius=.02*t,e._selRanges[1]=.5*t)},popupSelector:()=>{let t="<div class='atonPopupTitle'>3D Selector</div>",o=ATON.SUI.getSelectorRadius(),i=ATON.Utils.getHumanReadableDistance(o);e.computeSelectorRanges(),t+="Radius (<span id='idSelRadTxt'>"+i+"</span>):<br>",t+="<input id='idSelRad' type='range' min='"+e._selRanges[0]+"' max='"+e._selRanges[1]+"' step='"+e._selRanges[0]+"' style='width:90%'>",ATON.FE.popupShow(t,"atonPopupLarge")&&($("#idSelRad").val(o),$("#idSelRad").on("input change",()=>{let e=parseFloat($("#idSelRad").val());ATON.SUI.setSelectorRadius(e),$("#idSelRadTxt").html(ATON.Utils.getHumanReadableDistance(e))}))},popupNav:()=>{let t="<div class='atonPopupTitle'>Navigation</div>";t+="<div style='display:block; width:90%; min-height:50px; vertical-align:top'>",t+="<div style='display:inline-block; width:60px; float:left' id='idNMfp'></div>",t+="<div style='text-align:left'>Switch between first-person and orbit navigation mode</div>",t+="</div>",ATON.Utils.isConnectionSecure()&&(t+="<div style='display:block; width:90%; min-height:50px; vertical-align:top'>",t+="<div style='display:inline-block; width:60px; float:left' id='idNMvr'></div>",t+="<div style='text-align:left'>Immersive VR mode</div>",t+="</div>",ATON.Utils.isMobile()&&(t+="<div style='display:block; width:90%; min-height:50px; vertical-align:top'>",t+="<div style='display:inline-block; width:60px; float:left' id='idNMdevori'></div>",t+="<div style='text-align:left'>Enable or disable device-orientation mode</div>",t+="</div>")),e.popupShow(t)&&(e.uiAddButtonFirstPerson("idNMfp"),e.uiAddButtonDeviceOrientation("idNMdevori"),e.uiAddButtonVR("idNMvr"))}};var t=e;exports.default=t;
},{}],"jdcn":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;let e={auType:"audio/wav",auExt:".wav",auBitsPerSecond:9e3,auStreamInterval:1e3,auMinVol:1,init:()=>{e._bAudioRecording=!1,e._bStreaming=!1,e.recorder=void 0},realizeAudioRecorder:r=>{if(void 0!==e.recorder)e.recorder.reset(),r&&r();else{if(!ATON.Utils.isConnectionSecure())return;if(!navigator.mediaDevices)return;void 0===e._ds&&(e._ds=setInterval(e._streamChunk,e.auStreamInterval)),navigator.mediaDevices.getUserMedia({video:!1,audio:!0,channelCount:1,echoCancellation:!0}).then(async function(o){e.recorder=RecordRTC(o,{type:"audio",mimeType:e.auType,bitsPerSecond:e.auBitsPerSecond,audioBitsPerSecond:e.auBitsPerSecond,sampleRate:22050,desiredSampRate:22050,disableLogs:!0,numberOfAudioChannels:1}),r&&r()})}},isAudioRecording:()=>e._bAudioRecording,_stopRecAndSend:r=>{void 0!==e.recorder?e.recorder.stopRecording(()=>{e.recorder.getDataURL(e=>{ATON.VRoadcast.socket&&void 0!==ATON.VRoadcast.uid?(ATON.VRoadcast.socket.compress(!1).emit("UTALK",{audio:e,uid:ATON.VRoadcast.uid}),r&&r()):r&&r()})}):r&&r()},_onAuBlob:r=>{r&&ATON.VRoadcast.socket&&ATON.VRoadcast.socket.emit("UTALK",{blob:r,uid:ATON.VRoadcast.uid,vol:e._auAVGvolume})},startRecording:()=>{e.realizeAudioRecorder(()=>{e.recorder&&(e._bAudioRecording||(console.log("Recording..."),e.recorder.startRecording(),e._bAudioRecording=!0))})},stopRecording:()=>{e.recorder&&e.recorder.stopRecording(()=>{let r=e.recorder.getBlob();console.log("Stop recording.");let o=new FileReader;o.readAsDataURL(r),o.onloadend=(()=>{let e=o.result;ATON.fireEvent("AudioRecordCompleted",e)}),e._bAudioRecording=!1})},startOrStopRecording:()=>{e._bAudioRecording?e.stopRecording():e.startRecording()},_streamChunk:()=>{e.recorder&&e._bStreaming&&e._stopRecAndSend(()=>{e.recorder.startRecording()})},startMediaStreaming:()=>{e.realizeAudioRecorder(()=>{e.recorder&&(e._bAudioRecording||(console.log("Start MediaStreaming"),e.recorder.startRecording(),e._bAudioRecording=!0,e._bStreaming=!0))})},stopMediaStreaming:()=>{e.recorder&&e._bAudioRecording&&(console.log("Stop MediaStreaming"),e._stopRecAndSend(()=>{}),e._bStreaming=!1,e._bAudioRecording=!1)},startOrStopMediaStreaming:()=>{e._bAudioRecording?e.stopMediaStreaming():e.startMediaStreaming()}};var r=e;exports.default=r;
},{}],"uZX1":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;let t={EARTH_R_KM:6371};t.EARTH_D_KM=2*t.EARTH_R_KM,t.init=(()=>{t._bActive=!1,t._wpid=void 0,t._currPos=new THREE.Vector2,t._POIs=[],t._currPOI=void 0,t._closestPOI=void 0,t._maxError=40}),t.enableTracking=(()=>{t._bActive||ATON.Utils.isConnectionSecure()&&navigator.geolocation&&(t._wpid=navigator.geolocation.watchPosition(t._onPosition,t._onError,{enableHighAccuracy:!0}),t._bActive=!0)}),t.disableTracking=(()=>{t._bActive&&(navigator.geolocation.clearWatch(t._wpid),t._bActive=!1)}),t.setMaxError=(e=>{e>0&&(t._maxError=e)}),t._onError=(()=>{console.log("Geolocation error")}),t._onPosition=(e=>{if(!t._bActive)return;if(!e.coords)return;let o=e.coords.accuracy;o&&o>t._maxError||(t._currPos.x=e.coords.latitude,t._currPos.y=e.coords.longitude,ATON.fireEvent("GeoLocation",e),t._handlePOIs())}),t._handlePOIs=(()=>{let e=t._POIs.length;if(!(e<=0)){t._closestPOIdist=void 0,t._closestPOI=void 0;for(let o=0;o<e;o++){let e=t._POIs[o],r=t.distance(t._currPos,e.pos);(void 0===t._closestPOIdist||r<t._closestPOIdist)&&(t._closestPOIdist=r,t._closestPOI=o),r<=e.radius?(t._currPOI!==o&&ATON.fireEvent("EnterPOI",{id:o,distance:r}),t._currPOI=o):(void 0!==t._currPOI&&ATON.fireEvent("LeavePOI",{id:t._currPOI,distance:r}),t._currPOI=void 0)}}}),t.getCurrentLocation=(()=>{if(t._bActive)return t._currPos}),t.locationFromLatLon=((t,e)=>new THREE.Vector2(t,e)),t.distance_orig=((e,o)=>{let r=ATON.DEG2RAD*(o.x-e.x),s=ATON.DEG2RAD*(o.y-e.y),i=Math.sin(r/2)*Math.sin(r/2)+Math.cos(ATON.DEG2RAD*e.x)*Math.cos(ATON.DEG2RAD*o.x)*Math.sin(s/2)*Math.sin(s/2),c=2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i));return 1e3*(t.EARTH_R_KM*c)}),t.distance=((e,o)=>{let r=.5-Math.cos((o.x-e.x)*ATON.DEG2RAD)/2+Math.cos(e.x*ATON.DEG2RAD)*Math.cos(o.x*ATON.DEG2RAD)*(1-Math.cos((o.y-e.y)*ATON.DEG2RAD))/2;return 1e3*(t.EARTH_D_KM*Math.asin(Math.sqrt(r)))}),t.addPOI=((e,o)=>{let r={};return r.pos=new THREE.Vector2(e.x,e.y),r.radius=o,t._POIs.push(r),t._bActive||t.enableTracking(),t._handlePOIs(),t._POIs.length-1}),t.getPOIbyIndex=(e=>t._POIs[e]),t.getClosestPOI=(()=>t._closestPOI),t.getClosestPOIdistance=(()=>t._closestPOIdist);var e=t;exports.default=e;
},{}],"Iy9y":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;let t={init:()=>{t._appid=$("meta[name='aton\\:appid']").attr("content"),t._appdata={}},_sendDataPatch:(a,e,o)=>new Promise((d,i)=>{if(void 0===a)return void i("No storage ID specified");if(a.length<3)return void i("Storage ID too short");if(void 0===e)return void i("No storage patch");if(void 0===t._appid)return void i("No app-ID");void 0===o&&(o=ATON.PATCH_ADD);let p={};p.wappid=t._appid,p.fid=a,p.data=e,p.mode=o===ATON.PATCH_DEL?"DEL":"ADD";let r=JSON.stringify(p);$.ajax({url:ATON.PATH_RESTAPI+"patch/wapp",type:"POST",data:r,contentType:"application/json; charset=utf-8",dataType:"json",success:e=>{void 0!==e?(t._appdata[a]=e,d(e)):i("Error writing on server")}})}),getAppID:()=>t._appid,addToStorage:(a,e)=>t._sendDataPatch(a,e,ATON.PATCH_ADD),deleteFromStorage:(a,e)=>t._sendDataPatch(a,e,ATON.PATCH_DEL),getStorage:a=>new Promise((e,o)=>{void 0!==t._appid?void 0!==a?$.getJSON(ATON.PATH_WAPPS+t._appid+"/data/"+a+".json",o=>{console.log(o),t._appdata[a]=o,e(o)}):o("No storage ID specified"):o()})};var a=t;exports.default=a;
},{}],"lJ6J":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;let s={PASS_BASE:0,PASS_AA:1,PASS_AO:2,PASS_SSR:3,PASS_BLOOM:4,PASS_DOF:5,PASS_GAMMA:6,init:()=>{if(void 0===ATON._renderer)return;s.composer=new THREE.EffectComposer(ATON._renderer),s.passes=[],ATON._renderer.autoClear=!1;let e=window.innerWidth*ATON._stdpxd,o=window.innerHeight*ATON._stdpxd;s.passes[s.PASS_BASE]=new THREE.RenderPass(ATON._mainRoot,ATON.Nav._camera),s.composer.addPass(s.passes[s.PASS_BASE]),s.passes[s.PASS_AO]=new THREE.SAOPass(ATON._mainRoot,ATON.Nav._camera,!1,!0),s.passes[s.PASS_AO].params.saoBias=1,s.passes[s.PASS_AO].params.saoScale=100,s.passes[s.PASS_AO].params.saoIntensity=.2,s.passes[s.PASS_BLOOM]=new THREE.UnrealBloomPass(new THREE.Vector2(e,o),1.5,.4,.85),s.passes[s.PASS_BLOOM].threshold=.9,s.passes[s.PASS_BLOOM].strength=1,s.passes[s.PASS_BLOOM].radius=0;s.passes[s.PASS_DOF]=new THREE.BokehPass(ATON._mainRoot,ATON.Nav._camera,{focus:5,aperture:.001,maxblur:.01,width:e,height:o}),s.passes[s.PASS_GAMMA]=new THREE.ShaderPass(THREE.GammaCorrectionShader),s.passes[s.PASS_AA]=new THREE.ShaderPass(THREE.FXAAShader),s.passes[s.PASS_AA].material.uniforms.resolution.value.set(1/e,1/o),s.composer.addPass(s.passes[s.PASS_AO]),s.composer.addPass(s.passes[s.PASS_BLOOM]),s.composer.addPass(s.passes[s.PASS_GAMMA]),s.composer.addPass(s.passes[s.PASS_AA]),s.composer.addPass(s.passes[s.PASS_DOF]),s.togglePass(s.PASS_AO,!1),s.togglePass(s.PASS_BLOOM,!1),s.togglePass(s.PASS_DOF,!1),console.log(s.composer)},togglePass:(e,o)=>{if(void 0===s.composer)return;if(ATON.device.lowGPU)return;void 0!==s.passes[e]&&(s.passes[e].enabled=void 0===o?!s.passes[e].enabled:o)},isPassEnabled:e=>{if(void 0===s.composer)return!1;return void 0!==s.passes[e]&&s.passes[e].enabled},setAOintensity:e=>{void 0!==s.composer&&void 0!==s.passes[s.PASS_AO]&&(s.passes[s.PASS_AO].params.saoIntensity=e)},getAOintensity:()=>void 0===s.composer?0:void 0===s.passes[s.PASS_AO]?0:s.passes[s.PASS_AO].params.saoIntensity,setBloomStrength:e=>{void 0!==s.composer&&void 0!==s.passes[s.PASS_BLOOM]&&(s.passes[s.PASS_BLOOM].strength=e)},getBloomStrength:()=>void 0===s.composer?0:void 0===s.passes[s.PASS_BLOOM]?0:s.passes[s.PASS_BLOOM].strength,setBloomThreshold:e=>{void 0!==s.composer&&void 0!==s.passes[s.PASS_BLOOM]&&(s.passes[s.PASS_BLOOM].threshold=e)},getBloomThreshold:()=>void 0===s.composer?0:void 0===s.passes[s.PASS_BLOOM]?0:s.passes[s.PASS_BLOOM].threshold,setDOFfocus:e=>{if(void 0===s.composer)return;if(void 0===s.passes[s.PASS_DOF])return;let o=s.passes[s.PASS_DOF].uniforms;void 0!==o&&(o.focus.value=e)},getDOFfocus:()=>{if(void 0===s.composer)return 0;if(void 0===s.passes[s.PASS_DOF])return 0;let e=s.passes[s.PASS_DOF].uniforms;return void 0===e?0:e.focus.value},setDOFaperture:e=>{if(void 0===s.composer)return;if(void 0===s.passes[s.PASS_DOF])return;let o=s.passes[s.PASS_DOF].uniforms;void 0!==o&&(o.aperture.value=e)}};var e=s;exports.default=e;
},{}],"yaoK":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=g(require("./ATON.node.js")),o=g(require("./ATON.pov.js")),n=g(require("./ATON.lightprobe.js")),t=g(require("./ATON.eventhub.js")),a=g(require("./ATON.mathub.js")),i=g(require("./ATON.utils.js")),r=g(require("./ATON.scenehub.js")),d=g(require("./ATON.audiohub.js")),s=g(require("./ATON.nav.js")),_=g(require("./ATON.xr.js")),l=g(require("./ATON.sui.js")),c=g(require("./ATON.vroadcast.js")),u=g(require("./ATON.semfactory.js")),v=g(require("./ATON.fe.js")),S=g(require("./ATON.mediarec.js")),m=g(require("./ATON.geoloc.js")),p=g(require("./ATON.apphub.js")),h=g(require("./ATON.fx.js"));function g(e){return e&&e.__esModule?e:{default:e}}let P={};window.ATON=P,P.Node=e.default,P.POV=o.default,P.LightProbe=n.default,P.EventHub=t.default,P.Utils=i.default,P.SceneHub=r.default,P.MatHub=a.default,P.Nav=s.default,P.AudioHub=d.default,P.XR=_.default,P.SUI=l.default,P.VRoadcast=c.default,P.SemFactory=u.default,P.FE=v.default,P.MediaRec=S.default,P.GeoLoc=m.default,P.AppHub=p.default,P.FX=h.default,P.STD_UPVECTOR=new THREE.Vector3(0,1,0),P.ROOT_NID=".",P.RAD2DEG=180/Math.PI,P.DEG2RAD=Math.PI/180,P.PATCH_ADD=0,P.PATCH_DEL=1,P.NTYPES={},P.NTYPES.SCENE=3,P.NTYPES.SEM=4,P.NTYPES.UI=5,P.PATH_RESTAPI=window.location.origin+"/api/",P.PATH_RESTAPI_SCENE=P.PATH_RESTAPI+"scene/",P.PATH_WAPPS=window.location.origin+"/a/",P.PATH_MODS=window.location.origin+"/mods/",P.PATH_DRACO_LIB=window.location.origin+"/dist/draco/",P.PATH_BASIS_LIB=window.location.origin+"/dist/basis/",P.PATH_IFC_LIB=window.location.origin+"/dist/ifc/",P.PATH_COLLECTION=window.location.origin+"/collections/",P.PATH_SCENES=window.location.origin+"/scenes/",P.PATH_RES=window.location.origin+"/res/",P.PATH_FE=window.location.origin+"/fe/",P.SHADOWS_NEAR=.1,P.SHADOWS_FAR=50,P.SHADOWS_SIZE=15,P.SHADOWS_RES=1024,P.AMB_L=.1,P.setPathCollection=(e=>{P.PATH_COLLECTION=e}),P.setPathScenes=(e=>{P.PATH_SCENES=e}),P._onUserInteraction=(()=>{P._elPanoVideo&&!P._vpanoPlaying&&P._elPanoVideo.play(),"suspended"===P.AudioHub._listener.context.state&&P.AudioHub._listener.context.resume()}),P._setupBaseListeners=(()=>{let e=P._renderer.domElement;window.addEventListener("resize",P._onResize,!1),window.onorientationchange=P._readDeviceOrientationMode,screenfull.isEnabled&&screenfull.on("change",()=>{P._bFS=screenfull.isFullscreen,P.fireEvent("Fullscreen",P._bFS),P._bFS?console.log("Now fullscreen"):console.log("Exit fullscreen")}),e.addEventListener("mousemove",P._updateScreenMove,!1),e.addEventListener("mousedown",e=>{1===e.button&&P.fireEvent("MouseMidButton"),2===e.button&&P.fireEvent("MouseRightButton")}),e.addEventListener("wheel",P._onMouseWheel,!1),P._bPointerDown=!1,window.addEventListener("pointerdown",e=>{P._bPointerDown=!0,P._onUserInteraction()}),window.addEventListener("pointerup",e=>{P._bPointerDown=!1}),window.addEventListener("pointermove",e=>{P._bPointerDown&&(P._updateScreenMove(e),P._handleQueries())}),window.addEventListener("touchstart",e=>{P._bPointerDown=!0,P._onUserInteraction()}),window.addEventListener("touchend",e=>{P._bPointerDown=!1}),window.addEventListener("touchmove",e=>{P._bPointerDown&&(P._updateScreenMove(e.touches[0]),P._handleQueries())}),Hammer(e).on("doubletap",e=>{P._bPointerDown=!1,P.fireEvent("DoubleTap",e.srcEvent)}),Hammer(e).on("tap",e=>{if(P._bPointerDown=!1,P._onUserInteraction(),P._updateScreenMove(e.srcEvent),P._handleQueries(),P.fireEvent("Tap",e.srcEvent),void 0===P._hoveredUI)return;let o=P.getUINode(P._hoveredUI);o&&o.onSelect&&o.onSelect()}),P.on("DoubleTap",e=>{P.defaultDoubleTapFromScreenCoords(e)}),P._kModShift=!1,P._kModCtrl=!1,P._bListenKeyboardEvents=!0,window.addEventListener("keydown",e=>{P._onUserInteraction(),"Shift"===e.key&&(P._kModShift=!0),"Control"===e.key&&(P._kModCtrl=!0),P._bListenKeyboardEvents&&P.fireEvent("KeyPress",e.key)},!1),window.addEventListener("keyup",e=>{"Shift"===e.key&&(P._kModShift=!1),"Control"===e.key&&(P._kModCtrl=!1),P._bListenKeyboardEvents&&P.fireEvent("KeyUp",e.key)},!1),P.on("KeyPress",e=>{if("+"===e){let e=P.Nav.getFOV()+1;P.Nav.setFOV(e)}if("-"===e){let e=P.Nav.getFOV()-1;P.Nav.setFOV(e)}if("PageUp"===e){let e=P.SUI.mainSelector.scale.x+.02;P.SUI.setSelectorRadius(e)}if("PageDown"===e){let e=P.SUI.mainSelector.scale.x-.02;e=Math.max(e,.01),P.SUI.setSelectorRadius(e)}})}),P._onResize=(()=>{if(P.Nav._camera.aspect=window.innerWidth/window.innerHeight,P.Nav._camera.updateProjectionMatrix(),P._renderer.setSize(window.innerWidth,window.innerHeight),P.FX.composer){P.FX.composer.setSize(window.innerWidth,window.innerHeight);let e=P.FX.passes[P.FX.PASS_AA].material.uniforms;e&&e.resolution.value.set(1/window.innerWidth,1/window.innerHeight)}console.log("onResize")}),P._onMouseWheel=(e=>{e.preventDefault(),P.fireEvent("MouseWheel",e.deltaY)}),P.focusOn3DView=(()=>{P._renderer.domElement.focus()}),P._SUIactivation=(()=>{const e=P.getUINode(P._hoveredUI);return void 0!==e&&(void 0!==e.onSelect&&(e.onSelect(),!0))}),P._stdActivation=(()=>{if(P._SUIactivation())return;if(!P.Nav._bControl)return;if(P.XR._bPresenting)return"immersive-vr"===_.default._sessionType&&_.default.teleportOnQueriedPoint(),void P.FE.playAudioFromSemanticNode(P._hoveredSemNode);if(P.Nav.isFirstPerson()||P.Nav.isDevOri()){if(P.Nav.currentQueryValidForLocomotion()){let e=P._queryDataScene.p,o=P.Nav._vDir,n=new THREE.Vector3(e.x,e.y+P.userHeight,e.z),t=new THREE.Vector3(n.x+o.x,n.y+o.y,n.z+o.z),a=(new P.POV).setPosition(n).setTarget(t).setFOV(P.Nav._currPOV.fov);P.Nav.requestPOV(a,.5)}return}let e=P.getSemanticNode(P._hoveredSemNode);P._queryDataSem&&e?P.Nav.requestPOVbyNode(e,.5):P._queryDataScene&&P.Nav.requestRetarget(P._queryDataScene.p,void 0,.5)}),P.defaultDoubleTapFromScreenCoords=(e=>{P._updateScreenMove(e),P._handleQueryScene(),P._stdActivation()}),P.isFullscreen=(()=>P._bFS),P.toggleFullScreen=(()=>{screenfull.toggle()}),P.realize=(()=>{console.log("Initialize ATON..."),P.Utils.init(),P.Utils.profileDevice(),P._clock=new THREE.Clock(!0),P._bFS=!1;P._renderer=new THREE.WebGLRenderer({antialias:!0,alpha:!0,powerPreference:"high-performance"}),P._renderer.setSize(window.innerWidth,window.innerHeight),P.Utils.profileRenderingCapabilities(),P._stdpxd=1,P._renderer.setPixelRatio(P._stdpxd),P._fps=60,P._dt=.01,P._dtAccum=0,P._avgFPScount=0,P._avgFPSaccum=0,P._avgFPS=60,P._bDynamicDensity=!1,P._dRenderBudgetMinFPS=25,P._dRenderBudgetMaxFPS=55,P._aniMixers=[],P._renderer.outputEncoding=THREE.sRGBEncoding,P._renderer.toneMapping=THREE.LinearToneMapping,P._renderer.toneMappingExposure=1,P._renderer.setAnimationLoop(P._onFrame),P._maxAnisotropy=P._renderer.capabilities.getMaxAnisotropy(),THREE.Cache.enabled=!0,P.userHeight=1.7,document.body.appendChild(P._renderer.domElement);let e=P._renderer.domElement;e.style.outline="none",e.style.border="none",P._vpanoPlaying=!1,P._bUserInts=0,P.EventHub.init(),P.MatHub.init(),P._assetsManager={},P._aLoader=new THREE.GLTFLoader,P._numReqLoad=0,P._dracoLoader=new THREE.DRACOLoader,P._dracoLoader.setDecoderConfig({type:"wasm"}),P._dracoLoader.setDecoderPath(P.PATH_DRACO_LIB),P._dracoLoader.setWorkerLimit(2),P._dracoLoader.preload(),P._aLoader.setDRACOLoader(P._dracoLoader),P._ccModels=[],P._updRoutines=[],P._lps=[],P._bAutoLP=!1,P._envMapInt=1,P._bShadowsFixedBound=!1,P._shadowsFixedBoundCenter=void 0,P._shadowsNear=P.SHADOWS_NEAR,P._shadowsFar=P.SHADOWS_FAR,P._shadowsSize=P.SHADOWS_SIZE,P._shadowsRes=P.SHADOWS_RES,P.initGraphs(),P.SceneHub.init(),P._tsets=[],P.AudioHub.init(),P.Nav.init(),P.XR.init(),P.SUI.init(),P.VRoadcast.init(),P.MediaRec.init(),P.SemFactory.init(),P.AppHub.init(),P.GeoLoc.init(),P.device.lowGPU||P.FX.init(),P._queryDataScene=void 0,P._queryDataSem=void 0,P._queryDataUI=void 0,P._hoveredSemNode=void 0,P._hoveredUI=void 0,P._bQuerySemOcclusion=!0,P._bQueryNormals=!0,P._bPauseQuery=!1,P._bCenteredQuery=!1,P._bqScene=!1,P._bqSem=!1,P._tgiDur=void 0,P._tgiPer=void 0,P._tHover=void 0,P._bMainPanoInfinite=!0,P._matMainPano=void 0,P._mMainPano=void 0,P._screenPointerCoords=new THREE.Vector2(0,0),P._rcScene=new THREE.Raycaster,P._rcScene.layers.set(P.NTYPES.SCENE),P._rcSemantics=new THREE.Raycaster,P._rcSemantics.layers.set(P.NTYPES.SEM),P._rcUI=new THREE.Raycaster,P._rcUI.layers.set(P.NTYPES.UI),P._registerRCS(),P._setupBaseListeners(),P.device.isMobile&&P._readDeviceOrientationMode(),P._wappID=void 0,P._extAPItokens={},P.focusOn3DView()}),P.setTimedGazeDuration=(e=>{P._tgiDur=e}),P.getTimedGazeProgress=(()=>{if(void 0!==P._tgiDur)return P._tgiPer}),P.getElapsedTime=(()=>P._clock.elapsedTime),P.renderPause=(()=>{P._renderer.setAnimationLoop(void 0)}),P.renderResume=(()=>{P._renderer.setAnimationLoop(P._onFrame)}),P._setupLoadManager=(()=>{P._loadManager=new THREE.LoadingManager,P._loadManager.onStart=((e,o,n)=>{console.log("Started loading file: "+e+".\nLoaded "+o+" of "+n+" files."),P.fireEvent("NodeRequestFired",e)}),P._loadManager.onLoad=(()=>{console.log("Loading complete!"),P.fireEvent("AllNodeRequestsCompleted")}),P._loadManager.onProgress=((e,o,n)=>{}),P._loadManager.onError=(e=>{console.log("There was an error loading "+e)})}),P.setDefaultPixelDensity=(e=>{P._stdpxd=e,P._renderer.setPixelRatio(e),P.FX.composer&&P.FX.composer.setPixelRatio(e),void 0!==P._renderer.xr&&(P.device.isMobile?P._renderer.xr.setFramebufferScaleFactor(P._stdpxd*P.XR.MOBILE_DENSITY_F):P._renderer.xr.setFramebufferScaleFactor(P._stdpxd))}),P.resetPixelDensity=(()=>{P._renderer.setPixelRatio(P._stdpxd)}),P._readDeviceOrientationMode=(()=>{90===Math.abs(window.orientation)?(console.log("Landscape Mode"),P.fireEvent("MobileLandscapeMode")):(console.log("Portrait Mode"),P.fireEvent("MobilePortraitMode")),setTimeout(P._onResize,500)}),P.snodes={},P.semnodes={},P.uinodes={},P.createSceneNode=(e=>new P.Node(e,P.NTYPES.SCENE)),P.getSceneNode=(e=>{if(void 0!==e)return P.snodes[e]}),P.getOrCreateSceneNode=(e=>{let o=P.getSceneNode(e);return void 0!==o?o:P.createSceneNode(e)}),P.getRootScene=(()=>P._rootVisible),P.createSemanticNode=(e=>new P.Node(e,P.NTYPES.SEM)),P.getSemanticNode=(e=>{if(void 0!==e)return P.semnodes[e]}),P.getOrCreateSemanticNode=(e=>{let o=P.getSemanticNode(e);return void 0!==o?o:P.createSemanticNode(e)}),P.getRootSemantics=(()=>P._rootSem),P.createUINode=(e=>new P.Node(e,P.NTYPES.UI)),P.getUINode=(e=>{if(void 0!==e)return P.uinodes[e]}),P.getRootUI=(()=>P._rootUI),P._assetReqNew=(e=>{P._numReqLoad++,P.fireEvent("NodeRequestFired",e)}),P._assetReqComplete=(e=>{P.fireEvent("NodeRequestCompleted",e),P._numReqLoad--,P._numReqLoad<=0&&P._onAllReqsCompleted()}),P._onAllReqsCompleted=(()=>{let e=P._rootVisible.getBound().center,o=P._rootVisible.getBound().radius;P._renderer.shadowMap.enabled&&(P._rootVisible.traverse(e=>{e.isMesh&&(e.castShadow=!0,e.receiveShadow=!0)}),P.adjustShadowsParamsFromSceneBounds(),P._bShadowsFixedBound&&P.updateDirShadows()),P._bAutoLP&&(void 0===P._lps[0]?P.addLightProbe((new P.LightProbe).setPosition(e).setNear(o)):P._lps[0].setPosition(e.x,e.y,e.z).setNear(o),console.log("Auto LP")),P.FX.composer&&P.FX.setDOFaperture(1/(30*o)),e&&P._mMainPano&&P._mMainPano.position.copy(e),P.getRootScene().assignLightProbesByProximity(),P.fireEvent("AllNodeRequestsCompleted"),P._postAllReqsCompleted(),setTimeout(()=>{P.updateLightProbes(),P._renderer.shadowMap.enabled&&P._bShadowsFixedBound&&0===P._aniMixers.length&&(P._dMainL.shadow.autoUpdate=!1,console.log("Lazy shadows"))},1e3)}),P._postAllReqsCompleted=(e=>{void 0===e&&(e=P._rootVisible);for(let o in e.children){let n=e.children[o];n&&n.toggle&&(P._postAllReqsCompleted(n),n.toggle(n.visible))}}),P.initGraphs=(()=>{P._mainRoot=new THREE.Scene,P._mainRoot.background=new THREE.Color(.7,.7,.7),P._rootVisibleGlobal=new THREE.Group,P._mainRoot.add(P._rootVisibleGlobal),P._rootVisible=P.createSceneNode().setAsRoot(),P._rootVisibleGlobal.add(P._rootVisible),P._rootSem=P.createSemanticNode().setAsRoot(),P._mainRoot.add(P._rootSem),P._rootUI=P.createUINode().setAsRoot(),P._mainRoot.add(P._rootUI),P.ambLight=new THREE.AmbientLight(new THREE.Color(1,1,1)),P._rootVisibleGlobal.add(P.ambLight)}),P.setBackgroundColor=(e=>{P._mainRoot.background=e}),P.setAutoLP=(e=>{P._bAutoLP=e}),P.setNeutralAmbientLight=(e=>{P.ambLight.color=new THREE.Color(e,e,e)}),P.addLightProbe=(e=>{void 0!==e&&(0===P._lps.length&&P.setNeutralAmbientLight(P.AMB_L),P._lps.push(e),void 0!==P.SUI.gLPIcons&&l.default.addLPIcon(e))}),P.updateLightProbes=(()=>{if(0!==P._lps.length){for(let e in P._lps)P._lps[e].update();P._lps[0]&&(P._indLP&&P._mainRoot.remove(P._indLP),P._indLP=THREE.LightProbeGenerator.fromCubeRenderTarget(P._renderer,P._lps[0]._prevCCtarget),P._indLP.intensity=1,P._mainRoot.add(P._indLP)),P._rootVisible.traverse(e=>{let o=e.userData.LP;void 0!==o&&o instanceof P.LightProbe&&(e.material.envMap=o.getEnvTex(),e.material.combine=THREE.AddOperation,e.material.envMapIntensity=P._envMapInt)}),console.log("LPs updated.")}}),P.setMainPanorama=(e=>{let o=void 0;e=P.Utils.resolveCollectionURL(e),void 0===P._mMainPano&&(P._gMainPano=new THREE.SphereBufferGeometry(1,60,60),P._gMainPano.castShadow=!1,P._gMainPano.receiveShadow=!1,P._mMainPano=new THREE.Mesh(P._gMainPano,P._matMainPano),P._mMainPano.frustumCulled=!1,P._mMainPano.renderOrder=-100,P.setMainPanoramaRadius(.8*P.Nav.STD_FAR)),P.Utils.isVideo(e)?(void 0===P._elPanoVideo&&(P._elPanoVideo=document.createElement("video"),P._elPanoVideo.id="idPanoVideo",P._elPanoVideo.innerHTML="<source src='"+e+"'>",P._elPanoVideo.crossOrigin="anonymous",P._elPanoVideo.loop=!0,P._elPanoVideo.playsinline=!0,P._elPanoVideo.style.cssText="display:none;",P._elPanoVideo.autoplay=!0,P._elPanoVideo.onplaying=(()=>{console.log("VideoPano playing"),P._vpanoPlaying=!0})),(o=new THREE.VideoTexture(P._elPanoVideo)).encoding=THREE.sRGBEncoding,P._realizeOrUpdateMainPano(o)):P.Utils.textureLoader.load(e,e=>{e.encoding=THREE.sRGBEncoding,e.generateMipmaps=!0,P._realizeOrUpdateMainPano(e)})}),P._realizeOrUpdateMainPano=(e=>{if(void 0!==P._matMainPano)return P._matMainPano.map=e,void P.updateLightProbes();P._matMainPano=new THREE.MeshBasicMaterial({map:e,depthTest:!1,depthWrite:!1}),P._mMainPano.material=P._matMainPano,P._bMainPanoInfinite&&(P._mMainPano.onAfterRender=(()=>{P.Nav._currPOV&&P._mMainPano.position.copy(P.Nav._currPOV.pos)})),P._rootVisibleGlobal.add(P._mMainPano),P.updateLightProbes()}),P.setMainPanoramaRadius=(e=>{void 0!==P._gMainPano&&P._gMainPano.scale(-e,e,e)}),P.setMainPanoramaRotation=(e=>{void 0!==P._mMainPano&&P._mMainPano.rotation.set(0,e,0)}),P.setMainPanoramaInfinite=(e=>{P._bMainPanoInfinite=e,void 0!==P._mMainPano&&(P._mMainPano.onAfterRender=e?()=>{P.Nav._currPOV&&P._mMainPano.position.copy(P.Nav._currPOV.pos)}:void 0)}),P.setMainPanoramaLocation=(e=>{P._bMainPanoInfinite||void 0!==P._mMainPano&&P._mMainPano.position.copy(e)}),P.setMainLightDirection=(e=>{let o=e.clone();o.normalize(),o.x*=.5*P.SHADOWS_FAR,o.y*=.5*P.SHADOWS_FAR,o.z*=.5*P.SHADOWS_FAR,void 0===P._dMainL&&(P._dMainL=new THREE.DirectionalLight(new THREE.Color(1,1,1),1),P._dMainL.castShadow=!1,P._dMainLtgt=new THREE.Object3D,P._rootVisibleGlobal.add(P._dMainLtgt),P._dMainL.target=P._dMainLtgt,P._rootVisibleGlobal.add(P._dMainL),P._dMainLpos=new THREE.Vector3),P._dMainLdir=o,P._dMainL.position.set(-o.x,-o.y,-o.z),P._renderer.shadowMap.enabled&&(P._dMainL.shadow.needsUpdate=!0),P.toggleMainLight(!0)}),P.getMainLightDirection=(()=>{if(void 0===P._dMainLdir)return;let e=P._dMainLdir.clone();return e.normalize(),e}),P.toggleMainLight=(e=>{void 0!==P._dMainL&&(P._dMainL.visible=e,e?(P.setNeutralAmbientLight(P.AMB_L),P.updateDirShadows()):P.setNeutralAmbientLight(1))}),P.isMainLightEnabled=(()=>void 0!==P._dMainL&&!!P._dMainL.visible),P.setExposure=(e=>{P._renderer.toneMappingExposure=e}),P.getExposure=(()=>P._renderer.toneMappingExposure),P.adjustShadowsParamsFromSceneBounds=(()=>{if(void 0===P._dMainL)return;let e=P._rootVisible.getBound().radius,o=P._rootVisible.getBound().center;e<=0||e>=P.SHADOWS_SIZE?(P._bShadowsFixedBound=!1,P._shadowsSize=P.SHADOWS_SIZE):(P._bShadowsFixedBound=!0,P._shadowsFixedBoundCenter=o,P._shadowsSize=1.5*e),P._dMainL.shadow.map&&(P._dMainL.shadow.map.dispose(),P._dMainL.shadow.map=null),P._dMainL.shadow.camera.left=-P._shadowsSize,P._dMainL.shadow.camera.right=P._shadowsSize,P._dMainL.shadow.camera.bottom=-P._shadowsSize,P._dMainL.shadow.camera.top=P._shadowsSize,P._dMainL.shadow.mapSize.width=P._shadowsRes,P._dMainL.shadow.mapSize.height=P._shadowsRes,P._dMainL.shadow.camera.near=P._shadowsNear,P._dMainL.shadow.camera.far=P._shadowsFar;let n=-2e-4*e;n<-.001&&(n=-.001),P._dMainL.shadow.bias=n}),P.toggleShadows=(e=>{void 0!==P._dMainL&&(e?(P._dMainL.castShadow=!0,P._renderer.shadowMap.enabled=!0,P.device.isMobile?P._renderer.shadowMap.type=THREE.PCFShadowMap:P._renderer.shadowMap.type=THREE.PCFSoftShadowMap,P._rootVisible.traverse(e=>{e.isMesh&&(e.castShadow=!0,e.receiveShadow=!0)}),P.adjustShadowsParamsFromSceneBounds(),P.updateDirShadows(),P._dMainL.shadow.needsUpdate=!0,console.log("Shadows ON")):(P._dMainL.castShadow=!1,P._renderer.shadowMap.enabled=!1,console.log("Shadows OFF")))}),P.updateDirShadows=(()=>{if(void 0===P._dMainLdir)return;let e=P._shadowsFixedBoundCenter;void 0===e?(e=P.Nav.getCurrentEyeLocation(),P._dMainLpos.x=e.x+P.Nav._vDir.x*P._shadowsSize,P._dMainLpos.y=e.y+P.Nav._vDir.y*P._shadowsSize,P._dMainLpos.z=e.z+P.Nav._vDir.z*P._shadowsSize):(P._dMainLpos.x=e.x,P._dMainLpos.y=e.y,P._dMainLpos.z=e.z),P._dMainL.position.set(P._dMainLpos.x-P._dMainLdir.x,P._dMainLpos.y-P._dMainLdir.y,P._dMainLpos.z-P._dMainLdir.z),P._dMainLtgt.position.copy(P._dMainLpos)}),P._updateEnvironment=(()=>{P._renderer.shadowMap.enabled&&(P._bShadowsFixedBound||P.updateDirShadows())}),P.setGlobalAudio=((e,o)=>{void 0!==e&&(void 0===o&&(o=!0),e=P.Utils.resolveCollectionURL(e),void 0===P._auMain||null===P._auMain?P._auMain=new THREE.Audio(P.AudioHub._listener):P._auMain.isPlaying&&P._auMain.stop(),P.AudioHub._loader.load(e,e=>{P._auMain.setBuffer(e),P._auMain.setLoop(o),P._auMain.play()}))}),P._markFPS=(()=>{if(P._numReqLoad>0)return;if(P._dt<0)return;const e=1/P._dt;P._avgFPScount+=1,P._dtAccum+=P._dt,P._avgFPSaccum+=e,P._dtAccum<1||(P._fps=P._avgFPSaccum/P._avgFPScount,P._avgFPSaccum=0,P._avgFPScount=0,P._dtAccum=0,P._handleDynamicRenderProfiles())}),P.toggleDynamicDensity=(e=>{P._bDynamicDensity=e}),P.setDynamicRenderingFPS=((e,o)=>{e>=o||(e&&(P._dRenderBudgetMinFPS=e),o&&(P._dRenderBudgetMaxFPS=o))}),P._handleDynamicRenderProfiles=(()=>{let e=P._renderer.getPixelRatio();P._fps<P._dRenderBudgetMinFPS&&(P._bDynamicDensity&&(e*=.8)>=.2&&(P._renderer.setPixelRatio(e),P.FX.composer&&P.FX.composer.setPixelRatio(e),console.log(e)),P.fireEvent("RequestLowerRender")),P._fps>P._dRenderBudgetMaxFPS&&(P._bDynamicDensity&&(e*=1.25)<=P._stdpxd&&(P._renderer.setPixelRatio(e),P.FX.composer&&P.FX.composer.setPixelRatio(e),console.log(e)),P.fireEvent("RequestHigherRender"))}),P._onFrame=(()=>{P._dt=P._clock.getDelta(),P._markFPS(),P.XR._bPresenting?P.XR.update():P.Nav._controls.update(P._dt),P._handleQueries(),P.Nav.update(),P.VRoadcast.update(),P.SUI.update(),P.MatHub.update(),P._updateEnvironment(),P._updateAniMixers(),P._updateRoutines(),P._updateTSets(),!P.FX.composer||P.XR._bPresenting?P._renderer.render(P._mainRoot,P.Nav._camera):P.FX.composer.render()}),P.addUpdateRoutine=(e=>{void 0!==e&&P._updRoutines.push(e)}),P.deleteAllUpdateRoutines=(()=>{P._updRoutines=[]}),P._updateRoutines=(()=>{let e=P._updRoutines.length;if(!(e<=0))for(let o=0;o<e;o++)P._updRoutines[o]()}),P._updateTSets=(()=>{const e=P._tsets.length;if(!(e<=0)){P.Nav._camera.updateMatrixWorld();for(let o=0;o<e;o++){P._tsets[o].update()}}}),P._updateAniMixers=(()=>{let e=P._aniMixers.length;if(!(e<1))for(let o=0;o<e;o++){P._aniMixers[o].update(P._dt)}}),P._updateScreenMove=(e=>{e.preventDefault&&e.preventDefault(),P._bCenteredQuery||(P._screenPointerCoords.x=e.clientX/window.innerWidth*2-1,P._screenPointerCoords.y=-e.clientY/window.innerHeight*2+1)}),P.toggleCenteredQuery=(e=>{P._bCenteredQuery=e,e&&(P._screenPointerCoords.x=0,P._screenPointerCoords.y=0)}),P._registerRCS=(()=>{P._rcRR=0,P._rcHandlers=[],P._rcHandlers.push(P._handleQueryScene),P._rcHandlers.push(P._handleQuerySemantics),P._rcHandlers.push(P._handleQueryUI)}),P._handleQueries=(()=>{if(P._bPauseQuery)return;if(P.Nav._bInteracting)return;if(P._numReqLoad>0)return;if(P.Nav.isTransitioning())return;if(P._handleQueryUI(),P._bqScene&&P._handleQueryScene(),P._bqSem&&P._handleQuerySemantics(),P.Nav.locomotionValidator(),void 0===P._tgiDur)return;if(void 0===P._tHover)return;const e=P._clock.elapsedTime-P._tHover;e>=P._tgiDur?(P._stdActivation(),P._tHover=void 0,P._tgiPer=void 0):P._tgiPer=e/P._tgiDur}),P._handleQueryScene=(()=>{if(P.XR.isPresenting()?P.XR.setupQueryRay(P._rcScene):P._rcScene.setFromCamera(P._screenPointerCoords,P.Nav._camera),P._hitsScene=[],P._rcScene.intersectObjects(P._mainRoot.children,!0,P._hitsScene),P._hitsScene.length<=0)return void(P._queryDataScene=void 0);const e=P._hitsScene[0];P._queryDataScene={},P._queryDataScene.p=e.point,P._queryDataScene.d=e.distance,P._queryDataScene.o=e.object,P._bQueryNormals&&null!==e.face&&void 0!==e.face.normal&&(P._queryDataScene.matrixWorld=(new THREE.Matrix3).getNormalMatrix(e.object.matrixWorld),P._queryDataScene.n=e.face.normal.clone().applyMatrix3(P._queryDataScene.matrixWorld).normalize())}),P.getSceneQueriedPoint=(()=>{if(void 0!==P._queryDataScene)return P._queryDataScene.p}),P.getSceneQueriedDistance=(()=>{if(void 0!==P._queryDataScene)return P._queryDataScene.d}),P.getSceneQueriedNormal=(()=>{if(void 0!==P._queryDataScene)return P._queryDataScene.n}),P._handleQuerySemantics=(()=>{if(P.XR.isPresenting()?P.XR.setupQueryRay(P._rcSemantics):P._rcSemantics.setFromCamera(P._screenPointerCoords,P.Nav._camera),P._hitsSem=[],P._rcSemantics.intersectObjects(P._mainRoot.children,!0,P._hitsSem),P._hitsSem.length<=0){if(P._queryDataSem=void 0,P._hoveredSemNode){P.fireEvent("SemanticNodeLeave",P._hoveredSemNode);let e=P.getSemanticNode(P._hoveredSemNode);e&&e.onLeave&&e.onLeave()}return P._hoveredSemNode=void 0,void(P._tHover=void 0)}const e=P._hitsSem[0];if(P._bQuerySemOcclusion&&P._queryDataScene&&P._queryDataScene.d<e.distance){if(P._queryDataSem=void 0,P._hoveredSemNode){P.fireEvent("SemanticNodeLeave",P._hoveredSemNode);let e=P.getSemanticNode(P._hoveredSemNode);e&&e.onLeave&&e.onLeave()}return P._hoveredSemNode=void 0,void(P._tHover=void 0)}P._queryDataSem={},P._queryDataSem.p=e.point,P._queryDataSem.d=e.distance,P._queryDataSem.o=e.object,P._queryDataSem.list=[];const o=P._queryDataSem.list;let n=e.object.parent;for(;n;)n.nid&&n.nid!==P.ROOT_NID&&o.push(n.nid),n=n.parent;const t=o[0];if(t&&P._hoveredSemNode!==t){if(P._hoveredSemNode){P.fireEvent("SemanticNodeLeave",P._hoveredSemNode);let e=P.getSemanticNode(P._hoveredSemNode);e&&e.onLeave&&e.onLeave(),P._tHover=void 0}P._hoveredSemNode=t,P.fireEvent("SemanticNodeHover",t);let e=P.getSemanticNode(t);e&&e.onHover&&e.onHover(),P._tHover=P._clock.elapsedTime}}),P._handleQueryUI=(()=>{if(P.XR.isPresenting()?P.XR.setupQueryRay(P._rcUI):P._rcUI.setFromCamera(P._screenPointerCoords,P.Nav._camera),P._hitsUI=[],P._rcUI.intersectObjects(P._mainRoot.children,!0,P._hitsUI),P._hitsUI.length<=0){if(P._queryDataUI=void 0,P._hoveredUI){P.fireEvent("UINodeLeave",P._hoveredUI);const e=P.getUINode(P._hoveredUI);e&&e.onLeave&&e.onLeave()}return P._hoveredUI=void 0,void(P._tHover=void 0)}const e=P._hitsUI[0];if(P._queryDataScene&&P._queryDataScene.d<e.distance){if(P._queryDataUI=void 0,P._hoveredUI){P.fireEvent("UINodeLeave",P._hoveredUI);const e=P.getUINode(P._hoveredUI);e&&e.onLeave&&e.onLeave()}return P._hoveredUI=void 0,void(P._tHover=void 0)}P._queryDataUI={},P._queryDataUI.p=e.point,P._queryDataUI.d=e.distance,P._queryDataUI.o=e.object,P._queryDataUI.list=[];const o=P._queryDataUI.list;let n=e.object.parent;for(;n;)n.nid&&n.nid!==P.ROOT_NID&&o.push(n.nid),n=n.parent;const t=o[0];if(t&&P._hoveredUI!==t){if(P._hoveredUI){P.fireEvent("UINodeLeave",P._hoveredUI);const e=P.getUINode(P._hoveredUI);e&&e.onLeave&&e.onLeave(),P._tHover=void 0}P._hoveredUI=t,P.fireEvent("UINodeHover",t);const e=P.getUINode(t);e&&e.onHover&&e.onHover(),P._tHover=P._clock.elapsedTime}}),P.setSketchFabAPIToken=(e=>{P._extAPItokens.sketchfab=e});var M=P;exports.default=M;
},{"./ATON.node.js":"XTSP","./ATON.pov.js":"CwXu","./ATON.lightprobe.js":"MNcy","./ATON.eventhub.js":"LryX","./ATON.mathub.js":"R8yv","./ATON.utils.js":"P9TA","./ATON.scenehub.js":"qC8Z","./ATON.audiohub.js":"mYhb","./ATON.nav.js":"nomA","./ATON.xr.js":"jROx","./ATON.sui.js":"xSlA","./ATON.vroadcast.js":"mY3J","./ATON.semfactory.js":"dQQK","./ATON.fe.js":"Z6YW","./ATON.mediarec.js":"jdcn","./ATON.geoloc.js":"uZX1","./ATON.apphub.js":"Iy9y","./ATON.fx.js":"lJ6J"}]},{},["yaoK"], null)
//# sourceMappingURL=/ATON.min.js.map